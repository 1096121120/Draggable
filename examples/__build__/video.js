!function(e){var t=window.webpackHotUpdate;window.webpackHotUpdate=function(e,r){!function(e,t){if(!C[e]||!b[e])return;for(var r in b[e]=!1,t)Object.prototype.hasOwnProperty.call(t,r)&&(g[r]=t[r]);0==--v&&0===y&&R()}(e,r),t&&t(e,r)};var r,n=!0,i="4142a7c4457294885869",s=1e4,o={},a=[],c=[];function l(e){var t=w[e];if(!t)return M;var n=function(n){return t.hot.active?(w[n]?-1===w[n].parents.indexOf(e)&&w[n].parents.push(e):(a=[e],r=n),-1===t.children.indexOf(n)&&t.children.push(n)):(console.warn("[HMR] unexpected require("+n+") from disposed module "+e),a=[]),M(n)},i=function(e){return{configurable:!0,enumerable:!0,get:function(){return M[e]},set:function(t){M[e]=t}}};for(var s in M)Object.prototype.hasOwnProperty.call(M,s)&&"e"!==s&&"t"!==s&&Object.defineProperty(n,s,i(s));return n.e=function(e){return"ready"===h&&p("prepare"),y++,M.e(e).then(t,(function(e){throw t(),e}));function t(){y--,"prepare"===h&&(S[e]||E(e),0===y&&0===v&&R())}},n.t=function(e,t){return 1&t&&(e=n(e)),M.t(e,-2&t)},n}function d(e){var t={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:!1,_selfDeclined:!1,_disposeHandlers:[],_main:r!==e,active:!0,accept:function(e,r){if(void 0===e)t._selfAccepted=!0;else if("function"==typeof e)t._selfAccepted=e;else if("object"==typeof e)for(var n=0;n<e.length;n++)t._acceptedDependencies[e[n]]=r||function(){};else t._acceptedDependencies[e]=r||function(){}},decline:function(e){if(void 0===e)t._selfDeclined=!0;else if("object"==typeof e)for(var r=0;r<e.length;r++)t._declinedDependencies[e[r]]=!0;else t._declinedDependencies[e]=!0},dispose:function(e){t._disposeHandlers.push(e)},addDisposeHandler:function(e){t._disposeHandlers.push(e)},removeDisposeHandler:function(e){var r=t._disposeHandlers.indexOf(e);r>=0&&t._disposeHandlers.splice(r,1)},check:_,apply:L,status:function(e){if(!e)return h;u.push(e)},addStatusHandler:function(e){u.push(e)},removeStatusHandler:function(e){var t=u.indexOf(e);t>=0&&u.splice(t,1)},data:o[e]};return r=void 0,t}var u=[],h="idle";function p(e){h=e;for(var t=0;t<u.length;t++)u[t].call(null,e)}var f,g,m,v=0,y=0,S={},b={},C={};function T(e){return+e+""===e?+e:e}function _(e){if("idle"!==h)throw new Error("check() is only allowed in idle status");return n=e,p("check"),(t=s,t=t||1e4,new Promise((function(e,r){if("undefined"==typeof XMLHttpRequest)return r(new Error("No browser support"));try{var n=new XMLHttpRequest,s=M.p+""+i+".hot-update.json";n.open("GET",s,!0),n.timeout=t,n.send(null)}catch(e){return r(e)}n.onreadystatechange=function(){if(4===n.readyState)if(0===n.status)r(new Error("Manifest request to "+s+" timed out."));else if(404===n.status)e();else if(200!==n.status&&304!==n.status)r(new Error("Manifest request to "+s+" failed."));else{try{var t=JSON.parse(n.responseText)}catch(e){return void r(e)}e(t)}}}))).then((function(e){if(!e)return p("idle"),null;b={},S={},C=e.c,m=e.h,p("prepare");var t=new Promise((function(e,t){f={resolve:e,reject:t}}));g={};return E(0),"prepare"===h&&0===y&&0===v&&R(),t}));var t}function E(e){C[e]?(b[e]=!0,v++,function(e){var t=document.createElement("script");t.charset="utf-8",t.src=M.p+""+e+"."+i+".hot-update.js",document.head.appendChild(t)}(e)):S[e]=!0}function R(){p("ready");var e=f;if(f=null,e)if(n)Promise.resolve().then((function(){return L(n)})).then((function(t){e.resolve(t)}),(function(t){e.reject(t)}));else{var t=[];for(var r in g)Object.prototype.hasOwnProperty.call(g,r)&&t.push(T(r));e.resolve(t)}}function L(t){if("ready"!==h)throw new Error("apply() is only allowed in ready status");var r,n,s,c,l;function d(e){for(var t=[e],r={},n=t.map((function(e){return{chain:[e],id:e}}));n.length>0;){var i=n.pop(),s=i.id,o=i.chain;if((c=w[s])&&!c.hot._selfAccepted){if(c.hot._selfDeclined)return{type:"self-declined",chain:o,moduleId:s};if(c.hot._main)return{type:"unaccepted",chain:o,moduleId:s};for(var a=0;a<c.parents.length;a++){var l=c.parents[a],d=w[l];if(d){if(d.hot._declinedDependencies[s])return{type:"declined",chain:o.concat([l]),moduleId:s,parentId:l};-1===t.indexOf(l)&&(d.hot._acceptedDependencies[s]?(r[l]||(r[l]=[]),u(r[l],[s])):(delete r[l],t.push(l),n.push({chain:o.concat([l]),id:l})))}}}}return{type:"accepted",moduleId:e,outdatedModules:t,outdatedDependencies:r}}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];-1===e.indexOf(n)&&e.push(n)}}t=t||{};var f={},v=[],y={},S=function(){console.warn("[HMR] unexpected require("+_.moduleId+") to disposed module")};for(var b in g)if(Object.prototype.hasOwnProperty.call(g,b)){var _;l=T(b);var E=!1,R=!1,L=!1,P="";switch((_=g[b]?d(l):{type:"disposed",moduleId:b}).chain&&(P="\nUpdate propagation: "+_.chain.join(" -> ")),_.type){case"self-declined":t.onDeclined&&t.onDeclined(_),t.ignoreDeclined||(E=new Error("Aborted because of self decline: "+_.moduleId+P));break;case"declined":t.onDeclined&&t.onDeclined(_),t.ignoreDeclined||(E=new Error("Aborted because of declined dependency: "+_.moduleId+" in "+_.parentId+P));break;case"unaccepted":t.onUnaccepted&&t.onUnaccepted(_),t.ignoreUnaccepted||(E=new Error("Aborted because "+l+" is not accepted"+P));break;case"accepted":t.onAccepted&&t.onAccepted(_),R=!0;break;case"disposed":t.onDisposed&&t.onDisposed(_),L=!0;break;default:throw new Error("Unexception type "+_.type)}if(E)return p("abort"),Promise.reject(E);if(R)for(l in y[l]=g[l],u(v,_.outdatedModules),_.outdatedDependencies)Object.prototype.hasOwnProperty.call(_.outdatedDependencies,l)&&(f[l]||(f[l]=[]),u(f[l],_.outdatedDependencies[l]));L&&(u(v,[_.moduleId]),y[l]=S)}var k,I=[];for(n=0;n<v.length;n++)l=v[n],w[l]&&w[l].hot._selfAccepted&&y[l]!==S&&I.push({module:l,errorHandler:w[l].hot._selfAccepted});p("dispose"),Object.keys(C).forEach((function(e){!1===C[e]&&function(e){delete installedChunks[e]}(e)}));for(var x,N,U=v.slice();U.length>0;)if(l=U.pop(),c=w[l]){var D={},O=c.hot._disposeHandlers;for(s=0;s<O.length;s++)(r=O[s])(D);for(o[l]=D,c.hot.active=!1,delete w[l],delete f[l],s=0;s<c.children.length;s++){var A=w[c.children[s]];A&&((k=A.parents.indexOf(l))>=0&&A.parents.splice(k,1))}}for(l in f)if(Object.prototype.hasOwnProperty.call(f,l)&&(c=w[l]))for(N=f[l],s=0;s<N.length;s++)x=N[s],(k=c.children.indexOf(x))>=0&&c.children.splice(k,1);for(l in p("apply"),i=m,y)Object.prototype.hasOwnProperty.call(y,l)&&(e[l]=y[l]);var z=null;for(l in f)if(Object.prototype.hasOwnProperty.call(f,l)&&(c=w[l])){N=f[l];var q=[];for(n=0;n<N.length;n++)if(x=N[n],r=c.hot._acceptedDependencies[x]){if(-1!==q.indexOf(r))continue;q.push(r)}for(n=0;n<q.length;n++){r=q[n];try{r(N)}catch(e){t.onErrored&&t.onErrored({type:"accept-errored",moduleId:l,dependencyId:N[n],error:e}),t.ignoreErrored||z||(z=e)}}}for(n=0;n<I.length;n++){var H=I[n];l=H.module,a=[l];try{M(l)}catch(e){if("function"==typeof H.errorHandler)try{H.errorHandler(e)}catch(r){t.onErrored&&t.onErrored({type:"self-accept-error-handler-errored",moduleId:l,error:r,originalError:e}),t.ignoreErrored||z||(z=r),z||(z=e)}else t.onErrored&&t.onErrored({type:"self-accept-errored",moduleId:l,error:e}),t.ignoreErrored||z||(z=e)}}return z?(p("fail"),Promise.reject(z)):(p("idle"),new Promise((function(e){e(v)})))}var w={};function M(t){if(w[t])return w[t].exports;var r=w[t]={i:t,l:!1,exports:{},hot:d(t),parents:(c=a,a=[],c),children:[]};return e[t].call(r.exports,r,r.exports,l(t)),r.l=!0,r.exports}M.m=e,M.c=w,M.d=function(e,t,r){M.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},M.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},M.t=function(e,t){if(1&t&&(e=M(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(M.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)M.d(r,n,function(t){return e[t]}.bind(null,n));return r},M.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return M.d(t,"a",t),t},M.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},M.p="/__build__/",M.h=function(){return i},l(2)(M.s=2)}([function(e,t,r){var n;
/*!
 * jQuery JavaScript Library v3.5.0
 * https://jquery.com/
 *
 * Includes Sizzle.js
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://jquery.org/license
 *
 * Date: 2020-04-10T15:07Z
 */!function(t,r){"use strict";"object"==typeof e.exports?e.exports=t.document?r(t,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return r(e)}:r(t)}("undefined"!=typeof window?window:this,(function(r,i){"use strict";var s=[],o=Object.getPrototypeOf,a=s.slice,c=s.flat?function(e){return s.flat.call(e)}:function(e){return s.concat.apply([],e)},l=s.push,d=s.indexOf,u={},h=u.toString,p=u.hasOwnProperty,f=p.toString,g=f.call(Object),m={},v=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},y=function(e){return null!=e&&e===e.window},S=r.document,b={type:!0,src:!0,nonce:!0,noModule:!0};function C(e,t,r){var n,i,s=(r=r||S).createElement("script");if(s.text=e,t)for(n in b)(i=t[n]||t.getAttribute&&t.getAttribute(n))&&s.setAttribute(n,i);r.head.appendChild(s).parentNode.removeChild(s)}function T(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[h.call(e)]||"object":typeof e}var _=function(e,t){return new _.fn.init(e,t)};function E(e){var t=!!e&&"length"in e&&e.length,r=T(e);return!v(e)&&!y(e)&&("array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e)}_.fn=_.prototype={jquery:"3.5.0",constructor:_,length:0,toArray:function(){return a.call(this)},get:function(e){return null==e?a.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=_.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return _.each(this,e)},map:function(e){return this.pushStack(_.map(this,(function(t,r){return e.call(t,r,t)})))},slice:function(){return this.pushStack(a.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(_.grep(this,(function(e,t){return(t+1)%2})))},odd:function(){return this.pushStack(_.grep(this,(function(e,t){return t%2})))},eq:function(e){var t=this.length,r=+e+(e<0?t:0);return this.pushStack(r>=0&&r<t?[this[r]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:s.sort,splice:s.splice},_.extend=_.fn.extend=function(){var e,t,r,n,i,s,o=arguments[0]||{},a=1,c=arguments.length,l=!1;for("boolean"==typeof o&&(l=o,o=arguments[a]||{},a++),"object"==typeof o||v(o)||(o={}),a===c&&(o=this,a--);a<c;a++)if(null!=(e=arguments[a]))for(t in e)n=e[t],"__proto__"!==t&&o!==n&&(l&&n&&(_.isPlainObject(n)||(i=Array.isArray(n)))?(r=o[t],s=i&&!Array.isArray(r)?[]:i||_.isPlainObject(r)?r:{},i=!1,o[t]=_.extend(l,s,n)):void 0!==n&&(o[t]=n));return o},_.extend({expando:"jQuery"+("3.5.0"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,r;return!(!e||"[object Object]"!==h.call(e))&&(!(t=o(e))||"function"==typeof(r=p.call(t,"constructor")&&t.constructor)&&f.call(r)===g)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,r){C(e,{nonce:t&&t.nonce},r)},each:function(e,t){var r,n=0;if(E(e))for(r=e.length;n<r&&!1!==t.call(e[n],n,e[n]);n++);else for(n in e)if(!1===t.call(e[n],n,e[n]))break;return e},makeArray:function(e,t){var r=t||[];return null!=e&&(E(Object(e))?_.merge(r,"string"==typeof e?[e]:e):l.call(r,e)),r},inArray:function(e,t,r){return null==t?-1:d.call(t,e,r)},merge:function(e,t){for(var r=+t.length,n=0,i=e.length;n<r;n++)e[i++]=t[n];return e.length=i,e},grep:function(e,t,r){for(var n=[],i=0,s=e.length,o=!r;i<s;i++)!t(e[i],i)!==o&&n.push(e[i]);return n},map:function(e,t,r){var n,i,s=0,o=[];if(E(e))for(n=e.length;s<n;s++)null!=(i=t(e[s],s,r))&&o.push(i);else for(s in e)null!=(i=t(e[s],s,r))&&o.push(i);return c(o)},guid:1,support:m}),"function"==typeof Symbol&&(_.fn[Symbol.iterator]=s[Symbol.iterator]),_.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(e,t){u["[object "+t+"]"]=t.toLowerCase()}));var R=
/*!
 * Sizzle CSS Selector Engine v2.3.5
 * https://sizzlejs.com/
 *
 * Copyright JS Foundation and other contributors
 * Released under the MIT license
 * https://js.foundation/
 *
 * Date: 2020-03-14
 */
function(e){var t,r,n,i,s,o,a,c,l,d,u,h,p,f,g,m,v,y,S,b="sizzle"+1*new Date,C=e.document,T=0,_=0,E=ce(),R=ce(),L=ce(),w=ce(),M=function(e,t){return e===t&&(u=!0),0},P={}.hasOwnProperty,k=[],I=k.pop,x=k.push,N=k.push,U=k.slice,D=function(e,t){for(var r=0,n=e.length;r<n;r++)if(e[r]===t)return r;return-1},O="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",A="[\\x20\\t\\r\\n\\f]",z="(?:\\\\[\\da-fA-F]{1,6}"+A+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\["+A+"*("+z+")(?:"+A+"*([*^$|!~]?=)"+A+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+z+"))|)"+A+"*\\]",H=":("+z+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",j=new RegExp(A+"+","g"),B=new RegExp("^"+A+"+|((?:^|[^\\\\])(?:\\\\.)*)"+A+"+$","g"),G=new RegExp("^"+A+"*,"+A+"*"),F=new RegExp("^"+A+"*([>+~]|"+A+")"+A+"*"),V=new RegExp(A+"|>"),W=new RegExp(H),J=new RegExp("^"+z+"$"),Y={ID:new RegExp("^#("+z+")"),CLASS:new RegExp("^\\.("+z+")"),TAG:new RegExp("^("+z+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+A+"*(even|odd|(([+-]|)(\\d*)n|)"+A+"*(?:([+-]|)"+A+"*(\\d+)|))"+A+"*\\)|)","i"),bool:new RegExp("^(?:"+O+")$","i"),needsContext:new RegExp("^"+A+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+A+"*((?:-\\d)?\\d*)"+A+"*\\)|)(?=[^-]|$)","i")},Q=/HTML$/i,$=/^(?:input|select|textarea|button)$/i,X=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\[\\da-fA-F]{1,6}"+A+"?|\\\\([^\\r\\n\\f])","g"),re=function(e,t){var r="0x"+e.slice(1)-65536;return t||(r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320))},ne=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},se=function(){h()},oe=be((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{N.apply(k=U.call(C.childNodes),C.childNodes),k[C.childNodes.length].nodeType}catch(e){N={apply:k.length?function(e,t){x.apply(e,U.call(t))}:function(e,t){for(var r=e.length,n=0;e[r++]=t[n++];);e.length=r-1}}}function ae(e,t,n,i){var s,a,l,d,u,f,v,y=t&&t.ownerDocument,C=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==C&&9!==C&&11!==C)return n;if(!i&&(h(t),t=t||p,g)){if(11!==C&&(u=Z.exec(e)))if(s=u[1]){if(9===C){if(!(l=t.getElementById(s)))return n;if(l.id===s)return n.push(l),n}else if(y&&(l=y.getElementById(s))&&S(t,l)&&l.id===s)return n.push(l),n}else{if(u[2])return N.apply(n,t.getElementsByTagName(e)),n;if((s=u[3])&&r.getElementsByClassName&&t.getElementsByClassName)return N.apply(n,t.getElementsByClassName(s)),n}if(r.qsa&&!w[e+" "]&&(!m||!m.test(e))&&(1!==C||"object"!==t.nodeName.toLowerCase())){if(v=e,y=t,1===C&&(V.test(e)||F.test(e))){for((y=ee.test(e)&&ve(t.parentNode)||t)===t&&r.scope||((d=t.getAttribute("id"))?d=d.replace(ne,ie):t.setAttribute("id",d=b)),a=(f=o(e)).length;a--;)f[a]=(d?"#"+d:":scope")+" "+Se(f[a]);v=f.join(",")}try{return N.apply(n,y.querySelectorAll(v)),n}catch(t){w(e,!0)}finally{d===b&&t.removeAttribute("id")}}}return c(e.replace(B,"$1"),t,n,i)}function ce(){var e=[];return function t(r,i){return e.push(r+" ")>n.cacheLength&&delete t[e.shift()],t[r+" "]=i}}function le(e){return e[b]=!0,e}function de(e){var t=p.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function ue(e,t){for(var r=e.split("|"),i=r.length;i--;)n.attrHandle[r[i]]=t}function he(e,t){var r=t&&e,n=r&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(r)for(;r=r.nextSibling;)if(r===t)return-1;return e?1:-1}function pe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function fe(e){return function(t){var r=t.nodeName.toLowerCase();return("input"===r||"button"===r)&&t.type===e}}function ge(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&oe(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function me(e){return le((function(t){return t=+t,le((function(r,n){for(var i,s=e([],r.length,t),o=s.length;o--;)r[i=s[o]]&&(r[i]=!(n[i]=r[i]))}))}))}function ve(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in r=ae.support={},s=ae.isXML=function(e){var t=e.namespaceURI,r=(e.ownerDocument||e).documentElement;return!Q.test(t||r&&r.nodeName||"HTML")},h=ae.setDocument=function(e){var t,i,o=e?e.ownerDocument||e:C;return o!=p&&9===o.nodeType&&o.documentElement?(f=(p=o).documentElement,g=!s(p),C!=p&&(i=p.defaultView)&&i.top!==i&&(i.addEventListener?i.addEventListener("unload",se,!1):i.attachEvent&&i.attachEvent("onunload",se)),r.scope=de((function(e){return f.appendChild(e).appendChild(p.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),r.attributes=de((function(e){return e.className="i",!e.getAttribute("className")})),r.getElementsByTagName=de((function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length})),r.getElementsByClassName=K.test(p.getElementsByClassName),r.getById=de((function(e){return f.appendChild(e).id=b,!p.getElementsByName||!p.getElementsByName(b).length})),r.getById?(n.filter.ID=function(e){var t=e.replace(te,re);return function(e){return e.getAttribute("id")===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var r=t.getElementById(e);return r?[r]:[]}}):(n.filter.ID=function(e){var t=e.replace(te,re);return function(e){var r=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return r&&r.value===t}},n.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var r,n,i,s=t.getElementById(e);if(s){if((r=s.getAttributeNode("id"))&&r.value===e)return[s];for(i=t.getElementsByName(e),n=0;s=i[n++];)if((r=s.getAttributeNode("id"))&&r.value===e)return[s]}return[]}}),n.find.TAG=r.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):r.qsa?t.querySelectorAll(e):void 0}:function(e,t){var r,n=[],i=0,s=t.getElementsByTagName(e);if("*"===e){for(;r=s[i++];)1===r.nodeType&&n.push(r);return n}return s},n.find.CLASS=r.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&g)return t.getElementsByClassName(e)},v=[],m=[],(r.qsa=K.test(p.querySelectorAll))&&(de((function(e){var t;f.appendChild(e).innerHTML="<a id='"+b+"'></a><select id='"+b+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+A+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+A+"*(?:value|"+O+")"),e.querySelectorAll("[id~="+b+"-]").length||m.push("~="),(t=p.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||m.push("\\["+A+"*name"+A+"*="+A+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+b+"+*").length||m.push(".#.+[+~]"),e.querySelectorAll("\\\f"),m.push("[\\r\\n\\f]")})),de((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+A+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&m.push(":enabled",":disabled"),f.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")}))),(r.matchesSelector=K.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&de((function(e){r.disconnectedMatch=y.call(e,"*"),y.call(e,"[s!='']:x"),v.push("!=",H)})),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=K.test(f.compareDocumentPosition),S=t||K.test(f.contains)?function(e,t){var r=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(r.contains?r.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},M=t?function(e,t){if(e===t)return u=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!r.sortDetached&&t.compareDocumentPosition(e)===n?e==p||e.ownerDocument==C&&S(C,e)?-1:t==p||t.ownerDocument==C&&S(C,t)?1:d?D(d,e)-D(d,t):0:4&n?-1:1)}:function(e,t){if(e===t)return u=!0,0;var r,n=0,i=e.parentNode,s=t.parentNode,o=[e],a=[t];if(!i||!s)return e==p?-1:t==p?1:i?-1:s?1:d?D(d,e)-D(d,t):0;if(i===s)return he(e,t);for(r=e;r=r.parentNode;)o.unshift(r);for(r=t;r=r.parentNode;)a.unshift(r);for(;o[n]===a[n];)n++;return n?he(o[n],a[n]):o[n]==C?-1:a[n]==C?1:0},p):p},ae.matches=function(e,t){return ae(e,null,null,t)},ae.matchesSelector=function(e,t){if(h(e),r.matchesSelector&&g&&!w[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var n=y.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){w(t,!0)}return ae(t,p,null,[e]).length>0},ae.contains=function(e,t){return(e.ownerDocument||e)!=p&&h(e),S(e,t)},ae.attr=function(e,t){(e.ownerDocument||e)!=p&&h(e);var i=n.attrHandle[t.toLowerCase()],s=i&&P.call(n.attrHandle,t.toLowerCase())?i(e,t,!g):void 0;return void 0!==s?s:r.attributes||!g?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ae.escape=function(e){return(e+"").replace(ne,ie)},ae.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ae.uniqueSort=function(e){var t,n=[],i=0,s=0;if(u=!r.detectDuplicates,d=!r.sortStable&&e.slice(0),e.sort(M),u){for(;t=e[s++];)t===e[s]&&(i=n.push(s));for(;i--;)e.splice(n[i],1)}return d=null,e},i=ae.getText=function(e){var t,r="",n=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=i(e)}else if(3===s||4===s)return e.nodeValue}else for(;t=e[n++];)r+=i(t);return r},(n=ae.selectors={cacheLength:50,createPseudo:le,match:Y,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,re),e[3]=(e[3]||e[4]||e[5]||"").replace(te,re),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ae.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ae.error(e[0]),e},PSEUDO:function(e){var t,r=!e[6]&&e[2];return Y.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":r&&W.test(r)&&(t=o(r,!0))&&(t=r.indexOf(")",r.length-t)-r.length)&&(e[0]=e[0].slice(0,t),e[2]=r.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,re).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=E[e+" "];return t||(t=new RegExp("(^|"+A+")"+e+"("+A+"|$)"))&&E(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,r){return function(n){var i=ae.attr(n,e);return null==i?"!="===t:!t||(i+="","="===t?i===r:"!="===t?i!==r:"^="===t?r&&0===i.indexOf(r):"*="===t?r&&i.indexOf(r)>-1:"$="===t?r&&i.slice(-r.length)===r:"~="===t?(" "+i.replace(j," ")+" ").indexOf(r)>-1:"|="===t&&(i===r||i.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,r,n,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===i?function(e){return!!e.parentNode}:function(t,r,c){var l,d,u,h,p,f,g=s!==o?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!c&&!a,S=!1;if(m){if(s){for(;g;){for(h=t;h=h[g];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[o?m.firstChild:m.lastChild],o&&y){for(S=(p=(l=(d=(u=(h=m)[b]||(h[b]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===T&&l[1])&&l[2],h=p&&m.childNodes[p];h=++p&&h&&h[g]||(S=p=0)||f.pop();)if(1===h.nodeType&&++S&&h===t){d[e]=[T,p,S];break}}else if(y&&(S=p=(l=(d=(u=(h=t)[b]||(h[b]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===T&&l[1]),!1===S)for(;(h=++p&&h&&h[g]||(S=p=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++S||(y&&((d=(u=h[b]||(h[b]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[T,S]),h!==t)););return(S-=i)===n||S%n==0&&S/n>=0}}},PSEUDO:function(e,t){var r,i=n.pseudos[e]||n.setFilters[e.toLowerCase()]||ae.error("unsupported pseudo: "+e);return i[b]?i(t):i.length>1?(r=[e,e,"",t],n.setFilters.hasOwnProperty(e.toLowerCase())?le((function(e,r){for(var n,s=i(e,t),o=s.length;o--;)e[n=D(e,s[o])]=!(r[n]=s[o])})):function(e){return i(e,0,r)}):i}},pseudos:{not:le((function(e){var t=[],r=[],n=a(e.replace(B,"$1"));return n[b]?le((function(e,t,r,i){for(var s,o=n(e,null,i,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))})):function(e,i,s){return t[0]=e,n(t,null,s,r),t[0]=null,!r.pop()}})),has:le((function(e){return function(t){return ae(e,t).length>0}})),contains:le((function(e){return e=e.replace(te,re),function(t){return(t.textContent||i(t)).indexOf(e)>-1}})),lang:le((function(e){return J.test(e||"")||ae.error("unsupported lang: "+e),e=e.replace(te,re).toLowerCase(),function(t){var r;do{if(r=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(r=r.toLowerCase())===e||0===r.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(t){var r=e.location&&e.location.hash;return r&&r.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!n.pseudos.empty(e)},header:function(e){return X.test(e.nodeName)},input:function(e){return $.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:me((function(){return[0]})),last:me((function(e,t){return[t-1]})),eq:me((function(e,t,r){return[r<0?r+t:r]})),even:me((function(e,t){for(var r=0;r<t;r+=2)e.push(r);return e})),odd:me((function(e,t){for(var r=1;r<t;r+=2)e.push(r);return e})),lt:me((function(e,t,r){for(var n=r<0?r+t:r>t?t:r;--n>=0;)e.push(n);return e})),gt:me((function(e,t,r){for(var n=r<0?r+t:r;++n<t;)e.push(n);return e}))}}).pseudos.nth=n.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})n.pseudos[t]=pe(t);for(t in{submit:!0,reset:!0})n.pseudos[t]=fe(t);function ye(){}function Se(e){for(var t=0,r=e.length,n="";t<r;t++)n+=e[t].value;return n}function be(e,t,r){var n=t.dir,i=t.next,s=i||n,o=r&&"parentNode"===s,a=_++;return t.first?function(t,r,i){for(;t=t[n];)if(1===t.nodeType||o)return e(t,r,i);return!1}:function(t,r,c){var l,d,u,h=[T,a];if(c){for(;t=t[n];)if((1===t.nodeType||o)&&e(t,r,c))return!0}else for(;t=t[n];)if(1===t.nodeType||o)if(d=(u=t[b]||(t[b]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[n]||t;else{if((l=d[s])&&l[0]===T&&l[1]===a)return h[2]=l[2];if(d[s]=h,h[2]=e(t,r,c))return!0}return!1}}function Ce(e){return e.length>1?function(t,r,n){for(var i=e.length;i--;)if(!e[i](t,r,n))return!1;return!0}:e[0]}function Te(e,t,r,n,i){for(var s,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(s=e[a])&&(r&&!r(s,n,i)||(o.push(s),l&&t.push(a)));return o}function _e(e,t,r,n,i,s){return n&&!n[b]&&(n=_e(n)),i&&!i[b]&&(i=_e(i,s)),le((function(s,o,a,c){var l,d,u,h=[],p=[],f=o.length,g=s||function(e,t,r){for(var n=0,i=t.length;n<i;n++)ae(e,t[n],r);return r}(t||"*",a.nodeType?[a]:a,[]),m=!e||!s&&t?g:Te(g,h,e,a,c),v=r?i||(s?e:f||n)?[]:o:m;if(r&&r(m,v,a,c),n)for(l=Te(v,p),n(l,[],a,c),d=l.length;d--;)(u=l[d])&&(v[p[d]]=!(m[p[d]]=u));if(s){if(i||e){if(i){for(l=[],d=v.length;d--;)(u=v[d])&&l.push(m[d]=u);i(null,v=[],l,c)}for(d=v.length;d--;)(u=v[d])&&(l=i?D(s,u):h[d])>-1&&(s[l]=!(o[l]=u))}}else v=Te(v===o?v.splice(f,v.length):v),i?i(null,o,v,c):N.apply(o,v)}))}function Ee(e){for(var t,r,i,s=e.length,o=n.relative[e[0].type],a=o||n.relative[" "],c=o?1:0,d=be((function(e){return e===t}),a,!0),u=be((function(e){return D(t,e)>-1}),a,!0),h=[function(e,r,n){var i=!o&&(n||r!==l)||((t=r).nodeType?d(e,r,n):u(e,r,n));return t=null,i}];c<s;c++)if(r=n.relative[e[c].type])h=[be(Ce(h),r)];else{if((r=n.filter[e[c].type].apply(null,e[c].matches))[b]){for(i=++c;i<s&&!n.relative[e[i].type];i++);return _e(c>1&&Ce(h),c>1&&Se(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(B,"$1"),r,c<i&&Ee(e.slice(c,i)),i<s&&Ee(e=e.slice(i)),i<s&&Se(e))}h.push(r)}return Ce(h)}return ye.prototype=n.filters=n.pseudos,n.setFilters=new ye,o=ae.tokenize=function(e,t){var r,i,s,o,a,c,l,d=R[e+" "];if(d)return t?0:d.slice(0);for(a=e,c=[],l=n.preFilter;a;){for(o in r&&!(i=G.exec(a))||(i&&(a=a.slice(i[0].length)||a),c.push(s=[])),r=!1,(i=F.exec(a))&&(r=i.shift(),s.push({value:r,type:i[0].replace(B," ")}),a=a.slice(r.length)),n.filter)!(i=Y[o].exec(a))||l[o]&&!(i=l[o](i))||(r=i.shift(),s.push({value:r,type:o,matches:i}),a=a.slice(r.length));if(!r)break}return t?a.length:a?ae.error(e):R(e,c).slice(0)},a=ae.compile=function(e,t){var r,i=[],s=[],a=L[e+" "];if(!a){for(t||(t=o(e)),r=t.length;r--;)(a=Ee(t[r]))[b]?i.push(a):s.push(a);(a=L(e,function(e,t){var r=t.length>0,i=e.length>0,s=function(s,o,a,c,d){var u,f,m,v=0,y="0",S=s&&[],b=[],C=l,_=s||i&&n.find.TAG("*",d),E=T+=null==C?1:Math.random()||.1,R=_.length;for(d&&(l=o==p||o||d);y!==R&&null!=(u=_[y]);y++){if(i&&u){for(f=0,o||u.ownerDocument==p||(h(u),a=!g);m=e[f++];)if(m(u,o||p,a)){c.push(u);break}d&&(T=E)}r&&((u=!m&&u)&&v--,s&&S.push(u))}if(v+=y,r&&y!==v){for(f=0;m=t[f++];)m(S,b,o,a);if(s){if(v>0)for(;y--;)S[y]||b[y]||(b[y]=I.call(c));b=Te(b)}N.apply(c,b),d&&!s&&b.length>0&&v+t.length>1&&ae.uniqueSort(c)}return d&&(T=E,l=C),S};return r?le(s):s}(s,i))).selector=e}return a},c=ae.select=function(e,t,r,i){var s,c,l,d,u,h="function"==typeof e&&e,p=!i&&o(e=h.selector||e);if(r=r||[],1===p.length){if((c=p[0]=p[0].slice(0)).length>2&&"ID"===(l=c[0]).type&&9===t.nodeType&&g&&n.relative[c[1].type]){if(!(t=(n.find.ID(l.matches[0].replace(te,re),t)||[])[0]))return r;h&&(t=t.parentNode),e=e.slice(c.shift().value.length)}for(s=Y.needsContext.test(e)?0:c.length;s--&&(l=c[s],!n.relative[d=l.type]);)if((u=n.find[d])&&(i=u(l.matches[0].replace(te,re),ee.test(c[0].type)&&ve(t.parentNode)||t))){if(c.splice(s,1),!(e=i.length&&Se(c)))return N.apply(r,i),r;break}}return(h||a(e,p))(i,t,!g,r,!t||ee.test(e)&&ve(t.parentNode)||t),r},r.sortStable=b.split("").sort(M).join("")===b,r.detectDuplicates=!!u,h(),r.sortDetached=de((function(e){return 1&e.compareDocumentPosition(p.createElement("fieldset"))})),de((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||ue("type|href|height|width",(function(e,t,r){if(!r)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),r.attributes&&de((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||ue("value",(function(e,t,r){if(!r&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),de((function(e){return null==e.getAttribute("disabled")}))||ue(O,(function(e,t,r){var n;if(!r)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null})),ae}(r);_.find=R,_.expr=R.selectors,_.expr[":"]=_.expr.pseudos,_.uniqueSort=_.unique=R.uniqueSort,_.text=R.getText,_.isXMLDoc=R.isXML,_.contains=R.contains,_.escapeSelector=R.escape;var L=function(e,t,r){for(var n=[],i=void 0!==r;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&_(e).is(r))break;n.push(e)}return n},w=function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r},M=_.expr.match.needsContext;function P(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var k=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function I(e,t,r){return v(t)?_.grep(e,(function(e,n){return!!t.call(e,n,e)!==r})):t.nodeType?_.grep(e,(function(e){return e===t!==r})):"string"!=typeof t?_.grep(e,(function(e){return d.call(t,e)>-1!==r})):_.filter(t,e,r)}_.filter=function(e,t,r){var n=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?_.find.matchesSelector(n,e)?[n]:[]:_.find.matches(e,_.grep(t,(function(e){return 1===e.nodeType})))},_.fn.extend({find:function(e){var t,r,n=this.length,i=this;if("string"!=typeof e)return this.pushStack(_(e).filter((function(){for(t=0;t<n;t++)if(_.contains(i[t],this))return!0})));for(r=this.pushStack([]),t=0;t<n;t++)_.find(e,i[t],r);return n>1?_.uniqueSort(r):r},filter:function(e){return this.pushStack(I(this,e||[],!1))},not:function(e){return this.pushStack(I(this,e||[],!0))},is:function(e){return!!I(this,"string"==typeof e&&M.test(e)?_(e):e||[],!1).length}});var x,N=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(_.fn.init=function(e,t,r){var n,i;if(!e)return this;if(r=r||x,"string"==typeof e){if(!(n="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:N.exec(e))||!n[1]&&t)return!t||t.jquery?(t||r).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof _?t[0]:t,_.merge(this,_.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:S,!0)),k.test(n[1])&&_.isPlainObject(t))for(n in t)v(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}return(i=S.getElementById(n[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==r.ready?r.ready(e):e(_):_.makeArray(e,this)}).prototype=_.fn,x=_(S);var U=/^(?:parents|prev(?:Until|All))/,D={children:!0,contents:!0,next:!0,prev:!0};function O(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}_.fn.extend({has:function(e){var t=_(e,this),r=t.length;return this.filter((function(){for(var e=0;e<r;e++)if(_.contains(this,t[e]))return!0}))},closest:function(e,t){var r,n=0,i=this.length,s=[],o="string"!=typeof e&&_(e);if(!M.test(e))for(;n<i;n++)for(r=this[n];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(o?o.index(r)>-1:1===r.nodeType&&_.find.matchesSelector(r,e))){s.push(r);break}return this.pushStack(s.length>1?_.uniqueSort(s):s)},index:function(e){return e?"string"==typeof e?d.call(_(e),this[0]):d.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(_.uniqueSort(_.merge(this.get(),_(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),_.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return L(e,"parentNode")},parentsUntil:function(e,t,r){return L(e,"parentNode",r)},next:function(e){return O(e,"nextSibling")},prev:function(e){return O(e,"previousSibling")},nextAll:function(e){return L(e,"nextSibling")},prevAll:function(e){return L(e,"previousSibling")},nextUntil:function(e,t,r){return L(e,"nextSibling",r)},prevUntil:function(e,t,r){return L(e,"previousSibling",r)},siblings:function(e){return w((e.parentNode||{}).firstChild,e)},children:function(e){return w(e.firstChild)},contents:function(e){return null!=e.contentDocument&&o(e.contentDocument)?e.contentDocument:(P(e,"template")&&(e=e.content||e),_.merge([],e.childNodes))}},(function(e,t){_.fn[e]=function(r,n){var i=_.map(this,t,r);return"Until"!==e.slice(-5)&&(n=r),n&&"string"==typeof n&&(i=_.filter(n,i)),this.length>1&&(D[e]||_.uniqueSort(i),U.test(e)&&i.reverse()),this.pushStack(i)}}));var A=/[^\x20\t\r\n\f]+/g;function z(e){return e}function q(e){throw e}function H(e,t,r,n){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(r):e&&v(i=e.then)?i.call(e,t,r):t.apply(void 0,[e].slice(n))}catch(e){r.apply(void 0,[e])}}_.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return _.each(e.match(A)||[],(function(e,r){t[r]=!0})),t}(e):_.extend({},e);var t,r,n,i,s=[],o=[],a=-1,c=function(){for(i=i||e.once,n=t=!0;o.length;a=-1)for(r=o.shift();++a<s.length;)!1===s[a].apply(r[0],r[1])&&e.stopOnFalse&&(a=s.length,r=!1);e.memory||(r=!1),t=!1,i&&(s=r?[]:"")},l={add:function(){return s&&(r&&!t&&(a=s.length-1,o.push(r)),function t(r){_.each(r,(function(r,n){v(n)?e.unique&&l.has(n)||s.push(n):n&&n.length&&"string"!==T(n)&&t(n)}))}(arguments),r&&!t&&c()),this},remove:function(){return _.each(arguments,(function(e,t){for(var r;(r=_.inArray(t,s,r))>-1;)s.splice(r,1),r<=a&&a--})),this},has:function(e){return e?_.inArray(e,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return i=o=[],s=r="",this},disabled:function(){return!s},lock:function(){return i=o=[],r||t||(s=r=""),this},locked:function(){return!!i},fireWith:function(e,r){return i||(r=[e,(r=r||[]).slice?r.slice():r],o.push(r),t||c()),this},fire:function(){return l.fireWith(this,arguments),this},fired:function(){return!!n}};return l},_.extend({Deferred:function(e){var t=[["notify","progress",_.Callbacks("memory"),_.Callbacks("memory"),2],["resolve","done",_.Callbacks("once memory"),_.Callbacks("once memory"),0,"resolved"],["reject","fail",_.Callbacks("once memory"),_.Callbacks("once memory"),1,"rejected"]],n="pending",i={state:function(){return n},always:function(){return s.done(arguments).fail(arguments),this},catch:function(e){return i.then(null,e)},pipe:function(){var e=arguments;return _.Deferred((function(r){_.each(t,(function(t,n){var i=v(e[n[4]])&&e[n[4]];s[n[1]]((function(){var e=i&&i.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[n[0]+"With"](this,i?[e]:arguments)}))})),e=null})).promise()},then:function(e,n,i){var s=0;function o(e,t,n,i){return function(){var a=this,c=arguments,l=function(){var r,l;if(!(e<s)){if((r=n.apply(a,c))===t.promise())throw new TypeError("Thenable self-resolution");l=r&&("object"==typeof r||"function"==typeof r)&&r.then,v(l)?i?l.call(r,o(s,t,z,i),o(s,t,q,i)):(s++,l.call(r,o(s,t,z,i),o(s,t,q,i),o(s,t,z,t.notifyWith))):(n!==z&&(a=void 0,c=[r]),(i||t.resolveWith)(a,c))}},d=i?l:function(){try{l()}catch(r){_.Deferred.exceptionHook&&_.Deferred.exceptionHook(r,d.stackTrace),e+1>=s&&(n!==q&&(a=void 0,c=[r]),t.rejectWith(a,c))}};e?d():(_.Deferred.getStackHook&&(d.stackTrace=_.Deferred.getStackHook()),r.setTimeout(d))}}return _.Deferred((function(r){t[0][3].add(o(0,r,v(i)?i:z,r.notifyWith)),t[1][3].add(o(0,r,v(e)?e:z)),t[2][3].add(o(0,r,v(n)?n:q))})).promise()},promise:function(e){return null!=e?_.extend(e,i):i}},s={};return _.each(t,(function(e,r){var o=r[2],a=r[5];i[r[1]]=o.add,a&&o.add((function(){n=a}),t[3-e][2].disable,t[3-e][3].disable,t[0][2].lock,t[0][3].lock),o.add(r[3].fire),s[r[0]]=function(){return s[r[0]+"With"](this===s?void 0:this,arguments),this},s[r[0]+"With"]=o.fireWith})),i.promise(s),e&&e.call(s,s),s},when:function(e){var t=arguments.length,r=t,n=Array(r),i=a.call(arguments),s=_.Deferred(),o=function(e){return function(r){n[e]=this,i[e]=arguments.length>1?a.call(arguments):r,--t||s.resolveWith(n,i)}};if(t<=1&&(H(e,s.done(o(r)).resolve,s.reject,!t),"pending"===s.state()||v(i[r]&&i[r].then)))return s.then();for(;r--;)H(i[r],o(r),s.reject);return s.promise()}});var j=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;_.Deferred.exceptionHook=function(e,t){r.console&&r.console.warn&&e&&j.test(e.name)&&r.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},_.readyException=function(e){r.setTimeout((function(){throw e}))};var B=_.Deferred();function G(){S.removeEventListener("DOMContentLoaded",G),r.removeEventListener("load",G),_.ready()}_.fn.ready=function(e){return B.then(e).catch((function(e){_.readyException(e)})),this},_.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--_.readyWait:_.isReady)||(_.isReady=!0,!0!==e&&--_.readyWait>0||B.resolveWith(S,[_]))}}),_.ready.then=B.then,"complete"===S.readyState||"loading"!==S.readyState&&!S.documentElement.doScroll?r.setTimeout(_.ready):(S.addEventListener("DOMContentLoaded",G),r.addEventListener("load",G));var F=function(e,t,r,n,i,s,o){var a=0,c=e.length,l=null==r;if("object"===T(r))for(a in i=!0,r)F(e,t,a,r[a],!0,s,o);else if(void 0!==n&&(i=!0,v(n)||(o=!0),l&&(o?(t.call(e,n),t=null):(l=t,t=function(e,t,r){return l.call(_(e),r)})),t))for(;a<c;a++)t(e[a],r,o?n:n.call(e[a],a,t(e[a],r)));return i?e:l?t.call(e):c?t(e[0],r):s},V=/^-ms-/,W=/-([a-z])/g;function J(e,t){return t.toUpperCase()}function Y(e){return e.replace(V,"ms-").replace(W,J)}var Q=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function $(){this.expando=_.expando+$.uid++}$.uid=1,$.prototype={cache:function(e){var t=e[this.expando];return t||(t=Object.create(null),Q(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,r){var n,i=this.cache(e);if("string"==typeof t)i[Y(t)]=r;else for(n in t)i[Y(n)]=t[n];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][Y(t)]},access:function(e,t,r){return void 0===t||t&&"string"==typeof t&&void 0===r?this.get(e,t):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,n=e[this.expando];if(void 0!==n){if(void 0!==t){r=(t=Array.isArray(t)?t.map(Y):(t=Y(t))in n?[t]:t.match(A)||[]).length;for(;r--;)delete n[t[r]]}(void 0===t||_.isEmptyObject(n))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!_.isEmptyObject(t)}};var X=new $,K=new $,Z=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,ee=/[A-Z]/g;function te(e,t,r){var n;if(void 0===r&&1===e.nodeType)if(n="data-"+t.replace(ee,"-$&").toLowerCase(),"string"==typeof(r=e.getAttribute(n))){try{r=function(e){return"true"===e||"false"!==e&&("null"===e?null:e===+e+""?+e:Z.test(e)?JSON.parse(e):e)}(r)}catch(e){}K.set(e,t,r)}else r=void 0;return r}_.extend({hasData:function(e){return K.hasData(e)||X.hasData(e)},data:function(e,t,r){return K.access(e,t,r)},removeData:function(e,t){K.remove(e,t)},_data:function(e,t,r){return X.access(e,t,r)},_removeData:function(e,t){X.remove(e,t)}}),_.fn.extend({data:function(e,t){var r,n,i,s=this[0],o=s&&s.attributes;if(void 0===e){if(this.length&&(i=K.get(s),1===s.nodeType&&!X.get(s,"hasDataAttrs"))){for(r=o.length;r--;)o[r]&&0===(n=o[r].name).indexOf("data-")&&(n=Y(n.slice(5)),te(s,n,i[n]));X.set(s,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each((function(){K.set(this,e)})):F(this,(function(t){var r;if(s&&void 0===t)return void 0!==(r=K.get(s,e))?r:void 0!==(r=te(s,e))?r:void 0;this.each((function(){K.set(this,e,t)}))}),null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each((function(){K.remove(this,e)}))}}),_.extend({queue:function(e,t,r){var n;if(e)return t=(t||"fx")+"queue",n=X.get(e,t),r&&(!n||Array.isArray(r)?n=X.access(e,t,_.makeArray(r)):n.push(r)),n||[]},dequeue:function(e,t){t=t||"fx";var r=_.queue(e,t),n=r.length,i=r.shift(),s=_._queueHooks(e,t);"inprogress"===i&&(i=r.shift(),n--),i&&("fx"===t&&r.unshift("inprogress"),delete s.stop,i.call(e,(function(){_.dequeue(e,t)}),s)),!n&&s&&s.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return X.get(e,r)||X.access(e,r,{empty:_.Callbacks("once memory").add((function(){X.remove(e,[t+"queue",r])}))})}}),_.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?_.queue(this[0],e):void 0===t?this:this.each((function(){var r=_.queue(this,e,t);_._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&_.dequeue(this,e)}))},dequeue:function(e){return this.each((function(){_.dequeue(this,e)}))},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,n=1,i=_.Deferred(),s=this,o=this.length,a=function(){--n||i.resolveWith(s,[s])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";o--;)(r=X.get(s[o],e+"queueHooks"))&&r.empty&&(n++,r.empty.add(a));return a(),i.promise(t)}});var re=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ne=new RegExp("^(?:([+-])=|)("+re+")([a-z%]*)$","i"),ie=["Top","Right","Bottom","Left"],se=S.documentElement,oe=function(e){return _.contains(e.ownerDocument,e)},ae={composed:!0};se.getRootNode&&(oe=function(e){return _.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var ce=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===_.css(e,"display")};function le(e,t,r,n){var i,s,o=20,a=n?function(){return n.cur()}:function(){return _.css(e,t,"")},c=a(),l=r&&r[3]||(_.cssNumber[t]?"":"px"),d=e.nodeType&&(_.cssNumber[t]||"px"!==l&&+c)&&ne.exec(_.css(e,t));if(d&&d[3]!==l){for(c/=2,l=l||d[3],d=+c||1;o--;)_.style(e,t,d+l),(1-s)*(1-(s=a()/c||.5))<=0&&(o=0),d/=s;d*=2,_.style(e,t,d+l),r=r||[]}return r&&(d=+d||+c||0,i=r[1]?d+(r[1]+1)*r[2]:+r[2],n&&(n.unit=l,n.start=d,n.end=i)),i}var de={};function ue(e){var t,r=e.ownerDocument,n=e.nodeName,i=de[n];return i||(t=r.body.appendChild(r.createElement(n)),i=_.css(t,"display"),t.parentNode.removeChild(t),"none"===i&&(i="block"),de[n]=i,i)}function he(e,t){for(var r,n,i=[],s=0,o=e.length;s<o;s++)(n=e[s]).style&&(r=n.style.display,t?("none"===r&&(i[s]=X.get(n,"display")||null,i[s]||(n.style.display="")),""===n.style.display&&ce(n)&&(i[s]=ue(n))):"none"!==r&&(i[s]="none",X.set(n,"display",r)));for(s=0;s<o;s++)null!=i[s]&&(e[s].style.display=i[s]);return e}_.fn.extend({show:function(){return he(this,!0)},hide:function(){return he(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each((function(){ce(this)?_(this).show():_(this).hide()}))}});var pe,fe,ge=/^(?:checkbox|radio)$/i,me=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,ve=/^$|^module$|\/(?:java|ecma)script/i;pe=S.createDocumentFragment().appendChild(S.createElement("div")),(fe=S.createElement("input")).setAttribute("type","radio"),fe.setAttribute("checked","checked"),fe.setAttribute("name","t"),pe.appendChild(fe),m.checkClone=pe.cloneNode(!0).cloneNode(!0).lastChild.checked,pe.innerHTML="<textarea>x</textarea>",m.noCloneChecked=!!pe.cloneNode(!0).lastChild.defaultValue,pe.innerHTML="<option></option>",m.option=!!pe.lastChild;var ye={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Se(e,t){var r;return r=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&P(e,t)?_.merge([e],r):r}function be(e,t){for(var r=0,n=e.length;r<n;r++)X.set(e[r],"globalEval",!t||X.get(t[r],"globalEval"))}ye.tbody=ye.tfoot=ye.colgroup=ye.caption=ye.thead,ye.th=ye.td,m.option||(ye.optgroup=ye.option=[1,"<select multiple='multiple'>","</select>"]);var Ce=/<|&#?\w+;/;function Te(e,t,r,n,i){for(var s,o,a,c,l,d,u=t.createDocumentFragment(),h=[],p=0,f=e.length;p<f;p++)if((s=e[p])||0===s)if("object"===T(s))_.merge(h,s.nodeType?[s]:s);else if(Ce.test(s)){for(o=o||u.appendChild(t.createElement("div")),a=(me.exec(s)||["",""])[1].toLowerCase(),c=ye[a]||ye._default,o.innerHTML=c[1]+_.htmlPrefilter(s)+c[2],d=c[0];d--;)o=o.lastChild;_.merge(h,o.childNodes),(o=u.firstChild).textContent=""}else h.push(t.createTextNode(s));for(u.textContent="",p=0;s=h[p++];)if(n&&_.inArray(s,n)>-1)i&&i.push(s);else if(l=oe(s),o=Se(u.appendChild(s),"script"),l&&be(o),r)for(d=0;s=o[d++];)ve.test(s.type||"")&&r.push(s);return u}var _e=/^key/,Ee=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Re=/^([^.]*)(?:\.(.+)|)/;function Le(){return!0}function we(){return!1}function Me(e,t){return e===function(){try{return S.activeElement}catch(e){}}()==("focus"===t)}function Pe(e,t,r,n,i,s){var o,a;if("object"==typeof t){for(a in"string"!=typeof r&&(n=n||r,r=void 0),t)Pe(e,a,r,n,t[a],s);return e}if(null==n&&null==i?(i=r,n=r=void 0):null==i&&("string"==typeof r?(i=n,n=void 0):(i=n,n=r,r=void 0)),!1===i)i=we;else if(!i)return e;return 1===s&&(o=i,(i=function(e){return _().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=_.guid++)),e.each((function(){_.event.add(this,t,i,n,r)}))}function ke(e,t,r){r?(X.set(e,t,!1),_.event.add(e,t,{namespace:!1,handler:function(e){var n,i,s=X.get(this,t);if(1&e.isTrigger&&this[t]){if(s.length)(_.event.special[t]||{}).delegateType&&e.stopPropagation();else if(s=a.call(arguments),X.set(this,t,s),n=r(this,t),this[t](),s!==(i=X.get(this,t))||n?X.set(this,t,!1):i={},s!==i)return e.stopImmediatePropagation(),e.preventDefault(),i.value}else s.length&&(X.set(this,t,{value:_.event.trigger(_.extend(s[0],_.Event.prototype),s.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===X.get(e,t)&&_.event.add(e,t,Le)}_.event={global:{},add:function(e,t,r,n,i){var s,o,a,c,l,d,u,h,p,f,g,m=X.get(e);if(Q(e))for(r.handler&&(r=(s=r).handler,i=s.selector),i&&_.find.matchesSelector(se,i),r.guid||(r.guid=_.guid++),(c=m.events)||(c=m.events=Object.create(null)),(o=m.handle)||(o=m.handle=function(t){return void 0!==_&&_.event.triggered!==t.type?_.event.dispatch.apply(e,arguments):void 0}),l=(t=(t||"").match(A)||[""]).length;l--;)p=g=(a=Re.exec(t[l])||[])[1],f=(a[2]||"").split(".").sort(),p&&(u=_.event.special[p]||{},p=(i?u.delegateType:u.bindType)||p,u=_.event.special[p]||{},d=_.extend({type:p,origType:g,data:n,handler:r,guid:r.guid,selector:i,needsContext:i&&_.expr.match.needsContext.test(i),namespace:f.join(".")},s),(h=c[p])||((h=c[p]=[]).delegateCount=0,u.setup&&!1!==u.setup.call(e,n,f,o)||e.addEventListener&&e.addEventListener(p,o)),u.add&&(u.add.call(e,d),d.handler.guid||(d.handler.guid=r.guid)),i?h.splice(h.delegateCount++,0,d):h.push(d),_.event.global[p]=!0)},remove:function(e,t,r,n,i){var s,o,a,c,l,d,u,h,p,f,g,m=X.hasData(e)&&X.get(e);if(m&&(c=m.events)){for(l=(t=(t||"").match(A)||[""]).length;l--;)if(p=g=(a=Re.exec(t[l])||[])[1],f=(a[2]||"").split(".").sort(),p){for(u=_.event.special[p]||{},h=c[p=(n?u.delegateType:u.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=s=h.length;s--;)d=h[s],!i&&g!==d.origType||r&&r.guid!==d.guid||a&&!a.test(d.namespace)||n&&n!==d.selector&&("**"!==n||!d.selector)||(h.splice(s,1),d.selector&&h.delegateCount--,u.remove&&u.remove.call(e,d));o&&!h.length&&(u.teardown&&!1!==u.teardown.call(e,f,m.handle)||_.removeEvent(e,p,m.handle),delete c[p])}else for(p in c)_.event.remove(e,p+t[l],r,n,!0);_.isEmptyObject(c)&&X.remove(e,"handle events")}},dispatch:function(e){var t,r,n,i,s,o,a=new Array(arguments.length),c=_.event.fix(e),l=(X.get(this,"events")||Object.create(null))[c.type]||[],d=_.event.special[c.type]||{};for(a[0]=c,t=1;t<arguments.length;t++)a[t]=arguments[t];if(c.delegateTarget=this,!d.preDispatch||!1!==d.preDispatch.call(this,c)){for(o=_.event.handlers.call(this,c,l),t=0;(i=o[t++])&&!c.isPropagationStopped();)for(c.currentTarget=i.elem,r=0;(s=i.handlers[r++])&&!c.isImmediatePropagationStopped();)c.rnamespace&&!1!==s.namespace&&!c.rnamespace.test(s.namespace)||(c.handleObj=s,c.data=s.data,void 0!==(n=((_.event.special[s.origType]||{}).handle||s.handler).apply(i.elem,a))&&!1===(c.result=n)&&(c.preventDefault(),c.stopPropagation()));return d.postDispatch&&d.postDispatch.call(this,c),c.result}},handlers:function(e,t){var r,n,i,s,o,a=[],c=t.delegateCount,l=e.target;if(c&&l.nodeType&&!("click"===e.type&&e.button>=1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(s=[],o={},r=0;r<c;r++)void 0===o[i=(n=t[r]).selector+" "]&&(o[i]=n.needsContext?_(i,this).index(l)>-1:_.find(i,this,null,[l]).length),o[i]&&s.push(n);s.length&&a.push({elem:l,handlers:s})}return l=this,c<t.length&&a.push({elem:l,handlers:t.slice(c)}),a},addProp:function(e,t){Object.defineProperty(_.Event.prototype,e,{enumerable:!0,configurable:!0,get:v(t)?function(){if(this.originalEvent)return t(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set:function(t){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:t})}})},fix:function(e){return e[_.expando]?e:new _.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return ge.test(t.type)&&t.click&&P(t,"input")&&ke(t,"click",Le),!1},trigger:function(e){var t=this||e;return ge.test(t.type)&&t.click&&P(t,"input")&&ke(t,"click"),!0},_default:function(e){var t=e.target;return ge.test(t.type)&&t.click&&P(t,"input")&&X.get(t,"click")||P(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},_.removeEvent=function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r)},_.Event=function(e,t){if(!(this instanceof _.Event))return new _.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Le:we,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&_.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[_.expando]=!0},_.Event.prototype={constructor:_.Event,isDefaultPrevented:we,isPropagationStopped:we,isImmediatePropagationStopped:we,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Le,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Le,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Le,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},_.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&_e.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ee.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},_.event.addProp),_.each({focus:"focusin",blur:"focusout"},(function(e,t){_.event.special[e]={setup:function(){return ke(this,e,Me),!1},trigger:function(){return ke(this,e),!0},delegateType:t}})),_.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(e,t){_.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,n=this,i=e.relatedTarget,s=e.handleObj;return i&&(i===n||_.contains(n,i))||(e.type=s.origType,r=s.handler.apply(this,arguments),e.type=t),r}}})),_.fn.extend({on:function(e,t,r,n){return Pe(this,e,t,r,n)},one:function(e,t,r,n){return Pe(this,e,t,r,n,1)},off:function(e,t,r){var n,i;if(e&&e.preventDefault&&e.handleObj)return n=e.handleObj,_(e.delegateTarget).off(n.namespace?n.origType+"."+n.namespace:n.origType,n.selector,n.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(r=t,t=void 0),!1===r&&(r=we),this.each((function(){_.event.remove(this,e,r,t)}))}});var Ie=/<script|<style|<link/i,xe=/checked\s*(?:[^=]|=\s*.checked.)/i,Ne=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Ue(e,t){return P(e,"table")&&P(11!==t.nodeType?t:t.firstChild,"tr")&&_(e).children("tbody")[0]||e}function De(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Oe(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Ae(e,t){var r,n,i,s,o,a;if(1===t.nodeType){if(X.hasData(e)&&(a=X.get(e).events))for(i in X.remove(t,"handle events"),a)for(r=0,n=a[i].length;r<n;r++)_.event.add(t,i,a[i][r]);K.hasData(e)&&(s=K.access(e),o=_.extend({},s),K.set(t,o))}}function ze(e,t){var r=t.nodeName.toLowerCase();"input"===r&&ge.test(e.type)?t.checked=e.checked:"input"!==r&&"textarea"!==r||(t.defaultValue=e.defaultValue)}function qe(e,t,r,n){t=c(t);var i,s,o,a,l,d,u=0,h=e.length,p=h-1,f=t[0],g=v(f);if(g||h>1&&"string"==typeof f&&!m.checkClone&&xe.test(f))return e.each((function(i){var s=e.eq(i);g&&(t[0]=f.call(this,i,s.html())),qe(s,t,r,n)}));if(h&&(s=(i=Te(t,e[0].ownerDocument,!1,e,n)).firstChild,1===i.childNodes.length&&(i=s),s||n)){for(a=(o=_.map(Se(i,"script"),De)).length;u<h;u++)l=i,u!==p&&(l=_.clone(l,!0,!0),a&&_.merge(o,Se(l,"script"))),r.call(e[u],l,u);if(a)for(d=o[o.length-1].ownerDocument,_.map(o,Oe),u=0;u<a;u++)l=o[u],ve.test(l.type||"")&&!X.access(l,"globalEval")&&_.contains(d,l)&&(l.src&&"module"!==(l.type||"").toLowerCase()?_._evalUrl&&!l.noModule&&_._evalUrl(l.src,{nonce:l.nonce||l.getAttribute("nonce")},d):C(l.textContent.replace(Ne,""),l,d))}return e}function He(e,t,r){for(var n,i=t?_.filter(t,e):e,s=0;null!=(n=i[s]);s++)r||1!==n.nodeType||_.cleanData(Se(n)),n.parentNode&&(r&&oe(n)&&be(Se(n,"script")),n.parentNode.removeChild(n));return e}_.extend({htmlPrefilter:function(e){return e},clone:function(e,t,r){var n,i,s,o,a=e.cloneNode(!0),c=oe(e);if(!(m.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||_.isXMLDoc(e)))for(o=Se(a),n=0,i=(s=Se(e)).length;n<i;n++)ze(s[n],o[n]);if(t)if(r)for(s=s||Se(e),o=o||Se(a),n=0,i=s.length;n<i;n++)Ae(s[n],o[n]);else Ae(e,a);return(o=Se(a,"script")).length>0&&be(o,!c&&Se(e,"script")),a},cleanData:function(e){for(var t,r,n,i=_.event.special,s=0;void 0!==(r=e[s]);s++)if(Q(r)){if(t=r[X.expando]){if(t.events)for(n in t.events)i[n]?_.event.remove(r,n):_.removeEvent(r,n,t.handle);r[X.expando]=void 0}r[K.expando]&&(r[K.expando]=void 0)}}}),_.fn.extend({detach:function(e){return He(this,e,!0)},remove:function(e){return He(this,e)},text:function(e){return F(this,(function(e){return void 0===e?_.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)}))}),null,e,arguments.length)},append:function(){return qe(this,arguments,(function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Ue(this,e).appendChild(e)}))},prepend:function(){return qe(this,arguments,(function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Ue(this,e);t.insertBefore(e,t.firstChild)}}))},before:function(){return qe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this)}))},after:function(){return qe(this,arguments,(function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)}))},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(_.cleanData(Se(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map((function(){return _.clone(this,e,t)}))},html:function(e){return F(this,(function(e){var t=this[0]||{},r=0,n=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!Ie.test(e)&&!ye[(me.exec(e)||["",""])[1].toLowerCase()]){e=_.htmlPrefilter(e);try{for(;r<n;r++)1===(t=this[r]||{}).nodeType&&(_.cleanData(Se(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)}),null,e,arguments.length)},replaceWith:function(){var e=[];return qe(this,arguments,(function(t){var r=this.parentNode;_.inArray(this,e)<0&&(_.cleanData(Se(this)),r&&r.replaceChild(t,this))}),e)}}),_.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(e,t){_.fn[e]=function(e){for(var r,n=[],i=_(e),s=i.length-1,o=0;o<=s;o++)r=o===s?this:this.clone(!0),_(i[o])[t](r),l.apply(n,r.get());return this.pushStack(n)}}));var je=new RegExp("^("+re+")(?!px)[a-z%]+$","i"),Be=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=r),t.getComputedStyle(e)},Ge=function(e,t,r){var n,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];for(i in n=r.call(e),t)e.style[i]=s[i];return n},Fe=new RegExp(ie.join("|"),"i");function Ve(e,t,r){var n,i,s,o,a=e.style;return(r=r||Be(e))&&(""!==(o=r.getPropertyValue(t)||r[t])||oe(e)||(o=_.style(e,t)),!m.pixelBoxStyles()&&je.test(o)&&Fe.test(t)&&(n=a.width,i=a.minWidth,s=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=r.width,a.width=n,a.minWidth=i,a.maxWidth=s)),void 0!==o?o+"":o}function We(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(d){l.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",d.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",se.appendChild(l).appendChild(d);var e=r.getComputedStyle(d);n="1%"!==e.top,c=12===t(e.marginLeft),d.style.right="60%",o=36===t(e.right),i=36===t(e.width),d.style.position="absolute",s=12===t(d.offsetWidth/3),se.removeChild(l),d=null}}function t(e){return Math.round(parseFloat(e))}var n,i,s,o,a,c,l=S.createElement("div"),d=S.createElement("div");d.style&&(d.style.backgroundClip="content-box",d.cloneNode(!0).style.backgroundClip="",m.clearCloneStyle="content-box"===d.style.backgroundClip,_.extend(m,{boxSizingReliable:function(){return e(),i},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),c},scrollboxSize:function(){return e(),s},reliableTrDimensions:function(){var e,t,n,i;return null==a&&(e=S.createElement("table"),t=S.createElement("tr"),n=S.createElement("div"),e.style.cssText="position:absolute;left:-11111px",t.style.height="1px",n.style.height="9px",se.appendChild(e).appendChild(t).appendChild(n),i=r.getComputedStyle(t),a=parseInt(i.height)>3,se.removeChild(e)),a}}))}();var Je=["Webkit","Moz","ms"],Ye=S.createElement("div").style,Qe={};function $e(e){var t=_.cssProps[e]||Qe[e];return t||(e in Ye?e:Qe[e]=function(e){for(var t=e[0].toUpperCase()+e.slice(1),r=Je.length;r--;)if((e=Je[r]+t)in Ye)return e}(e)||e)}var Xe=/^(none|table(?!-c[ea]).+)/,Ke=/^--/,Ze={position:"absolute",visibility:"hidden",display:"block"},et={letterSpacing:"0",fontWeight:"400"};function tt(e,t,r){var n=ne.exec(t);return n?Math.max(0,n[2]-(r||0))+(n[3]||"px"):t}function rt(e,t,r,n,i,s){var o="width"===t?1:0,a=0,c=0;if(r===(n?"border":"content"))return 0;for(;o<4;o+=2)"margin"===r&&(c+=_.css(e,r+ie[o],!0,i)),n?("content"===r&&(c-=_.css(e,"padding"+ie[o],!0,i)),"margin"!==r&&(c-=_.css(e,"border"+ie[o]+"Width",!0,i))):(c+=_.css(e,"padding"+ie[o],!0,i),"padding"!==r?c+=_.css(e,"border"+ie[o]+"Width",!0,i):a+=_.css(e,"border"+ie[o]+"Width",!0,i));return!n&&s>=0&&(c+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-s-c-a-.5))||0),c}function nt(e,t,r){var n=Be(e),i=(!m.boxSizingReliable()||r)&&"border-box"===_.css(e,"boxSizing",!1,n),s=i,o=Ve(e,t,n),a="offset"+t[0].toUpperCase()+t.slice(1);if(je.test(o)){if(!r)return o;o="auto"}return(!m.boxSizingReliable()&&i||!m.reliableTrDimensions()&&P(e,"tr")||"auto"===o||!parseFloat(o)&&"inline"===_.css(e,"display",!1,n))&&e.getClientRects().length&&(i="border-box"===_.css(e,"boxSizing",!1,n),(s=a in e)&&(o=e[a])),(o=parseFloat(o)||0)+rt(e,t,r||(i?"border":"content"),s,n,o)+"px"}function it(e,t,r,n,i){return new it.prototype.init(e,t,r,n,i)}_.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=Ve(e,"opacity");return""===r?"1":r}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,r,n){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,s,o,a=Y(t),c=Ke.test(t),l=e.style;if(c||(t=$e(a)),o=_.cssHooks[t]||_.cssHooks[a],void 0===r)return o&&"get"in o&&void 0!==(i=o.get(e,!1,n))?i:l[t];"string"===(s=typeof r)&&(i=ne.exec(r))&&i[1]&&(r=le(e,t,i),s="number"),null!=r&&r==r&&("number"!==s||c||(r+=i&&i[3]||(_.cssNumber[a]?"":"px")),m.clearCloneStyle||""!==r||0!==t.indexOf("background")||(l[t]="inherit"),o&&"set"in o&&void 0===(r=o.set(e,r,n))||(c?l.setProperty(t,r):l[t]=r))}},css:function(e,t,r,n){var i,s,o,a=Y(t);return Ke.test(t)||(t=$e(a)),(o=_.cssHooks[t]||_.cssHooks[a])&&"get"in o&&(i=o.get(e,!0,r)),void 0===i&&(i=Ve(e,t,n)),"normal"===i&&t in et&&(i=et[t]),""===r||r?(s=parseFloat(i),!0===r||isFinite(s)?s||0:i):i}}),_.each(["height","width"],(function(e,t){_.cssHooks[t]={get:function(e,r,n){if(r)return!Xe.test(_.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?nt(e,t,n):Ge(e,Ze,(function(){return nt(e,t,n)}))},set:function(e,r,n){var i,s=Be(e),o=!m.scrollboxSize()&&"absolute"===s.position,a=(o||n)&&"border-box"===_.css(e,"boxSizing",!1,s),c=n?rt(e,t,n,a,s):0;return a&&o&&(c-=Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-parseFloat(s[t])-rt(e,t,"border",!1,s)-.5)),c&&(i=ne.exec(r))&&"px"!==(i[3]||"px")&&(e.style[t]=r,r=_.css(e,t)),tt(0,r,c)}}})),_.cssHooks.marginLeft=We(m.reliableMarginLeft,(function(e,t){if(t)return(parseFloat(Ve(e,"marginLeft"))||e.getBoundingClientRect().left-Ge(e,{marginLeft:0},(function(){return e.getBoundingClientRect().left})))+"px"})),_.each({margin:"",padding:"",border:"Width"},(function(e,t){_.cssHooks[e+t]={expand:function(r){for(var n=0,i={},s="string"==typeof r?r.split(" "):[r];n<4;n++)i[e+ie[n]+t]=s[n]||s[n-2]||s[0];return i}},"margin"!==e&&(_.cssHooks[e+t].set=tt)})),_.fn.extend({css:function(e,t){return F(this,(function(e,t,r){var n,i,s={},o=0;if(Array.isArray(t)){for(n=Be(e),i=t.length;o<i;o++)s[t[o]]=_.css(e,t[o],!1,n);return s}return void 0!==r?_.style(e,t,r):_.css(e,t)}),e,t,arguments.length>1)}}),_.Tween=it,it.prototype={constructor:it,init:function(e,t,r,n,i,s){this.elem=e,this.prop=r,this.easing=i||_.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=s||(_.cssNumber[r]?"":"px")},cur:function(){var e=it.propHooks[this.prop];return e&&e.get?e.get(this):it.propHooks._default.get(this)},run:function(e){var t,r=it.propHooks[this.prop];return this.options.duration?this.pos=t=_.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):it.propHooks._default.set(this),this}},it.prototype.init.prototype=it.prototype,it.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=_.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){_.fx.step[e.prop]?_.fx.step[e.prop](e):1!==e.elem.nodeType||!_.cssHooks[e.prop]&&null==e.elem.style[$e(e.prop)]?e.elem[e.prop]=e.now:_.style(e.elem,e.prop,e.now+e.unit)}}},it.propHooks.scrollTop=it.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},_.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},_.fx=it.prototype.init,_.fx.step={};var st,ot,at=/^(?:toggle|show|hide)$/,ct=/queueHooks$/;function lt(){ot&&(!1===S.hidden&&r.requestAnimationFrame?r.requestAnimationFrame(lt):r.setTimeout(lt,_.fx.interval),_.fx.tick())}function dt(){return r.setTimeout((function(){st=void 0})),st=Date.now()}function ut(e,t){var r,n=0,i={height:e};for(t=t?1:0;n<4;n+=2-t)i["margin"+(r=ie[n])]=i["padding"+r]=e;return t&&(i.opacity=i.width=e),i}function ht(e,t,r){for(var n,i=(pt.tweeners[t]||[]).concat(pt.tweeners["*"]),s=0,o=i.length;s<o;s++)if(n=i[s].call(r,t,e))return n}function pt(e,t,r){var n,i,s=0,o=pt.prefilters.length,a=_.Deferred().always((function(){delete c.elem})),c=function(){if(i)return!1;for(var t=st||dt(),r=Math.max(0,l.startTime+l.duration-t),n=1-(r/l.duration||0),s=0,o=l.tweens.length;s<o;s++)l.tweens[s].run(n);return a.notifyWith(e,[l,n,r]),n<1&&o?r:(o||a.notifyWith(e,[l,1,0]),a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:_.extend({},t),opts:_.extend(!0,{specialEasing:{},easing:_.easing._default},r),originalProperties:t,originalOptions:r,startTime:st||dt(),duration:r.duration,tweens:[],createTween:function(t,r){var n=_.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(n),n},stop:function(t){var r=0,n=t?l.tweens.length:0;if(i)return this;for(i=!0;r<n;r++)l.tweens[r].run(1);return t?(a.notifyWith(e,[l,1,0]),a.resolveWith(e,[l,t])):a.rejectWith(e,[l,t]),this}}),d=l.props;for(!function(e,t){var r,n,i,s,o;for(r in e)if(i=t[n=Y(r)],s=e[r],Array.isArray(s)&&(i=s[1],s=e[r]=s[0]),r!==n&&(e[n]=s,delete e[r]),(o=_.cssHooks[n])&&"expand"in o)for(r in s=o.expand(s),delete e[n],s)r in e||(e[r]=s[r],t[r]=i);else t[n]=i}(d,l.opts.specialEasing);s<o;s++)if(n=pt.prefilters[s].call(l,e,d,l.opts))return v(n.stop)&&(_._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return _.map(d,ht,l),v(l.opts.start)&&l.opts.start.call(e,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),_.fx.timer(_.extend(c,{elem:e,anim:l,queue:l.opts.queue})),l}_.Animation=_.extend(pt,{tweeners:{"*":[function(e,t){var r=this.createTween(e,t);return le(r.elem,e,ne.exec(t),r),r}]},tweener:function(e,t){v(e)?(t=e,e=["*"]):e=e.match(A);for(var r,n=0,i=e.length;n<i;n++)r=e[n],pt.tweeners[r]=pt.tweeners[r]||[],pt.tweeners[r].unshift(t)},prefilters:[function(e,t,r){var n,i,s,o,a,c,l,d,u="width"in t||"height"in t,h=this,p={},f=e.style,g=e.nodeType&&ce(e),m=X.get(e,"fxshow");for(n in r.queue||(null==(o=_._queueHooks(e,"fx")).unqueued&&(o.unqueued=0,a=o.empty.fire,o.empty.fire=function(){o.unqueued||a()}),o.unqueued++,h.always((function(){h.always((function(){o.unqueued--,_.queue(e,"fx").length||o.empty.fire()}))}))),t)if(i=t[n],at.test(i)){if(delete t[n],s=s||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!m||void 0===m[n])continue;g=!0}p[n]=m&&m[n]||_.style(e,n)}if((c=!_.isEmptyObject(t))||!_.isEmptyObject(p))for(n in u&&1===e.nodeType&&(r.overflow=[f.overflow,f.overflowX,f.overflowY],null==(l=m&&m.display)&&(l=X.get(e,"display")),"none"===(d=_.css(e,"display"))&&(l?d=l:(he([e],!0),l=e.style.display||l,d=_.css(e,"display"),he([e]))),("inline"===d||"inline-block"===d&&null!=l)&&"none"===_.css(e,"float")&&(c||(h.done((function(){f.display=l})),null==l&&(d=f.display,l="none"===d?"":d)),f.display="inline-block")),r.overflow&&(f.overflow="hidden",h.always((function(){f.overflow=r.overflow[0],f.overflowX=r.overflow[1],f.overflowY=r.overflow[2]}))),c=!1,p)c||(m?"hidden"in m&&(g=m.hidden):m=X.access(e,"fxshow",{display:l}),s&&(m.hidden=!g),g&&he([e],!0),h.done((function(){for(n in g||he([e]),X.remove(e,"fxshow"),p)_.style(e,n,p[n])}))),c=ht(g?m[n]:0,n,h),n in m||(m[n]=c.start,g&&(c.end=c.start,c.start=0))}],prefilter:function(e,t){t?pt.prefilters.unshift(e):pt.prefilters.push(e)}}),_.speed=function(e,t,r){var n=e&&"object"==typeof e?_.extend({},e):{complete:r||!r&&t||v(e)&&e,duration:e,easing:r&&t||t&&!v(t)&&t};return _.fx.off?n.duration=0:"number"!=typeof n.duration&&(n.duration in _.fx.speeds?n.duration=_.fx.speeds[n.duration]:n.duration=_.fx.speeds._default),null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){v(n.old)&&n.old.call(this),n.queue&&_.dequeue(this,n.queue)},n},_.fn.extend({fadeTo:function(e,t,r,n){return this.filter(ce).css("opacity",0).show().end().animate({opacity:t},e,r,n)},animate:function(e,t,r,n){var i=_.isEmptyObject(e),s=_.speed(t,r,n),o=function(){var t=pt(this,_.extend({},e),s);(i||X.get(this,"finish"))&&t.stop(!0)};return o.finish=o,i||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,t,r){var n=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&this.queue(e||"fx",[]),this.each((function(){var t=!0,i=null!=e&&e+"queueHooks",s=_.timers,o=X.get(this);if(i)o[i]&&o[i].stop&&n(o[i]);else for(i in o)o[i]&&o[i].stop&&ct.test(i)&&n(o[i]);for(i=s.length;i--;)s[i].elem!==this||null!=e&&s[i].queue!==e||(s[i].anim.stop(r),t=!1,s.splice(i,1));!t&&r||_.dequeue(this,e)}))},finish:function(e){return!1!==e&&(e=e||"fx"),this.each((function(){var t,r=X.get(this),n=r[e+"queue"],i=r[e+"queueHooks"],s=_.timers,o=n?n.length:0;for(r.finish=!0,_.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;t<o;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete r.finish}))}}),_.each(["toggle","show","hide"],(function(e,t){var r=_.fn[t];_.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(ut(t,!0),e,n,i)}})),_.each({slideDown:ut("show"),slideUp:ut("hide"),slideToggle:ut("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(e,t){_.fn[e]=function(e,r,n){return this.animate(t,e,r,n)}})),_.timers=[],_.fx.tick=function(){var e,t=0,r=_.timers;for(st=Date.now();t<r.length;t++)(e=r[t])()||r[t]!==e||r.splice(t--,1);r.length||_.fx.stop(),st=void 0},_.fx.timer=function(e){_.timers.push(e),_.fx.start()},_.fx.interval=13,_.fx.start=function(){ot||(ot=!0,lt())},_.fx.stop=function(){ot=null},_.fx.speeds={slow:600,fast:200,_default:400},_.fn.delay=function(e,t){return e=_.fx&&_.fx.speeds[e]||e,t=t||"fx",this.queue(t,(function(t,n){var i=r.setTimeout(t,e);n.stop=function(){r.clearTimeout(i)}}))},function(){var e=S.createElement("input"),t=S.createElement("select").appendChild(S.createElement("option"));e.type="checkbox",m.checkOn=""!==e.value,m.optSelected=t.selected,(e=S.createElement("input")).value="t",e.type="radio",m.radioValue="t"===e.value}();var ft,gt=_.expr.attrHandle;_.fn.extend({attr:function(e,t){return F(this,_.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each((function(){_.removeAttr(this,e)}))}}),_.extend({attr:function(e,t,r){var n,i,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return void 0===e.getAttribute?_.prop(e,t,r):(1===s&&_.isXMLDoc(e)||(i=_.attrHooks[t.toLowerCase()]||(_.expr.match.bool.test(t)?ft:void 0)),void 0!==r?null===r?void _.removeAttr(e,t):i&&"set"in i&&void 0!==(n=i.set(e,r,t))?n:(e.setAttribute(t,r+""),r):i&&"get"in i&&null!==(n=i.get(e,t))?n:null==(n=_.find.attr(e,t))?void 0:n)},attrHooks:{type:{set:function(e,t){if(!m.radioValue&&"radio"===t&&P(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}},removeAttr:function(e,t){var r,n=0,i=t&&t.match(A);if(i&&1===e.nodeType)for(;r=i[n++];)e.removeAttribute(r)}}),ft={set:function(e,t,r){return!1===t?_.removeAttr(e,r):e.setAttribute(r,r),r}},_.each(_.expr.match.bool.source.match(/\w+/g),(function(e,t){var r=gt[t]||_.find.attr;gt[t]=function(e,t,n){var i,s,o=t.toLowerCase();return n||(s=gt[o],gt[o]=i,i=null!=r(e,t,n)?o:null,gt[o]=s),i}}));var mt=/^(?:input|select|textarea|button)$/i,vt=/^(?:a|area)$/i;function yt(e){return(e.match(A)||[]).join(" ")}function St(e){return e.getAttribute&&e.getAttribute("class")||""}function bt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(A)||[]}_.fn.extend({prop:function(e,t){return F(this,_.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each((function(){delete this[_.propFix[e]||e]}))}}),_.extend({prop:function(e,t,r){var n,i,s=e.nodeType;if(3!==s&&8!==s&&2!==s)return 1===s&&_.isXMLDoc(e)||(t=_.propFix[t]||t,i=_.propHooks[t]),void 0!==r?i&&"set"in i&&void 0!==(n=i.set(e,r,t))?n:e[t]=r:i&&"get"in i&&null!==(n=i.get(e,t))?n:e[t]},propHooks:{tabIndex:{get:function(e){var t=_.find.attr(e,"tabindex");return t?parseInt(t,10):mt.test(e.nodeName)||vt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),m.optSelected||(_.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),_.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){_.propFix[this.toLowerCase()]=this})),_.fn.extend({addClass:function(e){var t,r,n,i,s,o,a,c=0;if(v(e))return this.each((function(t){_(this).addClass(e.call(this,t,St(this)))}));if((t=bt(e)).length)for(;r=this[c++];)if(i=St(r),n=1===r.nodeType&&" "+yt(i)+" "){for(o=0;s=t[o++];)n.indexOf(" "+s+" ")<0&&(n+=s+" ");i!==(a=yt(n))&&r.setAttribute("class",a)}return this},removeClass:function(e){var t,r,n,i,s,o,a,c=0;if(v(e))return this.each((function(t){_(this).removeClass(e.call(this,t,St(this)))}));if(!arguments.length)return this.attr("class","");if((t=bt(e)).length)for(;r=this[c++];)if(i=St(r),n=1===r.nodeType&&" "+yt(i)+" "){for(o=0;s=t[o++];)for(;n.indexOf(" "+s+" ")>-1;)n=n.replace(" "+s+" "," ");i!==(a=yt(n))&&r.setAttribute("class",a)}return this},toggleClass:function(e,t){var r=typeof e,n="string"===r||Array.isArray(e);return"boolean"==typeof t&&n?t?this.addClass(e):this.removeClass(e):v(e)?this.each((function(r){_(this).toggleClass(e.call(this,r,St(this),t),t)})):this.each((function(){var t,i,s,o;if(n)for(i=0,s=_(this),o=bt(e);t=o[i++];)s.hasClass(t)?s.removeClass(t):s.addClass(t);else void 0!==e&&"boolean"!==r||((t=St(this))&&X.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":X.get(this,"__className__")||""))}))},hasClass:function(e){var t,r,n=0;for(t=" "+e+" ";r=this[n++];)if(1===r.nodeType&&(" "+yt(St(r))+" ").indexOf(t)>-1)return!0;return!1}});var Ct=/\r/g;_.fn.extend({val:function(e){var t,r,n,i=this[0];return arguments.length?(n=v(e),this.each((function(r){var i;1===this.nodeType&&(null==(i=n?e.call(this,r,_(this).val()):e)?i="":"number"==typeof i?i+="":Array.isArray(i)&&(i=_.map(i,(function(e){return null==e?"":e+""}))),(t=_.valHooks[this.type]||_.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))}))):i?(t=_.valHooks[i.type]||_.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(r=t.get(i,"value"))?r:"string"==typeof(r=i.value)?r.replace(Ct,""):null==r?"":r:void 0}}),_.extend({valHooks:{option:{get:function(e){var t=_.find.attr(e,"value");return null!=t?t:yt(_.text(e))}},select:{get:function(e){var t,r,n,i=e.options,s=e.selectedIndex,o="select-one"===e.type,a=o?null:[],c=o?s+1:i.length;for(n=s<0?c:o?s:0;n<c;n++)if(((r=i[n]).selected||n===s)&&!r.disabled&&(!r.parentNode.disabled||!P(r.parentNode,"optgroup"))){if(t=_(r).val(),o)return t;a.push(t)}return a},set:function(e,t){for(var r,n,i=e.options,s=_.makeArray(t),o=i.length;o--;)((n=i[o]).selected=_.inArray(_.valHooks.option.get(n),s)>-1)&&(r=!0);return r||(e.selectedIndex=-1),s}}}}),_.each(["radio","checkbox"],(function(){_.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=_.inArray(_(e).val(),t)>-1}},m.checkOn||(_.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})})),m.focusin="onfocusin"in r;var Tt=/^(?:focusinfocus|focusoutblur)$/,_t=function(e){e.stopPropagation()};_.extend(_.event,{trigger:function(e,t,n,i){var s,o,a,c,l,d,u,h,f=[n||S],g=p.call(e,"type")?e.type:e,m=p.call(e,"namespace")?e.namespace.split("."):[];if(o=h=a=n=n||S,3!==n.nodeType&&8!==n.nodeType&&!Tt.test(g+_.event.triggered)&&(g.indexOf(".")>-1&&(m=g.split("."),g=m.shift(),m.sort()),l=g.indexOf(":")<0&&"on"+g,(e=e[_.expando]?e:new _.Event(g,"object"==typeof e&&e)).isTrigger=i?2:3,e.namespace=m.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:_.makeArray(t,[e]),u=_.event.special[g]||{},i||!u.trigger||!1!==u.trigger.apply(n,t))){if(!i&&!u.noBubble&&!y(n)){for(c=u.delegateType||g,Tt.test(c+g)||(o=o.parentNode);o;o=o.parentNode)f.push(o),a=o;a===(n.ownerDocument||S)&&f.push(a.defaultView||a.parentWindow||r)}for(s=0;(o=f[s++])&&!e.isPropagationStopped();)h=o,e.type=s>1?c:u.bindType||g,(d=(X.get(o,"events")||Object.create(null))[e.type]&&X.get(o,"handle"))&&d.apply(o,t),(d=l&&o[l])&&d.apply&&Q(o)&&(e.result=d.apply(o,t),!1===e.result&&e.preventDefault());return e.type=g,i||e.isDefaultPrevented()||u._default&&!1!==u._default.apply(f.pop(),t)||!Q(n)||l&&v(n[g])&&!y(n)&&((a=n[l])&&(n[l]=null),_.event.triggered=g,e.isPropagationStopped()&&h.addEventListener(g,_t),n[g](),e.isPropagationStopped()&&h.removeEventListener(g,_t),_.event.triggered=void 0,a&&(n[l]=a)),e.result}},simulate:function(e,t,r){var n=_.extend(new _.Event,r,{type:e,isSimulated:!0});_.event.trigger(n,null,t)}}),_.fn.extend({trigger:function(e,t){return this.each((function(){_.event.trigger(e,t,this)}))},triggerHandler:function(e,t){var r=this[0];if(r)return _.event.trigger(e,t,r,!0)}}),m.focusin||_.each({focus:"focusin",blur:"focusout"},(function(e,t){var r=function(e){_.event.simulate(t,e.target,_.event.fix(e))};_.event.special[t]={setup:function(){var n=this.ownerDocument||this.document||this,i=X.access(n,t);i||n.addEventListener(e,r,!0),X.access(n,t,(i||0)+1)},teardown:function(){var n=this.ownerDocument||this.document||this,i=X.access(n,t)-1;i?X.access(n,t,i):(n.removeEventListener(e,r,!0),X.remove(n,t))}}}));var Et=r.location,Rt={guid:Date.now()},Lt=/\?/;_.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new r.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||_.error("Invalid XML: "+e),t};var wt=/\[\]$/,Mt=/\r?\n/g,Pt=/^(?:submit|button|image|reset|file)$/i,kt=/^(?:input|select|textarea|keygen)/i;function It(e,t,r,n){var i;if(Array.isArray(t))_.each(t,(function(t,i){r||wt.test(e)?n(e,i):It(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,r,n)}));else if(r||"object"!==T(t))n(e,t);else for(i in t)It(e+"["+i+"]",t[i],r,n)}_.param=function(e,t){var r,n=[],i=function(e,t){var r=v(t)?t():t;n[n.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==r?"":r)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!_.isPlainObject(e))_.each(e,(function(){i(this.name,this.value)}));else for(r in e)It(r,e[r],t,i);return n.join("&")},_.fn.extend({serialize:function(){return _.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var e=_.prop(this,"elements");return e?_.makeArray(e):this})).filter((function(){var e=this.type;return this.name&&!_(this).is(":disabled")&&kt.test(this.nodeName)&&!Pt.test(e)&&(this.checked||!ge.test(e))})).map((function(e,t){var r=_(this).val();return null==r?null:Array.isArray(r)?_.map(r,(function(e){return{name:t.name,value:e.replace(Mt,"\r\n")}})):{name:t.name,value:r.replace(Mt,"\r\n")}})).get()}});var xt=/%20/g,Nt=/#.*$/,Ut=/([?&])_=[^&]*/,Dt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Ot=/^(?:GET|HEAD)$/,At=/^\/\//,zt={},qt={},Ht="*/".concat("*"),jt=S.createElement("a");function Bt(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var n,i=0,s=t.toLowerCase().match(A)||[];if(v(r))for(;n=s[i++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(r)):(e[n]=e[n]||[]).push(r)}}function Gt(e,t,r,n){var i={},s=e===qt;function o(a){var c;return i[a]=!0,_.each(e[a]||[],(function(e,a){var l=a(t,r,n);return"string"!=typeof l||s||i[l]?s?!(c=l):void 0:(t.dataTypes.unshift(l),o(l),!1)})),c}return o(t.dataTypes[0])||!i["*"]&&o("*")}function Ft(e,t){var r,n,i=_.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((i[r]?e:n||(n={}))[r]=t[r]);return n&&_.extend(!0,e,n),e}jt.href=Et.href,_.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ht,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":_.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Ft(Ft(e,_.ajaxSettings),t):Ft(_.ajaxSettings,e)},ajaxPrefilter:Bt(zt),ajaxTransport:Bt(qt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,i,s,o,a,c,l,d,u,h,p=_.ajaxSetup({},t),f=p.context||p,g=p.context&&(f.nodeType||f.jquery)?_(f):_.event,m=_.Deferred(),v=_.Callbacks("once memory"),y=p.statusCode||{},b={},C={},T="canceled",E={readyState:0,getResponseHeader:function(e){var t;if(l){if(!o)for(o={};t=Dt.exec(s);)o[t[1].toLowerCase()+" "]=(o[t[1].toLowerCase()+" "]||[]).concat(t[2]);t=o[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return l?s:null},setRequestHeader:function(e,t){return null==l&&(e=C[e.toLowerCase()]=C[e.toLowerCase()]||e,b[e]=t),this},overrideMimeType:function(e){return null==l&&(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(l)E.always(e[E.status]);else for(t in e)y[t]=[y[t],e[t]];return this},abort:function(e){var t=e||T;return n&&n.abort(t),R(0,t),this}};if(m.promise(E),p.url=((e||p.url||Et.href)+"").replace(At,Et.protocol+"//"),p.type=t.method||t.type||p.method||p.type,p.dataTypes=(p.dataType||"*").toLowerCase().match(A)||[""],null==p.crossDomain){c=S.createElement("a");try{c.href=p.url,c.href=c.href,p.crossDomain=jt.protocol+"//"+jt.host!=c.protocol+"//"+c.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=_.param(p.data,p.traditional)),Gt(zt,p,t,E),l)return E;for(u in(d=_.event&&p.global)&&0==_.active++&&_.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!Ot.test(p.type),i=p.url.replace(Nt,""),p.hasContent?p.data&&p.processData&&0===(p.contentType||"").indexOf("application/x-www-form-urlencoded")&&(p.data=p.data.replace(xt,"+")):(h=p.url.slice(i.length),p.data&&(p.processData||"string"==typeof p.data)&&(i+=(Lt.test(i)?"&":"?")+p.data,delete p.data),!1===p.cache&&(i=i.replace(Ut,"$1"),h=(Lt.test(i)?"&":"?")+"_="+Rt.guid+++h),p.url=i+h),p.ifModified&&(_.lastModified[i]&&E.setRequestHeader("If-Modified-Since",_.lastModified[i]),_.etag[i]&&E.setRequestHeader("If-None-Match",_.etag[i])),(p.data&&p.hasContent&&!1!==p.contentType||t.contentType)&&E.setRequestHeader("Content-Type",p.contentType),E.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Ht+"; q=0.01":""):p.accepts["*"]),p.headers)E.setRequestHeader(u,p.headers[u]);if(p.beforeSend&&(!1===p.beforeSend.call(f,E,p)||l))return E.abort();if(T="abort",v.add(p.complete),E.done(p.success),E.fail(p.error),n=Gt(qt,p,t,E)){if(E.readyState=1,d&&g.trigger("ajaxSend",[E,p]),l)return E;p.async&&p.timeout>0&&(a=r.setTimeout((function(){E.abort("timeout")}),p.timeout));try{l=!1,n.send(b,R)}catch(e){if(l)throw e;R(-1,e)}}else R(-1,"No Transport");function R(e,t,o,c){var u,h,S,b,C,T=t;l||(l=!0,a&&r.clearTimeout(a),n=void 0,s=c||"",E.readyState=e>0?4:0,u=e>=200&&e<300||304===e,o&&(b=function(e,t,r){for(var n,i,s,o,a=e.contents,c=e.dataTypes;"*"===c[0];)c.shift(),void 0===n&&(n=e.mimeType||t.getResponseHeader("Content-Type"));if(n)for(i in a)if(a[i]&&a[i].test(n)){c.unshift(i);break}if(c[0]in r)s=c[0];else{for(i in r){if(!c[0]||e.converters[i+" "+c[0]]){s=i;break}o||(o=i)}s=s||o}if(s)return s!==c[0]&&c.unshift(s),r[s]}(p,E,o)),!u&&_.inArray("script",p.dataTypes)>-1&&(p.converters["text script"]=function(){}),b=function(e,t,r,n){var i,s,o,a,c,l={},d=e.dataTypes.slice();if(d[1])for(o in e.converters)l[o.toLowerCase()]=e.converters[o];for(s=d.shift();s;)if(e.responseFields[s]&&(r[e.responseFields[s]]=t),!c&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),c=s,s=d.shift())if("*"===s)s=c;else if("*"!==c&&c!==s){if(!(o=l[c+" "+s]||l["* "+s]))for(i in l)if((a=i.split(" "))[1]===s&&(o=l[c+" "+a[0]]||l["* "+a[0]])){!0===o?o=l[i]:!0!==l[i]&&(s=a[0],d.unshift(a[1]));break}if(!0!==o)if(o&&e.throws)t=o(t);else try{t=o(t)}catch(e){return{state:"parsererror",error:o?e:"No conversion from "+c+" to "+s}}}return{state:"success",data:t}}(p,b,E,u),u?(p.ifModified&&((C=E.getResponseHeader("Last-Modified"))&&(_.lastModified[i]=C),(C=E.getResponseHeader("etag"))&&(_.etag[i]=C)),204===e||"HEAD"===p.type?T="nocontent":304===e?T="notmodified":(T=b.state,h=b.data,u=!(S=b.error))):(S=T,!e&&T||(T="error",e<0&&(e=0))),E.status=e,E.statusText=(t||T)+"",u?m.resolveWith(f,[h,T,E]):m.rejectWith(f,[E,T,S]),E.statusCode(y),y=void 0,d&&g.trigger(u?"ajaxSuccess":"ajaxError",[E,p,u?h:S]),v.fireWith(f,[E,T]),d&&(g.trigger("ajaxComplete",[E,p]),--_.active||_.event.trigger("ajaxStop")))}return E},getJSON:function(e,t,r){return _.get(e,t,r,"json")},getScript:function(e,t){return _.get(e,void 0,t,"script")}}),_.each(["get","post"],(function(e,t){_[t]=function(e,r,n,i){return v(r)&&(i=i||n,n=r,r=void 0),_.ajax(_.extend({url:e,type:t,dataType:i,data:r,success:n},_.isPlainObject(e)&&e))}})),_.ajaxPrefilter((function(e){var t;for(t in e.headers)"content-type"===t.toLowerCase()&&(e.contentType=e.headers[t]||"")})),_._evalUrl=function(e,t,r){return _.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){_.globalEval(e,t,r)}})},_.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=_(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map((function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e})).append(this)),this},wrapInner:function(e){return v(e)?this.each((function(t){_(this).wrapInner(e.call(this,t))})):this.each((function(){var t=_(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)}))},wrap:function(e){var t=v(e);return this.each((function(r){_(this).wrapAll(t?e.call(this,r):e)}))},unwrap:function(e){return this.parent(e).not("body").each((function(){_(this).replaceWith(this.childNodes)})),this}}),_.expr.pseudos.hidden=function(e){return!_.expr.pseudos.visible(e)},_.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},_.ajaxSettings.xhr=function(){try{return new r.XMLHttpRequest}catch(e){}};var Vt={0:200,1223:204},Wt=_.ajaxSettings.xhr();m.cors=!!Wt&&"withCredentials"in Wt,m.ajax=Wt=!!Wt,_.ajaxTransport((function(e){var t,n;if(m.cors||Wt&&!e.crossDomain)return{send:function(i,s){var o,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];for(o in e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest"),i)a.setRequestHeader(o,i[o]);t=function(e){return function(){t&&(t=n=a.onload=a.onerror=a.onabort=a.ontimeout=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?s(0,"error"):s(a.status,a.statusText):s(Vt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=t(),n=a.onerror=a.ontimeout=t("error"),void 0!==a.onabort?a.onabort=n:a.onreadystatechange=function(){4===a.readyState&&r.setTimeout((function(){t&&n()}))},t=t("abort");try{a.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}})),_.ajaxPrefilter((function(e){e.crossDomain&&(e.contents.script=!1)})),_.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return _.globalEval(e),e}}}),_.ajaxPrefilter("script",(function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")})),_.ajaxTransport("script",(function(e){var t,r;if(e.crossDomain||e.scriptAttrs)return{send:function(n,i){t=_("<script>").attr(e.scriptAttrs||{}).prop({charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&i("error"===e.type?404:200,e.type)}),S.head.appendChild(t[0])},abort:function(){r&&r()}}}));var Jt,Yt=[],Qt=/(=)\?(?=&|$)|\?\?/;_.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Yt.pop()||_.expando+"_"+Rt.guid++;return this[e]=!0,e}}),_.ajaxPrefilter("json jsonp",(function(e,t,n){var i,s,o,a=!1!==e.jsonp&&(Qt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Qt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return i=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Qt,"$1"+i):!1!==e.jsonp&&(e.url+=(Lt.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||_.error(i+" was not called"),o[0]},e.dataTypes[0]="json",s=r[i],r[i]=function(){o=arguments},n.always((function(){void 0===s?_(r).removeProp(i):r[i]=s,e[i]&&(e.jsonpCallback=t.jsonpCallback,Yt.push(i)),o&&v(s)&&s(o[0]),o=s=void 0})),"script"})),m.createHTMLDocument=((Jt=S.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Jt.childNodes.length),_.parseHTML=function(e,t,r){return"string"!=typeof e?[]:("boolean"==typeof t&&(r=t,t=!1),t||(m.createHTMLDocument?((n=(t=S.implementation.createHTMLDocument("")).createElement("base")).href=S.location.href,t.head.appendChild(n)):t=S),s=!r&&[],(i=k.exec(e))?[t.createElement(i[1])]:(i=Te([e],t,s),s&&s.length&&_(s).remove(),_.merge([],i.childNodes)));var n,i,s},_.fn.load=function(e,t,r){var n,i,s,o=this,a=e.indexOf(" ");return a>-1&&(n=yt(e.slice(a)),e=e.slice(0,a)),v(t)?(r=t,t=void 0):t&&"object"==typeof t&&(i="POST"),o.length>0&&_.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done((function(e){s=arguments,o.html(n?_("<div>").append(_.parseHTML(e)).find(n):e)})).always(r&&function(e,t){o.each((function(){r.apply(this,s||[e.responseText,t,e])}))}),this},_.expr.pseudos.animated=function(e){return _.grep(_.timers,(function(t){return e===t.elem})).length},_.offset={setOffset:function(e,t,r){var n,i,s,o,a,c,l=_.css(e,"position"),d=_(e),u={};"static"===l&&(e.style.position="relative"),a=d.offset(),s=_.css(e,"top"),c=_.css(e,"left"),("absolute"===l||"fixed"===l)&&(s+c).indexOf("auto")>-1?(o=(n=d.position()).top,i=n.left):(o=parseFloat(s)||0,i=parseFloat(c)||0),v(t)&&(t=t.call(e,r,_.extend({},a))),null!=t.top&&(u.top=t.top-a.top+o),null!=t.left&&(u.left=t.left-a.left+i),"using"in t?t.using.call(e,u):("number"==typeof u.top&&(u.top+="px"),"number"==typeof u.left&&(u.left+="px"),d.css(u))}},_.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each((function(t){_.offset.setOffset(this,e,t)}));var t,r,n=this[0];return n?n.getClientRects().length?(t=n.getBoundingClientRect(),r=n.ownerDocument.defaultView,{top:t.top+r.pageYOffset,left:t.left+r.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,r,n=this[0],i={top:0,left:0};if("fixed"===_.css(n,"position"))t=n.getBoundingClientRect();else{for(t=this.offset(),r=n.ownerDocument,e=n.offsetParent||r.documentElement;e&&(e===r.body||e===r.documentElement)&&"static"===_.css(e,"position");)e=e.parentNode;e&&e!==n&&1===e.nodeType&&((i=_(e).offset()).top+=_.css(e,"borderTopWidth",!0),i.left+=_.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-_.css(n,"marginTop",!0),left:t.left-i.left-_.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var e=this.offsetParent;e&&"static"===_.css(e,"position");)e=e.offsetParent;return e||se}))}}),_.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(e,t){var r="pageYOffset"===t;_.fn[e]=function(n){return F(this,(function(e,n,i){var s;if(y(e)?s=e:9===e.nodeType&&(s=e.defaultView),void 0===i)return s?s[t]:e[n];s?s.scrollTo(r?s.pageXOffset:i,r?i:s.pageYOffset):e[n]=i}),e,n,arguments.length)}})),_.each(["top","left"],(function(e,t){_.cssHooks[t]=We(m.pixelPosition,(function(e,r){if(r)return r=Ve(e,t),je.test(r)?_(e).position()[t]+"px":r}))})),_.each({Height:"height",Width:"width"},(function(e,t){_.each({padding:"inner"+e,content:t,"":"outer"+e},(function(r,n){_.fn[n]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),a=r||(!0===i||!0===s?"margin":"border");return F(this,(function(t,r,i){var s;return y(t)?0===n.indexOf("outer")?t["inner"+e]:t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===i?_.css(t,r,a):_.style(t,r,i,a)}),t,o?i:void 0,o)}}))})),_.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(e,t){_.fn[t]=function(e){return this.on(t,e)}})),_.fn.extend({bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,r,n){return this.on(t,e,r,n)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),_.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),(function(e,t){_.fn[t]=function(e,r){return arguments.length>0?this.on(t,null,e,r):this.trigger(t)}}));var $t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;_.proxy=function(e,t){var r,n,i;if("string"==typeof t&&(r=e[t],t=e,e=r),v(e))return n=a.call(arguments,2),(i=function(){return e.apply(t||this,n.concat(a.call(arguments)))}).guid=e.guid=e.guid||_.guid++,i},_.holdReady=function(e){e?_.readyWait++:_.ready(!0)},_.isArray=Array.isArray,_.parseJSON=JSON.parse,_.nodeName=P,_.isFunction=v,_.isWindow=y,_.camelCase=Y,_.type=T,_.now=Date.now,_.isNumeric=function(e){var t=_.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},_.trim=function(e){return null==e?"":(e+"").replace($t,"")},void 0===(n=function(){return _}.apply(t,[]))||(e.exports=n);var Xt=r.jQuery,Kt=r.$;return _.noConflict=function(e){return r.$===_&&(r.$=Kt),e&&r.jQuery===_&&(r.jQuery=Xt),_},void 0===i&&(r.jQuery=r.$=_),_}))},function(e,t,r){"undefined"!=typeof self&&self,e.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=6)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PROTO_VERSION="1.2.1",t.ROOMVERSION="V1",function(e){e[e.debug=0]="debug",e[e.info=1]="info",e[e.warn=2]="warn",e[e.error=3]="error",e[e.report=99]="report",e[e.disable=100]="disable"}(t.ENUM_LOG_LEVEL||(t.ENUM_LOG_LEVEL={})),t.LOG_LEVEL={debug:0,info:1,warn:2,error:3,report:99,disable:100},function(e){e[e.disable=0]="disable",e[e.websocket=1]="websocket",e[e.https=2]="https"}(t.ENUM_REMOTE_TYPE||(t.ENUM_REMOTE_TYPE={})),t.sdkErrorList={CLIENT:"Client.",SERVER:"Server.",SUCCESS:{code:"Success",msg:"success."},PARAM:{code:"Error.Param",msg:"input error."},HEARTBEAT_TIMEOUT:{code:"Error.Timeout",msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:"Error.Timeout",msg:"login timeout."},SEND_MSG_TIMEOUT:{code:"Error.Timeout",msg:"send customsg timeout."},RESET_QUEUE:{code:"Error.Timeout",msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:"Error.Network",msg:"network is broken and login fail."},KICK_OUT:{code:"Error.Kickout",msg:"kickout reason="},UNKNOWN:{code:"Error.Unknown",msg:"unknown error."},FREQ_LIMITED:{code:"Error.requencyLimited",msg:"Frequency Limited."}},function(e){e[e.disconnected=0]="disconnected",e[e.connecting=1]="connecting",e[e.connected=2]="connected"}(t.ENUM_SIGNAL_STATE||(t.ENUM_SIGNAL_STATE={})),t.ENUM_RESOLUTION_TYPE={LOW:{width:240,height:320,frameRate:15,bitRate:300},MEDIUM:{width:480,height:640,frameRate:15,bitRate:800},HIGH:{width:720,height:1280,frameRate:20,bitRate:1500}},t.ENUM_SCREEM_RESOLUTION_TYPE={LOW:{frameRate:20,bitRate:800},MEDIUM:{frameRate:15,bitRate:1200},HIGH:{frameRate:5,bitRate:2e3}},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.ENUM_PUBLISH_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,publishing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE={start:0,waitingSessionRsp:1,waitingOffserRsp:2,waitingServerAnswer:3,waitingServerICE:4,connecting:5,playing:6,stop:7,didNotStart:8},t.ENUM_PLAY_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5},t.ENUM_CONNECT_STATE={disconnect:0,connecting:1,connected:2},t.MAX_TRY_CONNECT_COUNT=1,t.SEND_MSG_RESET=2,t.SEND_MSG_TIMEOUT=1,t.MAX_TRY_HEARTBEAT_COUNT=5,t.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5},t.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},t.ENUM_STREAM_UPDATE_TYPE={added:1,deleted:0},function(e){e[e.logout=0]="logout",e[e.trylogin=1]="trylogin",e[e.login=2]="login"}(t.ENUM_RUN_STATE||(t.ENUM_RUN_STATE={})),t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2},t.MAX_TRY_LOGIN_COUNT=5,t.TRY_LOGIN_INTERVAL=[2e3,4e3,6e3,8e3,1e4],t.MINIUM_HEARTBEAT_INTERVAL=3e3,t.ENUM_STREAM_UPDATE_CMD={added:12001,deleted:12002,updated:12003},t.SERVER_ERROR_CODE=1e4,t.MIXSTREAM_ERROR_CODE=1e4,function(e){e[e.low=1]="low",e[e.stantard=2]="stantard",e[e.hight=3]="hight",e[e.custome=4]="custome"}(t.QUALITYLEVEL||(t.QUALITYLEVEL={})),t.ENUM_SIGNAL_SUB_CMD={none:0,joinLiveRequest:1001,joinLiveResult:1002,joinLiveInvite:1003,joinLiveStop:1004},t.ENUM_PUSH_SIGNAL_SUB_CMD={none:0,pushJoinLiveRequest:11001,pushJoinLiveResult:11002,pushJoinLiveInvite:11003,pushJoinLiveStop:11004},t.ENUM_PUBLISH_STATE_NEGO={stop:0,start:1,waiterAnswer:2,waitingCandidate:3,sendCandidate:4,iceConnected:5},function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra"}(t.ENUM_PLAY_SOURCE_TYPE||(t.ENUM_PLAY_SOURCE_TYPE={})),function(e){e[e.stop=0]="stop",e[e.start=1]="start"}(t.ENUM_BROADCASTER_STATUS||(t.ENUM_BROADCASTER_STATUS={})),function(e){e[e.cdn=0]="cdn",e[e.ultra=1]="ultra",e[e.customUrl=2]="customUrl"}(t.ENUM_DISPATCH_TYPE||(t.ENUM_DISPATCH_TYPE={})),function(e){e[e.CDN=0]="CDN",e[e.BGP=1]="BGP"}(t.ENUM_SOURCE_TYPE||(t.ENUM_SOURCE_TYPE={})),function(e){e[e.ClientType_None=0]="ClientType_None",e[e.ClientType_H5=1]="ClientType_H5",e[e.ClientType_SmallPragram=2]="ClientType_SmallPragram",e[e.ClientType_Webrtc=3]="ClientType_Webrtc"}(t.E_CLIENT_TYPE||(t.E_CLIENT_TYPE={}));var n=function(){function e(e,t){void 0===e&&(e=null),void 0===t&&(t=null),this._id=null,this.next=null,this.prev=null,this._id=e,this._data=t}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id?this._id:null},set:function(e){this._id=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),e.prototype.hasNext=function(){return this.next&&this.next.id},e.prototype.hasPrev=function(){return this.prev&&this.prev.id},e}();t.ListNode=n;var i=function(){function e(){this.start=new n,this.end=new n,this._idCounter=0,this._numNodes=0,this.start.next=this.end,this.start.prev=null,this.end.prev=this.start,this.end.next=null}return e.prototype.insertBefore=function(e,t){var r=new n(this._idCounter,t);return r.next=e,r.prev=e.prev,e.prev&&(e.prev.next=r),e.prev=r,++this._idCounter,++this._numNodes,r},e.prototype.addLast=function(e){return this.insertBefore(this.end,e)},e.prototype.add=function(e){return this.addLast(e)},e.prototype.getFirst=function(){return 0===this._numNodes?null:this.start.next},e.prototype.getLast=function(){return 0===this._numNodes?null:this.end.prev},e.prototype.size=function(){return this._numNodes},e.prototype.getFromFirst=function(e){var t=0,r=this.start.next;if(e>=0)for(;t<e&&null!==r;)r=r.next,++t;else r=null;if(null===r)throw"Index out of bounds.";return r},e.prototype.get=function(e){return 0===e?this.getFirst():e===this._numNodes-1?this.getLast():this.getFromFirst(e)},e.prototype.remove=function(e){return e.prev&&(e.prev.next=e.next),e.next&&(e.next.prev=e.prev),--this._numNodes,e},e.prototype.removeFirst=function(){var e=null;return this._numNodes>0&&this.start.next&&(e=this.remove(this.start.next)),e},e.prototype.removeLast=function(){var e=null;return this._numNodes>0&&this.end.prev&&(e=this.remove(this.end.prev)),e},e.prototype.removeAll=function(){this.start.next=this.end,this.end.prev=this.start,this._numNodes=0,this._idCounter=0},e.prototype.each=function(e){for(var t=this.start;t.hasNext();)e(t=t.next)},e.prototype.find=function(e){for(var t=this.start,r=!1,n=null;t.hasNext()&&!r;)e(t=t.next)&&(n=t,r=!0);return n},e.prototype.map=function(e){for(var t=this.start,r=[];t.hasNext();)e(t=t.next)&&r.push(t);return r},e.prototype.push=function(e){return this.addLast(e)},e.prototype.unshift=function(e){this._numNodes>0?this.insertBefore(this.start.next,e):this.insertBefore(this.end,e)},e.prototype.pop=function(){return this.removeLast()},e.prototype.shift=function(){return this.removeFirst()},e}();t.LinkedList=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.commonErrorList={SUCCESS:{code:"Success",msg:"success."},INIT:{code:2000000001,msg:"init sdk wrong"},PARAM:{code:2000000002,msg:"input parm error."},DETECT_TIMEOUT:{code:2000000003,msg:"detect time out"},DETECT_FAIL:{code:2000000004,msg:"detect fail"},SCREEN:{code:2000000005,msg:"screen sharing fail"},DEVICE_NO_FOUND:{code:2000000006,msg:"device no found"},ENUMERATE_DEVICES_FAIL:{code:2000000007,msg:"enumerate devices fail"},NOT_LOGIN:{code:2000000008,msg:"not login"},STOP_MIX_FAIL:{code:2000000009,msg:"stop mix stream fail"},MIX_VIDEOC:{code:2000000010,msg:"mix video code type wrong"},MIX_OUTPUT:{code:2000000011,msg:"mix output wrong"}},t.liveRoomErrorList={SERVER:{code:0,msg:"liverooom cmd error"},KICK_OUT:{code:2001000001,msg:"liveroom kick out"},HEARTBEAT_TIMEOUT:{code:2001000002,msg:"heartbeat timeout."},LOGIN_TIMEOUT:{code:2001000003,msg:"login timeout."},SEND_MSG_TIMEOUT:{code:2001000004,msg:"send customsg timeout."},RESET_QUEUE:{code:2001000005,msg:"msg waiting ack is clear when reset."},LOGIN_DISCONNECT:{code:2001000006,msg:"network is broken and login fail."},UNKNOWN:{code:2001000007,msg:"unknown error."},FREQ_LIMITED:{code:2001000008,msg:"Frequency Limited."}},t.publishErrorList={PARAM:{code:2002000001,msg:"input parm error."},BROWSER_NOT_SUPPORT:{code:2002000002,msg:"browser do not support"},DISPATCH_ERROR:{code:2002000003,msg:"dispatch request error"},DISPATCH_TIMEOUT:{code:2002000004,msg:"dispatch request timeout"},TOKEN_ERROR:{code:2002000005,msg:"login token error"},SEND_SESSION_TIMEOUT:{code:2002000006,msg:"send session request timeout"},CREATE_SESSION_ERROR:{code:2002000007,msg:"create session error"},CREATE_OFFER_ERROR:{code:2002000008,msg:"create offer error"},SET_LOCAL_DESC_ERROR:{code:2002000009,msg:"setLocalDescription error"},SEND_MEDIA_DESC_TIMEOUT:{code:2002000010,msg:"send mediaDesc timeout"},SERVER_MEDIA_DESC_TIMEOUT:{code:2002000011,msg:"waiting server mediaDesc timeout"},SERVER_MEDIA_DESC_ERROR:{code:2002000012,msg:"server mediaDesc type error"},SET_REMOTE_DESC_ERROR:{code:2002000013,msg:"other side offer error"},SEND_CANDIDATE_TIMEOUT:{code:2002000014,msg:"sendIceCandidate error"},SERVER_CANDIDATE_TIMEOUT:{code:2002000015,msg:"waiting candidate timeout"},SERVER_CANDIDATE_ERROR:{code:2002000016,msg:"recv candidate error"},SESSION_CLOSED:{code:2002000017,msg:"server session closed"},MEDIA_CONNECTION_FAILED:{code:2002000018,msg:"Iice Connection state failed"},MEDIA_CONNECTION_CLOSED:{code:2002000019,msg:"ice connection state closed"},WEBSOCKET_ERROR:{code:2002000020,msg:"network error"},CONSTRAINTS_ERROR:{code:2002000021,msg:"constraint error"},MEDIA_CONNECTION_DISCONNECTED:{code:2002000022,msg:"ice connection state disconnected"},SERVER_NEGO_TIMEOUT:{code:2002000023,msg:"negotiation timeout"}},t.playErrorList={PARAM:{code:2003000001,msg:"input parm error."},STATE_FAIL:{code:2003000002,msg:"set play state fail"},DISPATCH_ERROR:{code:2003000003,msg:"dispatch request error"},DISPATCH_TIMEOUT:{code:2003000004,msg:"dispatch request timeout"},TOKEN_ERROR:{code:2003000005,msg:"login token error"},SEND_SESSION_TIMEOUT:{code:2003000006,msg:"send session request timeout"},CREATE_SESSION_ERROR:{code:2003000007,msg:"create session error"},CREATE_OFFER_ERROR:{code:2003000008,msg:"create offer error"},SERVER_MEDIA_DESC_TIMEOUT:{code:2003000009,msg:"wating server mediaDesc timeout"},SET_REMOTE_DESC_ERROR:{code:2003000010,msg:"other side offer error"},CREATE_ANSWER_ERROR:{code:2003000011,msg:"create offer error"},SET_LOCAL_DESC_ERROR:{code:2003000012,msg:"setLocalDescription error"},SEND_MEDIA_DESC_TIMEOUT:{code:2003000013,msg:"send mediaDesc timeout"},SEND_CANDIDATE_ERROR:{code:2003000014,msg:"send candidate error"},SEND_CANDIDATE_TIMEOUT:{code:2003000015,msg:"send candidate timeout"},SERVER_CANDIDATE_TIMEOUT:{code:2003000016,msg:"waiting candidate timeout"},SERVER_CANDIDATE_ERROR:{code:2003000017,msg:"recv candidate error"},MEDIA_CONNECTION_FAILED:{code:2003000018,msg:"ice Connection state failed"},MEDIA_CONNECTION_CLOSED:{code:2003000019,msg:"ice connection state closed"},SESSION_CLOSED:{code:2003000020,msg:"server session closed"},WEBSOCKET_ERROR:{code:2003000021,msg:"network error"},MEDIA_CONNECTION_DISCONNECTED:{code:2002000022,msg:"ice connection state disconnected"},SERVER_NEGO_TIMEOUT:{code:2002000023,msg:"negotiation timeout"}}},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=r(0),o=r(1),a=function(){function e(){}return e.checkConfigParam=function(e,t,r){return e&&"number"==typeof e?!(!t||"string"!=typeof t||""==t)||(r.error("ccp.0 server must be string and not empty"),!1):(r.error("ccp.0 appid must be number and not empty"),!1)},e.registerCallback=function(e,t,r){var n,i;t.success&&(n=t.success,r[e+"SuccessCallback"]=n),t.error&&(i=t.error,r[e+"ErrorCallback"]=i)},e.actionErrorCallback=function(e,t){return t[e+"ErrorCallback"]},e.actionSuccessCallback=function(e,t){return t[e+"SuccessCallback"]},e.getServerError=function(e){var t={1:"parse json error.",1001:"login is processing.",1002:"liveroom request error.",1003:"zpush connect fail.",1004:"zpush handshake fail.",1005:"zpush login fail.",1006:"user login state is wrong.",1007:"got no zpush addr",1008:"token error",1009:"dispatch error",2002:"biz channel error",1e9:"liveroom cmd error, result="};if(0===e)return o.commonErrorList.SUCCESS;var r=o.liveRoomErrorList.SERVER;return r.code=e,r.msg=e>1e9?t[1e9]+e:t[e]?"unknown error code:"+e:t[e],r},e.isKeepTryLogin=function(e){switch(e){case 1002:case 1003:return!0;default:return!1}},e.mergeStreamList=function(e,t,r,n,i){e.debug("msl.0 call");var s,o=[],a=[],c=[];n||(n=[]);for(var l=0;l<n.length;l++)if(n[l].anchor_id_name!=t){s=!1;for(var d=0;d<r.length;d++)if(n[l].stream_id===r[d].stream_id){n[l].extra_info!==r[d].extra_info&&c.push(n[l]),s=!0;break}s||o.push(n[l])}else e.debug("msl.0 have self stream added");for(var u=0;u<r.length;u++){s=!1;for(var h=0;h<n.length;h++)if(r[u].stream_id===n[h].stream_id){s=!0;break}s||a.push(r[u])}for(r.splice(0),l=0;l<n.length;l++)r.push(n[l]);i(o,a,c),e.debug("msl.0 call success")},e.mergeUserList=function(e,t,r,n){e.debug("msl.0 call");var i,s=[],o=[];r||(r=[]);for(var a=0;a<r.length;a++){i=!1;for(var c=0;c<t.length;c++)if(r[a].userID===t[c].userID){i=!0;break}i||s.push(r[a])}for(var l=0;l<t.length;l++){i=!1;for(var d=0;d<r.length;d++)if(t[l].userID===r[d].userID){i=!0;break}i||o.push(t[l])}for(t.splice(0),a=0;a<r.length;a++)t.push(t[a]);n(s,o),e.debug("msl.0 call success")},e.checkCustomCommandParam=function(e){return!0},e.generateRandumNumber=function(e){return parseInt(Math.random()*(e+1)+"",10)},e.uuid=function(e,t){var r,n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=[];if(t=t||n.length,e)for(r=0;r<e;r++)i[r]=n[0|Math.random()*t];else{var s=void 0;for(i[8]=i[13]=i[18]=i[23]="-",i[14]="4",r=0;r<36;r++)i[r]||(s=0|16*Math.random(),i[r]=n[19==r?3&s|8:s])}return i.join("")},e.supportDetection=function(e,t){return n(this,void 0,void 0,(function(){var r,n,s,o,a;return i(this,(function(i){switch(i.label){case 0:if(r={webRTC:!1,customCapture:!1,camera:!1,microphone:!1,videoCodec:{H264:!1,H265:!1,VP8:!1,VP9:!1},screenSharing:e},((n=document.createElement("video")).captureStream||n.mozCaptureStream)&&(r.customCapture=!0),!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia))return[3,5];i.label=1;case 1:return i.trys.push([1,4,,5]),[4,navigator.mediaDevices.getUserMedia({video:!0})];case 2:return(s=i.sent())&&(r.camera=!0)&&s.getTracks().forEach((function(e){return e.stop()})),[4,navigator.mediaDevices.getUserMedia({audio:!0})];case 3:return(o=i.sent())&&(r.microphone=!0)&&o.getTracks().forEach((function(e){return e.stop()})),[3,5];case 4:return a=i.sent(),console.error("devices detect error: ",a.name,a.message),[3,5];case 5:return this.supportVideoCodeType((function(e,n){r.videoCodec.H264=e.H264,r.videoCodec.H265=e.H265,r.videoCodec.VP8=e.VP8,r.videoCodec.VP9=e.VP9,r.webRTC=e.webRTC,n&&console.error("videoCodec detect error: "+n),t&&t(r)})),[2]}}))}))},e.compareVersion=function(e,t){e=e.split("."),t=t.split(".");for(var r=Math.max(e.length,t.length);e.length<r;)e.push("0");for(;t.length<r;)t.push("0");for(var n=0;n<r;n++){var i=parseInt(e[n]),s=parseInt(t[n]);if(i>s)return 1;if(i<s)return-1}return 0},e.isSupportLive=function(e,t){var r=wx.getSystemInfoSync().SDKVersion,n={code:-1,msg:""};this.compareVersion(r,"1.7.0")<0&&(n={code:10001,msg:"当前微信版本过低，无法使用相关组件"},e&&e(n)),wx.getSetting({success:function(t){var r=t.authSetting;r["scope.camera"]&&r["scope.record"]||(n={code:10002,msg:"需要摄像头和录音功能的授权"}),e&&e(n)},fail:function(e){t&&t(e)}})},e.supportVideoCodeType=function(e){var t={webRTC:!1,H264:!1,VP8:!1,VP9:!1,H265:!1};try{(new RTCPeerConnection).createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then((function(r){if(t.webRTC=!0,r&&r.sdp){var n=r.sdp.split("\r\n");t.H264=n.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1})),t.VP8=n.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP8/")>-1})),t.VP9=n.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("VP9/")>-1})),t.H265=n.some((function(e){return e.startsWith("a=rtpmap:")&&e.indexOf("H264/")>-1})),e&&e(t)}}))}catch(r){e&&e(t,r)}},e.inlineWorker=function(e){if(Worker&&e){var t=e.toString().trim().match(/^function\s*\w*\s*\([\w\s,]*\)\s*{([\w\W]*?)}$/)[1],r=URL.createObjectURL(new window.Blob([t],{type:"text/javascript"}));return new Worker(r)}return null},e.getBrowser=function(){var e=window.navigator.userAgent,t=null!=window.ActiveXObject&&-1!=e.indexOf("MSIE"),r=-1!=e.indexOf("Firefox"),n=null!=window.opr,i=e.indexOf("Chrome")&&window.chrome,s=-1!=e.indexOf("Safari")&&-1!=e.indexOf("Version");return t?"IE":r?"Firefox":n?"Opera":i?"Chrome":s?"Safari":"Unkown"},e.setDebug=function(e,t){"string"==typeof e&&-1!=e.indexOf("wss")?-1==e.indexOf("wss://wsliveroom-alpha.zego.im/ws")&&-1==e.indexOf("wss://wssliveroom-test.zego.im/ws")&&-1==e.indexOf("wss://test2-wsliveroom-api.zego.im/ws")&&-1==e.indexOf("wss://wsliveroom-test.zegocloud.com/ws")&&-1==e.indexOf("wss://wsliveroom-test.zego.im/ws")&&-1==e.indexOf("wss://webliveroom-test.zego.im/ws")||(t.debug=!0):console.error("server wrong")},e.getPublisherStateType=function(e){return 0==e||1==e?0==e?"PUBLISHING":"NO_PUBLISH":"PUBLISH_REQUESTING"},e.getPlayerStateType=function(e){return 0==e||1==e?0==e?"PLAYING":"NO_PLAY":"PLAY_REQUESTING"},e.getSteamUpdateType=function(e){return 0==e?"DELETE":"ADD"},e.getLogLevel=function(e){return s.LOG_LEVEL[e]},e}();t.ClientUtil=a},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.ENUM_PUBLISH_STATE_UPDATE={start:0,error:1,retry:2},t.ENUM_PLAY_STATE_UPDATE={start:0,error:1,retry:2,stop:3},t.ENUM_RETRY_STATE={didNotStart:0,retrying:1,finished:2},t.getSeq=(n=1,function(){return n++})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.loop=!1,this.replace=!1,this.effectEndedCallBack=null,this.effectEndedListener=null,this.startTimes=0,this.startOffset=0,this.pauseTimes=0,this.resumeOffset=0,this.isMixAudio=!1,this.logger=e}return e.prototype.preloadEffect=function(e,t){var r=this;this.logger.info("amu.pe.0 start preload effect");var n=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext),i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||304==i.status){var e=i.response;n.decodeAudioData(e,(function(e){r.logger.info("amu.pe.0 effect preload success"),t("",e)}),(function(e){t(e)}))}else{var s=i.statusText;t(s)}},i.send()},e.prototype.playEffect=function(e,t,r,n,i){var s=this;!0!==this.isMixAudio?this.audioBuffer?(this.startOffset=e||0,this.loop=t||!1,this.replace=r||!1,this.effectEndedCallBack=i,this.mixEffect(this.audioBuffer,(function(){s.buffSource.loop=!!t,e?s.buffSource.start(0,e/1e3):s.buffSource.start(0),s.startTimes=Date.now(),s.effectEndedListener=s.effectEndedHandler.bind(s),s.buffSource.addEventListener("ended",s.effectEndedListener),n&&n()}))):this.logger.error("amu.pe.1 no audio buffer found"):this.logger.error("amu.pe.1 audio is mixing")},e.prototype.pauseEffect=function(){this.stopMixingAudio(),this.resumeOffset=(this.pauseTimes-this.startTimes+this.startOffset)%(1e3*this.audioBuffer.duration)},e.prototype.resumeEffect=function(){this.playEffect(this.resumeOffset,this.loop,this.replace,void 0,this.effectEndedCallBack),this.startOffset=this.resumeOffset},e.prototype.mixEffect=function(e,t){this.localStream?(this.ac=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext),this.gainNode=this.ac.createGain(),this.buffSource=this.ac.createBufferSource(),this.buffSource.buffer=e,this.buffSource.connect(this.gainNode),this.replaceTrack()&&t()):this.logger.error("amu.me.0 localStream can not be found")},e.prototype.startMixingAudio=function(e,t){return this.replace=t||!1,this.isMixAudio?(this.logger.error("amu.sma.0 audio is mixing"),!1):this.localStream?(e.captureStream=e.captureStream||e.mozCaptureStream||e.webkitCaptureStream,this.ac=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext),this.gainNode=this.ac.createGain(),this.mixAudio=this.ac.createMediaStreamSource(e.captureStream()),this.mixAudio.connect(this.gainNode),this.replaceTrack()):(this.logger.error("amu.sma.0 localStream can not be found"),!1)},e.prototype.replaceTrack=function(){this.streamSource=this.ac.createMediaStreamSource(this.localStream.clone()),this.destination=this.ac.createMediaStreamDestination(),!this.replace&&this.streamSource.connect(this.destination),this.gainNode.connect(this.destination);var e=this.destination.stream.getAudioTracks()[0],t=this.peerConnection.getSenders().find((function(t){return t.track.kind===e.kind}));return t?(this.micTrack=this.localStream.getAudioTracks()[0],t.replaceTrack(e),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(e),this.isMixAudio=!0,!0):(this.logger.error("amu.rt.0 no sender"),!1)},e.prototype.stopMixingAudio=function(){var e=this;return this.isMixAudio?this.localStream?(this.peerConnection.getSenders().find((function(t){return t.track.kind===e.micTrack.kind})).replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack),this.mixAudio?(this.mixAudio.disconnect(this.gainNode),this.mixAudio=null):this.buffSource&&(this.buffSource.removeEventListener("ended",this.effectEndedListener),this.buffSource.stop(),this.pauseTimes=Date.now(),this.buffSource.disconnect(this.gainNode),this.buffSource=null),this.gainNode.disconnect(this.destination),this.micTrack=null,this.ac=void 0,this.isMixAudio=!1,!0):(this.logger.error("amu.sma.1 localStream can not be found"),!1):(this.logger.error("amu.sma.1 no mixing audio found"),!1)},e.prototype.setMixingAudioVolume=function(e){return this.gainNode?(this.gainNode.gain.value=e,!0):(this.logger.error("amu.sma.2 no mixing audio found"),!1)},e.prototype.effectEndedHandler=function(){this.stopMixingAudio(),this.effectEndedCallBack&&this.effectEndedCallBack()},e}();t.AudioMixUtil=n},function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.zegoSdp=function(e){var t=e.split("\r\n"),r=[],i=[];t.forEach((function(e){var t=e.match(/a=rtpmap:(\d+)\s+((H264\/90000)|(opus\/48000\/2))/);t&&t[1]&&t[2]&&("H264/90000"===t[2]&&r.push(t[1]),"opus/48000/2"===t[2]&&i.push(t[1]))}));var s=[];return t.map((function(e){var t=!0,o=e.match(/((a=rtcp-fb:)|(a=rtpmap:)|(a=fmtp:))(\d+)/);if(o&&o[5]&&(n(r,i).some((function(e){return e==o[5]}))||(t=!1)),e.indexOf("m=video")>-1){var a=e.split(" ");e=n([a[0],a[1],a[2]],r).join(" ")}else e.indexOf("m=audio")>-1&&(a=e.split(" "),e=n([a[0],a[1],a[2]],i).join(" "));t&&s.push(e)})),s.join("\r\n")},e.getSDPByVideDecodeType=function(e,t){var r={str:"",arr:[],obj:{H264:[],H265:[],VP8:[],VP9:[],OHTER:[]}};if(!e.includes("m=video"))return e;var i=/m=video.+/.exec(e)[0];i=i.match(/[\s|\d]+/g)[1].replace(" ",""),r.str=i,r.arr=r.str.split(" "),r.arr.forEach((function(t){var n=new RegExp("a=rtpmap:"+t+".+").exec(e)[0];n.includes("H264")?r.obj.H264.push(t):n.includes("H265")?r.obj.H265.push(t):n.includes("VP8")?r.obj.VP8.push(t):n.includes("VP9")?r.obj.VP9.push(t):r.obj.OHTER.push(t)})),r.obj.OHTER.forEach((function(t){var n=new RegExp("a=fmtp:"+t+".+apt=(\\d+)").exec(e),i=n&&n[1];i&&(r.obj.H264.includes(i)?r.obj.H264.push(t):r.obj.H265.includes(i)?r.obj.H265.push(t):r.obj.VP8.includes(i)?r.obj.VP8.push(t):r.obj.VP9.includes(i)&&r.obj.VP9.push(t))}));var s=[];return"VP9"===t?s=n(r.obj.H265,r.obj.H264,r.obj.VP8):"VP8"===t?s=n(r.obj.H265,r.obj.H264,r.obj.VP9):"H264"===t?s=n(r.obj.H265,r.obj.VP8,r.obj.VP9):"H265"===t&&(s=n(r.obj.VP8,r.obj.H264,r.obj.VP9)),s.forEach((function(t){var n=r.arr.indexOf(t);r.arr.splice(n,1);var i=new RegExp("a=rtpmap:"+t+".+\\s\\n","g"),s=new RegExp("a=rtcp-fb:"+t+".+\\s\\n","g"),o=new RegExp("a=fmtp:"+t+".+\\s\\n","g");e=(e=(e=e.replace(i,"")).replace(s,"")).replace(o,"")})),e=e.replace(i,r.arr.join(" "))},e}();t.SdpUtil=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=r(0),a=r(7),c=r(9),l=r(2),d=r(4),u=r(18),h=r(26),p=r(27),f=r(28),g=r(1),m=function(e){function t(t,r){var n=this,i=new h.StateCenter,s=new a.LoggerWeb(i),o=new c.ZegoStreamCenterWeb(s,i);return(n=e.call(this)||this).streamCenter=o,n.logger=s,n.stateCenter=i,n.audioMixing=new d.AudioMixUtil(s),n.init(),l.ClientUtil.setDebug(r,n.stateCenter),l.ClientUtil.checkConfigParam(t,r,s)?(n.stateCenter.appid=t,"string"==typeof r?(n.stateCenter.server=r,n.stateCenter.serverBak=r):Array.isArray(r)&&r.length>0&&(n.stateCenter.server=r[0],n.stateCenter.serverBak=r[1]||r[0]),n.stateCenter.configOK=!0,n.bindWindowListener(),n.streamCenter.onPublishStateUpdate=function(e,t,r){n.onPublishStateUpdateHandle(e,t,r)},s.info("zc.0 "+navigator.appVersion)):s.error("zc.0 init sdk error"),n}return i(t,e),t.prototype.getSocket=function(e){return new WebSocket(e)},t.prototype.on=function(e,t){return this.bindListener(e,t)},t.prototype.off=function(e,t){return this.deleteListener(e,t)},t.prototype.mutePublishStreamVideo=function(e,t){return this.enableStream(e,{video:t})},t.prototype.mutePublishStreamAudio=function(e,t){return this.enableStream(e,{audio:t})},t.prototype.enableStream=function(e,t){if(this.logger.debug("zc.p.ec.0 call"),"boolean"!=typeof t.video&&"boolean"!=typeof t.audio)return this.logger.error("zc.p.es.0 option error"),!1;var r=!0,n=!0;return"boolean"==typeof t.video&&(r=this.streamCenter.enableCamera(e,t.video)),"boolean"==typeof t.audio&&(n=this.streamCenter.enableMicrophone(e,t.audio)),r&&n},t.prototype.setAudioOutput=function(e,t){return this.logger.debug("zc.p.slao call"),"string"!=typeof t?(console.error("audiooutput is not string"),!1):this.streamCenter.setStreamAudioOutput(e,t)},t.prototype.setCustomSignalUrl=function(e){return this.logger.debug("zc.p.scs.0 call: "+e),"string"!=typeof e||""==e?(this.logger.error("zc.p.scs.0 signalUrl must be string and not empty"),!1):0!=e.indexOf("wss://")?(this.logger.error("zc.p.scs.0 url is not correct"),!1):(this.stateCenter.customUrl=e,!0)},t.prototype.setQualityMonitorCycle=function(e){return"number"==typeof e&&e>=1e3?(this.streamCenter.setQualityMonitorCycle(e),!0):(this.logger.error("zc.sqmc.0 time must be number and bigger than 1000"),!1)},t.prototype.startPlayingStream=function(e,t){var r=this;return this.logger.debug("zc.p.sps.0 call"),new Promise((function(n,i){if("string"!=typeof e||""===e)return r.logger.error("zc.p.sps.0 streamID must be string and not empty"),i(g.playErrorList.PARAM),!1;if(r.stateCenter.customUrl)return r.streamCenter.setPlayStateStart(e,t)?r.streamCenter.startPlayingStream(e,[r.stateCenter.customUrl],n):(r.logger.error("zc.p.sps.0 cannot start play"),i(g.playErrorList.STATE_FAIL),!1);if(!r.stateCenter.isLogin())return r.logger.error("zc.p.sps.0 not login"),i(g.commonErrorList.NOT_LOGIN),!1;for(var s=!1,a=0;a<r.stateCenter.streamList.length;a++)if(r.stateCenter.streamList[a].stream_id===e){s=!0;break}if(0==s&&r.logger.info("zc.p.sps.0 cannot find stream"),r.stateCenter.pullLimited||(e=NaN+e),!r.streamCenter.setPlayStateStart(e,t))return r.logger.info("zc.p.sps.0 cannot start play"),i(g.playErrorList.STATE_FAIL),!1;var c={stream_id:e,ptype:"pull",signals:r.streamCenter.getAllInUseUrl()};return r.streamCenter.playSuccessCallBack=n,r.socketCenter.registerRouter("webrtc_url",(function(e){r.handleFetchWebRtcUrlRsp(e)})),r.socketCenter.sendMessage("webrtc_url",c,void 0,(function(t){t==o.sdkErrorList.SEND_MSG_TIMEOUT?r.streamCenter.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,e,g.playErrorList.DISPATCH_TIMEOUT):r.streamCenter.onPlayStateUpdate(o.ENUM_PLAY_STATE_UPDATE.error,e,g.playErrorList.DISPATCH_ERROR),r.streamCenter.stopPlayingStream(e)})),!0}))},t.prototype.stopPlayingStream=function(e){if(this.logger.debug("zc.p.sps.1.0 call"),"string"==typeof e&&""!==e){for(var t in this.streamCenter.stopPlayingStream(e),this.stateCenter.streamUrlMap)if(this.stateCenter.streamUrlMap[t]===e){delete this.stateCenter.streamUrlMap[t];break}this.logger.debug("zc.p.sps.1.0 call success")}else this.logger.error("zc.p.sps.1.0 streamid must be string and not empty")},t.prototype.createStream=function(e){var t=this;return this.logger.debug("zc.p.sp.0 call"),new Promise((function(r,n){if("https:"!==window.location.protocol&&"file:"!==window.location.protocol&&-1==window.location.hostname.indexOf("127.0.0.1")&&-1==window.location.hostname.indexOf("localhost"))return t.logger.error("zc.p.sp.0 https or localhost required "),void n(g.publishErrorList.BROWSER_NOT_SUPPORT);if(e&&e.screen){var i=l.ClientUtil.getBrowser(),s=t.streamCenter.getScreenConstrains(e.screen);"Firefox"==i&&t.startScreenShotFirFox("screen",s,(function(e,i){e?(t.streamCenter.createScreenPreviewer(i,s)&&r(i),i.getVideoTracks()[0].onended=function(){return t.stateCenter.actionListener("screenSharingEnded")}):n(g.commonErrorList.SCREEN)})),("Chrome"==i||"Safari"==i)&&t.startScreenSharing(s,(function(e,o){e?(t.streamCenter.createScreenPreviewer(o,s)&&r(o),o.getVideoTracks()[0].onended=function(){return t.stateCenter.actionListener("screenSharingEnded")}):"Chrome"==i&&t.startScreenShotChrome((function(e,i){e?(t.streamCenter.createScreenPreviewer(i)&&r(i),i.getVideoTracks()[0].onended=function(){return t.stateCenter.actionListener("screenSharingEnded")}):n(g.commonErrorList.SCREEN)}))}))}else{if(e&&e.camera&&e.camera.audioBitRate){if("number"!=typeof e.camera.audioBitRate)return t.logger.error("zc.p.sp.0 audioBitRate must be number"),void n(g.publishErrorList.PARAM);if(e.camera.audioBitRate<48)return t.logger.error("zc.p.sp.0 audioBitRate cannot less 48 kbps"),void n(g.publishErrorList.PARAM);t.stateCenter.audioBitRate=1e3*e.camera.audioBitRate}var o={};e&&e.camera?("boolean"!=typeof(o=e.camera).video&&(o.video=!0),"boolean"!=typeof o.audio&&(o.audio=!0)):e&&e.custom&&(o=e.custom),t.streamCenter.startPreview(o,r,n)}}))},t.prototype.destroyStream=function(e){this.logger.debug("zc.p.sp.1 call"),e instanceof MediaStream&&!(e instanceof MediaStream&&0==e.getTracks().length)?this.streamCenter.stopPreview(e):this.logger.error("zc.p.sp.1 localStream is not mediaStream or tracks is null")},t.prototype.startPublishingStream=function(e,t,r){var n=this;if(this.logger.debug("zc.pls.0 call"),!e)return this.logger.error("zc.pls.0 stream id wrong"),!1;if(!t||t instanceof MediaStream&&0==t.getTracks().length)return this.logger.error("zc.pls.0 localStream wrong"),!1;if(r||(r={}),r.audioBitRate=this.stateCenter.audioBitRate,this.stateCenter.customUrl&&0!=this.stateCenter.customUrl.length){if(this.stateCenter.publishStreamList[e]={state:o.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},!this.streamCenter.setPublishStateStart(e,t,r))return this.logger.info("zc.p.sps.1 cannot start publish"),!1;this.streamCenter.startPublishingStream(e,[this.stateCenter.customUrl])}if(!this.stateCenter.isLogin())return this.logger.error("zc.p.sps.1 not login"),!1;if(this.stateCenter.publishStreamList[e]={state:o.ENUM_PUBLISH_STREAM_STATE.tryPublish,extra_info:r.extraInfo?r.extraInfo:null},!this.streamCenter.setPublishStateStart(e,t,r))return this.logger.error("zc.p.sps.1 cannot start publish"),!1;this.logger.info("zc.p.sps.1 start publish");var i={stream_id:e,ptype:"push",signals:this.streamCenter.getAllInUseUrl(),header_kvs:[{key:"grpc-metadata-push",value:r&&r.cdnUrl||""}]};return this.socketCenter.registerRouter("webrtc_url",(function(e){n.handleFetchWebRtcUrlRsp(e)})),this.socketCenter.sendMessage("webrtc_url",i,void 0,(function(t){t==o.sdkErrorList.SEND_MSG_TIMEOUT?n.streamHandler.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,e,g.publishErrorList.DISPATCH_TIMEOUT):n.streamHandler.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,e,g.publishErrorList.DISPATCH_ERROR),n.streamCenter.stopPublishingStream(e)})),!0},t.prototype.stopPublishingStream=function(e){return this.logger.debug("zc.p.sps.1.1 call"),"string"!=typeof e||""==e?(this.logger.error("zc.p.sps.1.1 streamID must be string and not empty"),!1):(this.streamCenter.stopPublishingStream(e),this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].state>=o.ENUM_PUBLISH_STREAM_STATE.update_info&&this.streamHandler.updateStreamInfo(e,o.ENUM_STREAM_SUB_CMD.liveEnd),delete this.stateCenter.publishStreamList[e]),!0)},t.prototype.setPublishStreamConstraints=function(e,t){var r=this;return new Promise((function(n,i){e instanceof MediaStream||(r.logger.error("zc.sc.0 localStream not found"),i(g.publishErrorList.PARAM)),r.streamCenter.setPublishStreamConstraints(e,t,n,i)}))},t.prototype.preloadEffect=function(e,t,r){var n=this;e&&"number"==typeof e&&t&&"string"==typeof t?this.stateCenter.audioEffectBuffer[e]?this.logger.error("zc.pe.0 audio buffer already exists"):this.audioMixing.preloadEffect(t,(function(t,i){if(t)return n.logger.error("zc.pe.0 effect preload fail "+t),void(r&&r(t));i&&(n.stateCenter.audioEffectBuffer[e]=i,r&&r())})):this.logger.error("zc.pe.0 params error")},t.prototype.playEffect=function(e,t,r){if(e.streamID&&"string"==typeof e.streamID&&e.effectId&&"number"==typeof e.effectId)if(this.stateCenter.audioEffectBuffer[e.effectId]){var n=this.stateCenter.audioEffectBuffer[e.effectId],i=this.getPublisher(e.streamID);i?n?i.playEffect(e,n,t,r):this.logger.error("zc.pe.1 no audio buffer found"):this.logger.error("zc.pe.1 publisher doesn't exist")}else this.logger.error("zc,pe.1 audio buffer dosesn't exists");else this.logger.error("zc.pe.1 params error")},t.prototype.pauseEffect=function(e){if(e&&"string"==typeof e){var t=this.getPublisher(e);t?t.pauseEffect():this.logger.error("zc.pe.2 publisher doesn't exist")}else this.logger.error("zc.pe.2 streamID format error")},t.prototype.resumeEffect=function(e){if(e&&"string"==typeof e){var t=this.getPublisher(e);t?t.resumeEffect():this.logger.error("zc.re.0 publisher doesn't exist")}else this.logger.error("zc.re.0 streamID format error")},t.prototype.unloadEffect=function(e){return e&&"number"==typeof e?(delete this.stateCenter.audioEffectBuffer[e],!0):(this.logger.error("zc.ue.0 params error"),!1)},t.prototype.startMixingAudio=function(e,t,r){if(this.logger.debug("zc.sma.0 call"),!e||"string"!=typeof e)return this.logger.error("zc.sma.0 stream id error"),!1;if(!t)return this.logger.error("zc.sma.0 no audio"),!1;var n=this.getPublisher(e);return n?n.startMixingAudio(t,r):(this.logger.error("zc.sma.0 publisher doesn't exist"),!1)},t.prototype.stopMixingAudio=function(e){if(!e||"string"!=typeof e)return this.logger.error("zc.sma.1 param streamID format error"),!1;var t=this.getPublisher(e);return t?t.stopMixingAudio():(this.logger.error("zc.sma.1 publisher doesn't exist"),!1)},t.prototype.setMixingAudioVolume=function(e,t){if(this.logger.debug("zc.sma.2 call"),"string"!=typeof e||""==e)return this.logger.error("zc.sma.2 stream ID must be string and not empty"),!1;if("number"!=typeof t||t<0||t>100)return this.logger.error("zc.sma.2 volume must be a number between 0 and 100"),!1;var r=this.getPublisher(e);return r?r.audioMixing.setMixingAudioVolume(t/100):(this.logger.error("zc.sma.2 publisher doesn't exist"),!1)},t.prototype.getPublisher=function(e){var t=null,r=this.streamCenter.getTotalStreamId(e);return this.streamCenter.publisherList[r]&&this.streamCenter.publisherList[r].publisher&&(t=this.streamCenter.publisherList[r].publisher),t},t.prototype.startScreenShotChrome=function(e){if(!t.screenShotReady)return this.logger.error('zc.b.ss Please install the extension:1. Go to chrome://extensions  2. Check: "Enable Developer mode   3. Click: "Load the unpacked extension... 4. Choose "extension" folder from the repository 5. Reload this page'),!1;window.postMessage({type:"SS_UI_REQUEST",text:"start"},"*"),l.ClientUtil.registerCallback("screenShare",{success:e},this.stateCenter.callbackList)},t.prototype.startScreenSharing=function(e,t){var r=this;"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({audio:e.audio,video:{frameRate:e.frameRate}}).then((function(e){t(!0,e)})).catch((function(e){r.logger.error("zc.b.sss "+e),t(!1,null,e)})):this.logger.error("zc.b.sss brower does not support getDisplayMedia")},t.prototype.startScreenShotFirFox=function(e,t,r){var n=this,i={video:{frameRate:t.frameRate,bitRate:t.bitRate},audio:t.audio};i.video.mediaSource=e,navigator.mediaDevices.getUserMedia(i).then((function(e){n.stateCenter.screenShotStream=e,r(!0,e)})).catch((function(e){n.logger.error("zc.b.ssf "+e),r(!1,null,e)}))},t.prototype.stopScreenShot=function(){this.stateCenter.screenShotStream.getTracks().forEach((function(e){e.stop()})),window.postMessage({type:"SS_UI_CANCEL",text:"start"},"*")},t.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){this.stateCenter.publishStreamList[t].state==o.ENUM_PUBLISH_STREAM_STATE.publishing&&this.streamHandler.onPublishStateUpdate(e,t,r)},t.prototype.setCDNInfo=function(e,t){e.urlFlv=t.urls_flv instanceof Array?t.urls_flv[0]:"string"==typeof t.urls_flv?t.urls_flv:"",e.urlHls=t.urls_m3u8 instanceof Array?t.urls_m3u8[0]:"string"==typeof t.urls_m3u8?t.urls_m3u8:"",e.urlHttpsFlv=t.urls_https_flv instanceof Array?t.urls_https_flv[0]:"string"==typeof t.urls_https_flv?t.urls_https_flv:"",e.urlHttpsHls=t.urls_https_m3u8 instanceof Array?t.urls_https_m3u8[0]:"string"==typeof t.urls_https_m3u8?t.urls_https_m3u8:"",e.urlRtmp=t.urls_rtmp instanceof Array?t.urls_rtmp[0]:"string"==typeof t.urls_rtmp?t.urls_rtmp:""},t.prototype.loginBodyData=function(){return{id_name:this.stateCenter.idName,nick_name:this.stateCenter.nickName,role:this.stateCenter.role,token:this.stateCenter.token,version:o.PROTO_VERSION,room_name:this.stateCenter.roomid,user_state_flag:this.stateCenter.userStateUpdate?1:0,room_create_flag:this.stateCenter.roomCreateFlag,client_type:o.E_CLIENT_TYPE.ClientType_Webrtc,third_token:this.stateCenter.third_token}},t.prototype.screenStreamFrom=function(e,t,r){var n=this,i={};i.audio={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e}},i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:window.screen.width,maxHeight:window.screen.height}},!t&&(i.audio=!1),navigator.mediaDevices.getUserMedia(i).then((function(e){n.stateCenter.screenShotStream=e,r(!0,e)})).catch((function(e){n.logger.error("zc.b.ssf "+e),r(!1,null,e)}))},t.prototype.filterStreamList=function(e){var t={},r={},n={},i=[],s=0;for(var o in this.stateCenter.streamList.forEach((function(t,r){t.stream_id==e&&(s=r)})),this.stateCenter.streamList[s])"urls_flv"!=o&&"urls_https_flv"!=o||(t[o]=this.stateCenter.streamList[s][o]),"urls_m3u8"!=o&&"urls_https_m3u8"!=o||(r[o]=this.stateCenter.streamList[s][o]),"urls_rtmp"==o&&(n[o]=this.stateCenter.streamList[s][o]);var a=window.location.protocol,c=window.navigator.userAgent;if(/Safari/.test(c)&&!/Chrome/.test(c))for(var o in r)r[o]&&r[o].forEach((function(e){-1!==e.indexOf(a)&&i.push(e)}));else if("http:"==a)for(var o in t)t[o]&&t[o].forEach((function(e){-1===e.indexOf("http")&&-1===e.indexOf("https")||i.push(e)}));else if("https:"==a)for(var o in t)t[o]&&t[o].forEach((function(e){-1!==e.indexOf(a)&&i.push(e)}));else if("rtmp:"==a)for(var o in n)n[o]&&n[o].forEach((function(e){-1!==e.indexOf(a)&&i.push(e)}));return i.filter((function(e,t,r){return r.indexOf(e)==t}))},t.prototype.voiceChange=function(e,t){if(!e||"number"!=typeof e)return this.logger.error("zc.vc.0 mult error"),!1;if(!t||"string"!=typeof t)return this.logger.error("zc.vc.0 stream id error"),!1;var r=this.getPublisher(t);return r?r.voiceChange(e):void 0},t.prototype.voiceBack=function(e){var t=this.getPublisher(e);if(t)return t.voiceBack()},t.prototype.checkSystemRequirements=function(){var e=navigator&&navigator.mediaDevices&&(t.screenShotReady||"getDisplayMedia"in navigator.mediaDevices);return new Promise((function(t){l.ClientUtil.supportDetection(e,t)}))},t.prototype.enumDevices=function(){return new Promise((function(e,r){t.getDevices(e,r)}))},t.getDevices=function(e,t){void 0!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(t){for(var r=[],n=[],i=[],s=0;s<t.length;s++){var o=t[s];"audioinput"===o.kind&&r.push({deviceName:o.label,deviceID:o.deviceId}),"audiooutput"===o.kind&&n.push({deviceName:o.label,deviceID:o.deviceId}),"videoinput"===o.kind&&i.push({deviceName:o.label,deviceID:o.deviceId})}e&&e({microphones:r,speakers:n,cameras:i})})).catch((function(e){console.error("enumerate devices wrong "+e),t&&t(g.commonErrorList.ENUMERATE_DEVICES_FAIL)})):t&&t(g.publishErrorList.BROWSER_NOT_SUPPORT)},t.prototype.getAudioInfo=function(e,t,r){if(!e)return console.error("loclStream is empty!"),!1;var n=s({},r);return new p.MediaUtil(n).connectToSource(e,(function(e){t(e)}))},t.handleDataAvailable=function(e){e.data&&e.data.size>0&&t.recordedBlobs.push(e.data)},t.prototype.startRecord=function(e){var r=e.captureStream();t.recordedBlobs=[];var n={mimeType:"video/webm;codecs=vp9"};f.ZegoMediaRecorder.isTypeSupported(n.mimeType)||(n={mimeType:"video/webm;codecs=vp8"},f.ZegoMediaRecorder.isTypeSupported(n.mimeType)||(n={mimeType:"video/webm"},f.ZegoMediaRecorder.isTypeSupported(n.mimeType)||(n={mimeType:""})));try{t.mediaRecorder=new f.ZegoMediaRecorder(r,n)}catch(e){return void console.error("Exception while creating ZegoMediaRecorder:",e)}t.mediaRecorder.onstop=function(e){console.log("Recorder stopped: ",e)},t.mediaRecorder.ondataavailable=t.handleDataAvailable,t.mediaRecorder.start(10)},t.prototype.stopRecord=function(){t.mediaRecorder?t.mediaRecorder.stop():console.warn("please invoke startRecord first")},t.prototype.resumeRecord=function(){t.mediaRecorder?t.mediaRecorder.resume():console.warn("please invoke startRecord first")},t.prototype.pauseRecord=function(){t.mediaRecorder?t.mediaRecorder.pause():console.warn("please invoke startRecord first")},t.prototype.saveRecord=function(e){if(t.mediaRecorder&&t.recordedBlobs){var r=new Blob(t.recordedBlobs,{type:"video/webm"}),n=window.URL.createObjectURL(r),i=document.createElement("a");i.style.display="none",i.href=n,i.download=e+".webm",document.body.appendChild(i),i.click(),setTimeout((function(){document.body.removeChild(i),window.URL.revokeObjectURL(n)}),100)}else console.warn("please invoke startRecord first")},t.prototype.takeSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var n=r.getContext("2d");n&&n.drawImage(e,0,0,r.width,r.height),t.src=r.toDataURL("image/jpeg")}else console.error("video can not empty")},t.prototype.saveSnapShot=function(e,t){if(e&&0!==e.videoHeight){var r=document.createElement("canvas");r.width=e.videoWidth,r.height=e.videoHeight;var n=r.getContext("2d");n&&n.drawImage(e,0,0,r.width,r.height),r.toBlob((function(e){var r=window.URL.createObjectURL(e),n=document.createElement("a");n.style.display="none",n.href=r,n.download=t+".jpeg",document.body.appendChild(n),n.click(),setTimeout((function(){document.body.removeChild(n),window.URL.revokeObjectURL(r)}),100)}))}else console.error("video can not empty")},t.prototype.useVideoDevice=function(e,t){this.setPublishStreamConstraints(e,{videoInput:t})},t.prototype.useAudioDevice=function(e,t){this.setPublishStreamConstraints(e,{audioInput:t})},t.prototype.bindWindowListener=function(){var e=this,t=navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPhone/i)?"pagehide":"beforeunload";window.addEventListener(t,(function(){for(var t in window.event&&(window.event.cancelBubble=!0),e.streamCenter.publisherList)e.stopPublishingStream(t);for(var t in e.streamCenter.playerList)e.stopPlayingStream(t);console.log(e.streamCenter.playerList),console.log(e.streamCenter.publisherList),e.logoutRoom(e.stateCenter.roomid)})),window.addEventListener("message",(function(t){var r=t.data,n=r.type,i=r.streamID,s=r.canRequestAudioTrack;"SS_DIALOG_SUCCESS"===n&&e.screenStreamFrom(i,s,l.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)),"SS_DIALOG_CANCEL"===n&&(e.logger.error("zc.b.ss "+n),l.ClientUtil.actionSuccessCallback("screenShare",e.stateCenter.callbackList)(!1,null,n))}))},t.prototype.onPublishStateUpdateHandle=function(e,t,r){var n=this;0==e?this.stateCenter.publishStreamList[t]&&(this.stateCenter.publishStreamList[t].state==o.ENUM_PUBLISH_STREAM_STATE.tryPublish?(this.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.update_info,this.streamHandler.updateStreamInfo(t,o.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info,(function(e){n.stateCenter.publishStreamList[t]&&n.stateCenter.publishStreamList[t].state==o.ENUM_PUBLISH_STREAM_STATE.update_info&&(n.stateCenter.publishStreamList[t].state=o.ENUM_PUBLISH_STREAM_STATE.stop,n.streamHandler.onPublishStateUpdate(o.ENUM_PUBLISH_STATE_UPDATE.error,t,e),n.streamCenter.stopPlayingStream(t))}))):this.WebrtcOnPublishStateUpdateHandle(e,t,r)):(this.streamHandler.onPublishStateUpdate(e,t,r),1==e&&this.stopPublishingStream(t))},t.screenShotReady=!1,t}(u.BaseCenter);t.ZegoExpressEngine=m,window.addEventListener("message",(function(e){var t=e.data.type,r=e.origin;r!==window.location.origin&&console.warn("ScreenStream: you should discard foreign event from origin:",r),"SS_PING"===t&&(m.screenShotReady=!0)}))},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(8),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.openWebSocketLogServer=function(e){if(this.url!=e){if(this.url=e,!e)return;if(null!=this.websocket&&2!=this.websocket.readyState&&3!=this.websocket.readyState)return;this.stopWebSocketServer(),this.websocket=new WebSocket(e),this.websocket.onopen=function(e){},this.websocket.onclose=function(e){console.error("onclose   websocket error:",e)},this.websocket.onmessage=function(e){},this.websocket.onerror=function(e){console.error("open log websocket error:"+e)}}},t.prototype.SendHttpsLog=function(){var e=this;if(0!=this.logCacheSend.length){var t=this.logCacheSend.join("\n"),r=new XMLHttpRequest;r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){if(0==r.responseText.length)return;try{var t=JSON.parse(r.responseText).interval;"number"==typeof t&&e.logUploadInterval!==t&&(e.timeInterval=t,e.openHttpsLogServer(e.url))}catch(e){console.log("send result failed "+e)}}else console.log("send failed "+r.status)},r.open("POST",this.url,!0),r.send(t),this.logCacheSend=[]}},t.prototype.logReportParamList=function(e,t){var r=new Date,n=r.getFullYear()+"/";return n+=(s.D[r.getMonth()+1]||r.getMonth()+1)+"/",n+=(s.D[r.getDate()]||r.getDate())+" ",n+=(s.D[r.getHours()]||r.getHours())+":",n+=(s.D[r.getMinutes()]||r.getMinutes())+":",n+=s.D[r.getSeconds()]||r.getSeconds(),n+="."+r.getTime()%1e3,t.time=n,t.level=e,t.console="rtc",t.appid=this.appid,t.roomid=this.roomid,t.userid=this.userid,t.id_name=this.userid,t.userName=this.userName,t.sessionid=this.sessionid,t.version=this.version,[JSON.stringify(t)]},t}(s.Logger);t.LoggerWeb=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.D=["00","01","02","03","04","05","06","07","08","09"];var i=function(){function e(e){this.logLevel=n.ENUM_LOG_LEVEL.info,this.logUploadTimer=null,this.logUploadInterval=1e4,this.logCache=[],this.logCacheSend=[],this.logCacheMax=100,this.stateCenter=e}return e.prototype.setLogLevel=function(e){this.logLevel<n.ENUM_LOG_LEVEL.debug||this.logLevel>n.ENUM_LOG_LEVEL.report?this.logLevel=n.ENUM_LOG_LEVEL.disable:this.logLevel=e},e.prototype.setRemoteLogLevel=function(e){this.logRemoteLevel<n.ENUM_LOG_LEVEL.debug||this.logRemoteLevel>n.ENUM_LOG_LEVEL.report?this.logRemoteLevel=n.ENUM_LOG_LEVEL.disable:this.logRemoteLevel=e},e.prototype.setSessionInfo=function(e,t,r,n,i,s){this.appid=e,this.roomid=t,this.sessionid=r,this.userid=n,this.userName=i,this.version=s},e.prototype.openLogServer=function(e){try{e.startsWith("wss:")?(this.logType=n.ENUM_REMOTE_TYPE.websocket,this.openWebSocketLogServer(e)):e.startsWith("https:")?(this.logType=n.ENUM_REMOTE_TYPE.https,this.openHttpsLogServer(e)):this.logType=n.ENUM_REMOTE_TYPE.disable}catch(e){this.error(JSON.stringify(e))}},e.prototype.stopLogServer=function(){this.logType==n.ENUM_REMOTE_TYPE.websocket?this.stopWebSocketServer():this.logType==n.ENUM_REMOTE_TYPE.https&&(this.SendHttpsLog(),this.stopHttpsServer()),this.logType=n.ENUM_REMOTE_TYPE.disable},e.prototype.stopWebSocketServer=function(){this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.openHttpsLogServer=function(e){var t=this;this.url=e,e&&(this.stopHttpsServer(),this.logUploadTimer||(this.logUploadTimer=setInterval((function(){t.SendHttpsLog()}),this.logUploadInterval)))},e.prototype.stopHttpsServer=function(){this.logUploadTimer&&(clearInterval(this.logUploadTimer),this.logUploadTimer=null)},e.prototype.report=function(e){var t=this.logReportParamList(n.ENUM_LOG_LEVEL.report,e);this.logLevel!==n.ENUM_LOG_LEVEL.disable&&this.logLevel<=n.ENUM_LOG_LEVEL.report&&console.debug(t),this.RemoteLog(n.ENUM_LOG_LEVEL.report,t,!0)},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(n.ENUM_LOG_LEVEL.debug,e.join(""));this.logLevel!==n.ENUM_LOG_LEVEL.disable&&this.logLevel<=n.ENUM_LOG_LEVEL.debug&&console.debug(r),this.log(n.ENUM_LOG_LEVEL.debug,r)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(n.ENUM_LOG_LEVEL.info,e.join(""));this.logLevel!==n.ENUM_LOG_LEVEL.disable&&this.logLevel<=n.ENUM_LOG_LEVEL.info&&console.info(r),this.log(n.ENUM_LOG_LEVEL.info,r)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(n.ENUM_LOG_LEVEL.warn,e.join(""));this.logLevel!==n.ENUM_LOG_LEVEL.disable&&this.logLevel<=n.ENUM_LOG_LEVEL.warn&&console.warn(r),this.log(n.ENUM_LOG_LEVEL.warn,r)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=this.logParamList(n.ENUM_LOG_LEVEL.error,e.join(""));this.logLevel!==n.ENUM_LOG_LEVEL.disable&&this.logLevel<=n.ENUM_LOG_LEVEL.error&&(console.error(r),window?this.stateCenter.debug&&window.alert(e.join("").substr(e.join("").indexOf(" ")+1,4500)):wx&&this.stateCenter.debug&&wx.showModal({title:"",content:e.join("").substr(e.join("").indexOf(" ")+1,4500)})),this.log(n.ENUM_LOG_LEVEL.error,r)},e.prototype.log=function(e,t){this.logRemoteLevel!==n.ENUM_LOG_LEVEL.disable&&this.logRemoteLevel<=e&&this.RemoteLog(e,t)},e.prototype.RemoteLog=function(e,t,r){if(void 0===r&&(r=!1),""!=this.url)if(this.logType==n.ENUM_REMOTE_TYPE.websocket)this.RemoteWebSocketLog(e,t);else if(this.logType==n.ENUM_REMOTE_TYPE.https)this.RemoteHttpsLog(e,t,r);else if(this.logLevel!==n.ENUM_LOG_LEVEL.disable&&this.logLevel<=e)for(this.logCacheSend.push(t);this.logCacheSend.length>this.logCacheMax;)this.logCacheSend.shift()},e.prototype.RemoteWebSocketLog=function(e,t){if(null==this.websocket||2==this.websocket.readyState||3==this.websocket.readyState){var r=this.url;this.url="",this.openLogServer(r),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)}else if(0==this.websocket.readyState)this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t);else if(1==this.websocket.readyState)if(this.logCacheSend.length>0){for(var n="",i=0;i<this.logCacheSend.length;i++)(n+this.logCacheSend[i]).length>4e3&&(this.websocket.send(n),n=""),n=n+this.logCacheSend[i]+"\n";t=n+t,this.logCacheSend=[],this.websocket.send(t)}else this.websocket.send(t);else console.warn("wrong socket state:"+this.websocket.readyState),this.logCacheSend.length<this.logCacheMax&&this.logCacheSend.push(t)},e.prototype.RemoteHttpsLog=function(e,t,r){this.logCacheSend.push(t),(this.logCacheSend.length>=this.logCacheMax||!0===r)&&this.SendHttpsLog()},e.prototype.logParamList=function(e,r){var n=new Date,i=n.getFullYear()+"/";i+=(t.D[n.getMonth()+1]||n.getMonth()+1)+"/",i+=(t.D[n.getDate()]||n.getDate())+" ",i+=(t.D[n.getHours()]||n.getHours())+":",i+=(t.D[n.getMinutes()]||n.getMinutes())+":",i+=t.D[n.getSeconds()]||n.getSeconds(),i+="."+n.getTime()%1e3;var s=r.substr(0,r.indexOf(" "));0==s.length&&(s=r);var o=r.substr(r.indexOf(" ")+1,4500);0==o.length&&(o="");var a={time:i,level:e,action:s,content:o,appid:this.appid,roomid:this.roomid,userid:this.userid,userName:this.userName,sessionid:this.sessionid};return JSON.stringify(a)},e}();t.Logger=i},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),s=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n};Object.defineProperty(t,"__esModule",{value:!0});var o=r(10),a=r(11),c=r(12),l=r(1),d=r(3),u=r(0),h=r(15),p=r(16),f=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.testEnvironment=!1,n.heartbeatTimer=null,n.heartbeatInterval=1e4,n.qualityTimerInterval=3e3,n.maxRetryCount=5,n.previewVideoList=[],n.signalList={},n.chargeInfos={itemtype:"ChargeInfos",timestamp_begin:0,timestamp_end:0,timestamp_diff_flag:0,timestamp_diff:0,infos:[]},n.chargeInfosTimer=null,n.chargeInfosInterval=6e4,n.chargeInfoSeq=0,n.tryCountConnectInterval=3e3,n.checkMessageTimeout=function(){for(var e in n.signalList)n.signalList[e].signal&&n.signalList[e].signal.checkMessageTimeout()},n.getAllInUseUrl=function(){var e=[];for(var t in n.signalList)e.push(t);return e},n.onDisconnectHandle=function(e){if(n.logger.info("zsc.od.0 call"),n.signalList[e]){for(var t=n.signalList[e],r=0;r<t.publishConnectedList.length;r++){var i=n.publisherList[t.publishConnectedList[r]];i&&i.publisher&&i.publisher.onDisconnect()}for(r=0;r<t.playConnectedList.length;r++){var s=n.playerList[t.playConnectedList[r]];s&&s.player&&s.player.onDisconnect()}delete n.signalList[e],n.stopSignalHeartbeat()}},n.logger=t,n.stateCenter=r,n.dataReport=new o.ZegoDataReport(n.logger),n}return i(t,e),t.prototype.onSignalDisconnected=function(e){},t.prototype.setQualityMonitorCycle=function(e){var t=this;return this.logger.debug("zsc.qmc.0 timeInterval "+e),0==Object.keys(this.publisherList).length?this.qualityTimerInterval=e:Object.keys(this.publisherList).forEach((function(r){t.publisherList[r].publisher.qualityTimeInterval=e,t.publisherList[r].publisher.setPublishQualityTimer()})),!0},t.prototype.setSessionInfo=function(e,t,r,n){this.logger.debug("zsc.ssi.0 called"),this.appid=e,this.userid=t,this.token=r,this.testEnvironment=n},t.prototype.onPlayStateUpdate=function(e,t,r){},t.prototype.onPlayQualityUpdate=function(e,t){},t.prototype.onPublishStateUpdate=function(e,t,r){},t.prototype.onPublishQualityUpdate=function(e,t){},t.prototype.onUpdateHeartBeartIntervalHandle=function(e){e!=this.heartbeatInterval&&(this.logger.debug("zsc.uhb.0 update "+e),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatInterval=e,this.startSignalHeartbeat())},t.prototype.enableMicrophone=function(e,t){var r=this.checkPreview(e);return r?r.enableMicrophone(t,this):(this.logger.error("zsc.em.0 no preview"),!1)},t.prototype.enableCamera=function(e,t){var r=this.checkPreview(e);return r?r.enableCamera(t,this):(this.logger.error("zsc.ec.0 no preview"),!1)},t.prototype.startPreview=function(e,t,r){var n=null;return n=new a.ZegoPreview(this.logger),this.previewVideoList.push(n),n.startPreview(e,t,r),this.logger.debug("zsc.sp.0 call success"),!0},t.prototype.stopPreview=function(e){if(!e)return this.logger.warn("zsc.sp.0 localStream null"),!1;for(var t in this.publisherList)this.publisherList[t].localStream===e&&(this.publisherList[t].localStream=null);var r=this.checkPreview(e);return r?(r.previewSuc&&(r.stopPreview(),this.removePreview(r)),!0):(this.logger.warn("zsc.sp.0 no preview"),!1)},t.prototype.setPublishStateStart=function(e,t,r){var n=this,i=this.getTotalStreamId(e);if(this.publisherList[i])return this.logger.error("zsc.pss.0 publisher already exist"),!1;var s=new c.ZegoPublish(this.logger,null,this.dataReport,this.qualityTimerInterval,this);return s.onPublishStateUpdate=function(t,r,i){var s=n.publisherList[r];s?n.onPublishStateUpdate(t,s.streamID,i):n.logger.error("zsc.psuh.0 cannot find publish "+e)},s.onPublishQualityUpdate=function(t,r){n.publisherList[t]?n.onPublishQualityUpdate(t,r):n.logger.error("zsc.psuh.0 cannot find publish "+e)},this.publisherList[i]={localStream:t,publisher:s,serverUrls:[],retryCount:0,streamID:e,publishOption:r,tryCountConnect:1,countConnectTimer:void 0},this.dataReport.eventStart(s.reportSeq,"GetSignalUrl"),!0},t.prototype.getTotalStreamId=function(e){if(this.testEnvironment){var t="zegotest-"+this.appid+"-"+e;return this.logger.info("zsc.gts.0 test streamid "+t),t}return e},t.prototype.startPublishingStream=function(e,t){this.logger.info("zsc.sps.0 call");var r=this.getTotalStreamId(e),n=this.publisherList[r];if(!n)return this.logger.error("zsc.sps.0 publisher don't exist"),!1;var i=n.publisher;if(this.dataReport.eventEndWithMsg(i.reportSeq,"GetSignalUrl",{urls:t}),!t||0===t.length)return this.onPublishStateUpdate(d.ENUM_PUBLISH_STATE_UPDATE.error,e,l.publishErrorList.DISPATCH_ERROR),this.logger.info("zsc.sps.0 server don't have signal url"),!1;n.serverUrls=s(n.serverUrls,t);var o=t.indexOf(this.server);return-1!==o&&(n.serverUrls.splice(o,1),n.serverUrls.unshift(this.server)),this.connectPublishServer(r)},t.prototype.updateWaitingList=function(e,t,r,n,i){t?e.publishWaitingList.push({streamID:r,success:n,error:i}):e.playWaitingList.push({streamID:r,success:n,error:i})},t.prototype.publishStream=function(e){var t=this.publisherList[e].publisher;if(t){var r=null,n=null,i=this.publisherList[e].publishOption,s=this.checkPreview(this.publisherList[e].localStream);s?(r=s.localStream,n=s.videoInfo,r?(this.logger.debug("zsc.ps.0 call success"),t.startPublish(e,r,n,s.mediaStreamConfig,i)):this.logger.error("zsc.ps.0 no localStream found")):this.logger.error("zsc.ps.0 no preview found")}else this.logger.info("zsc.ps.0 publisher don't exist")},t.prototype.connectPublishServer=function(e,t){var r=this,n=this.publisherList[e];return n?(this.dataReport.eventStart(n.publisher.reportSeq,"ConnectServer"),this.connetWithReuseSignalServerTimer(e,!0,(function(e,t,n){var i=r.publisherList[e];if(i){var s=i.publisher;if(s){r.dataReport.eventEndWithMsg(s.reportSeq,"ConnectServer",{result:0,server:n});var o=t.tokenInfo;r.logger.info("zsc.cps.0 update token success"),o&&o.report&&(s.qualityUpload=o.report,s.qualityUploadInterval=o.report_interval),s.signal=t.signal,i.retryCount=0,r.server=n,r.publishStream(e),r.getTokenSuccess()}else r.logger.info("zsc.cps.1 check publisher don't exist")}else r.logger.info("zsc.cps.0 after connect publisher don't exist")}),(function(e,t){r.logger.error("zsc.cps.0 update token failed "+t);var n=r.publisherList[e];n?r.shouldRetry(n,t)?(r.logger.info("zsc.cps.1 retry connect"),n.serverUrls.splice(0,1),n.retryCount+=1,r.connectPublishServer(e)):r.onPublishStateUpdate(d.ENUM_PUBLISH_STATE_UPDATE.error,e,l.publishErrorList.TOKEN_ERROR):r.logger.info("zsc.cps.0 after connect publisher don't exist")}),t),!0):(this.logger.error("zsc.cps.0 publisher don't exist"),!1)},t.prototype.shouldRetry=function(e,t){return 0!=e.serverUrls.length&&!(e.retryCount>=this.maxRetryCount)&&3==t},t.prototype.getTokenSuccess=function(){this.logger.debug("zsc.gts.0 call")},t.prototype.stopPublishingStream=function(e){var t=this.getTotalStreamId(e),r=this.publisherList[t];r?(delete this.publisherList[t],r.publisher&&(r.publisher.stopPublish(),delete r.publisher),this.removeStreamFromSignal(!0,t),this.stopSignalHeartbeat(),this.logger.debug("zsc.sps.0.1 call success")):this.logger.warn("zsc.sps.0.1 publisher don't exist")},t.prototype.setStreamAudioOutput=function(e,t){var r=this;return!(null==t||0==t.length||!e||(this.logger.debug("zsc.ssao.0 device "+t),e?"undefined"!==e.sinkId?(e.setSinkId(t).then((function(){r.logger.info("zsc.ssao.0 success device: "+t)})).catch((function(e){r.logger.info("zsc.ssao.0 "+e.name)})),0):(this.logger.error("zsc.ssao.0 browser does not suppport"),1):(this.logger.error("zsc.ssao.0 no localVideo"),1)))},t.prototype.connetWithReuseSignalServer=function(e,t,r,n,i,s){var o=this;this.logger.info("zsc.crss.0 begin "+r);var a=null;if(this.signalList[r]&&!s)(a=this.signalList[r]).state==u.ENUM_SIGNAL_STATE.connected?(this.logger.info("zsc.crss.0 already connected "+r+" streamId: "+e),t?a.publishConnectedList.push(e):a.playConnectedList.push(e),n(e,a)):a.state==u.ENUM_SIGNAL_STATE.connecting&&(this.logger.debug("zsc.crss.0 signal is connecting "+r+" streamId: "+e),this.updateWaitingList(a,t,e,n,i));else{this.logger.info("zsc.crss.0 new signal "+r+" streamId: "+e);var c=new h.ZegoSignal(this.logger,this.stateCenter);c.setSessionInfo(this.appid,this.userid),c.onUpdateHeartBeartInterval=this.onUpdateHeartBeartIntervalHandle,c.onDisconnect=this.onDisconnectHandle,this.signalList[r]={signal:c,state:u.ENUM_SIGNAL_STATE.connecting,publishWaitingList:[],playWaitingList:[],publishConnectedList:[],playConnectedList:[],tokenInfo:null},this.updateWaitingList(this.signalList[r],t,e,n,i),c.connectServer(this.token,r,(function(e,t,n){a=o.signalList[r];var i,s,c=0;if(0!=e){for(o.logger.debug("zsc.crss.0 connect failed "+t),c=0;c<a.publishWaitingList.length;c++)(i=a.publishWaitingList[c]).error&&i.error(i.streamID,e);for(c=0;c<a.playWaitingList.length;c++)(s=a.playWaitingList[c]).error&&s.error(s.streamID,e);delete o.signalList[r]}else{for(o.logger.debug("zsc.crss.0 connected success "+t),a.state=u.ENUM_SIGNAL_STATE.connected,a.tokenInfo=n,c=0;c<a.publishWaitingList.length;c++)(i=a.publishWaitingList[c]).success&&i.success(i.streamID,a),a.publishConnectedList.push(i.streamID);for(c=0;c<a.playWaitingList.length;c++)(s=a.playWaitingList[c]).success&&s.success(s.streamID,a),a.playConnectedList.push(s.streamID);a.publishWaitingList=[],a.playWaitingList=[],null==o.heartbeatTimer&&o.startSignalHeartbeat(),null==o.chargeInfosTimer&&o.startChargeInfosUpload()}}))}},t.prototype.setPlayStateStart=function(e,t){var r=this.getTotalStreamId(e);if(this.playerList[r])return this.logger.warn("zsc.pss.1 player already exist"),!1;var n=new p.ZegoPlayWeb(this.logger,null,this.dataReport,this.qualityTimerInterval,this);return n.onPlayStateUpdate=this.onPlayStateUpdate,n.onPlayQualityUpdate=this.onPlayQualityUpdate,n.onRemoteCameraStatusUpdate=this.onRemoteCameraStatusUpdate,n.onRemoteMicStatusUpdate=this.onRemoteMicStatusUpdate,this.playerList[r]={player:n,signal:null,serverUrls:[],retryCount:0,playOption:t,tryCountConnect:1,countConnectTimer:void 0},this.dataReport.eventStart(n.reportSeq,"GetSignalUrl"),!0},t.prototype.startPlayingStream=function(e,t,r){this.logger.info("zsc.sps.1 start play called");var n=this.getTotalStreamId(e),i=this.playerList[n];if(!i)return this.logger.error("zsc.sps.1 player don't exist"),!1;var o=i.player;if(this.dataReport.eventEndWithMsg(o.reportSeq,"GetSignalUrl",{urls:t}),0==t.length)return this.onPlayStateUpdate(d.ENUM_PLAY_STATE_UPDATE.error,e,l.playErrorList.DISPATCH_ERROR),this.logger.info("zsc.sps.1 server don't have signal url"),!1;i.serverUrls=s(i.serverUrls,t);var a=t.indexOf(this.server);return-1!==a&&(i.serverUrls.splice(a,1),i.serverUrls.unshift(this.server)),this.connectPlayServer(n,r)},t.prototype.connectPlayServer=function(e,t,r){var n=this,i=this.playerList[e];return i?(this.dataReport.eventStart(i.player.reportSeq,"ConnectServer"),this.connetWithReuseSignalServerTimer(e,!1,(function(e,r,i){var s=n.playerList[e];if(s){var o=s.player;if(o){n.dataReport.eventEndWithMsg(o.reportSeq,"ConnectServer",{result:0,server:i});var a=r.tokenInfo;n.logger.info("zsc.cps.1 update token success"),a&&a.report&&(o.qualityUpload=a.report,o.qualityUploadInterval=a.report_interval),o.signal=r.signal,s.retryCount=0,n.server=i,n.playStream(e,t),n.getTokenSuccess()}else n.logger.error("zsc.cps.1 checkplayer don't exist")}else n.logger.error("zsc.cps.1 after connect player don't exist")}),(function(e,r){var i=n.playerList[e];i?n.shouldRetry(i,r)?(n.logger.info("zsc.cps.1 retry connect"),i.serverUrls[0],i.serverUrls.splice(0,1),i.retryCount+=1,n.connectPlayServer(e,t)):n.onPlayStateUpdate(d.ENUM_PLAY_STATE_UPDATE.error,e,l.playErrorList.TOKEN_ERROR):n.logger.error("zsc.cps.1 after connect player don't exist")}),r),!0):(this.logger.error("zsc.cps.1 player don't exist"),!1)},t.prototype.connetWithReuseSignalServerTimer=function(e,t,r,n,i){var s,o,a=this;if(t&&this.publisherList[e]){if(s=this.publisherList[e].serverUrls,this.publisherList[e].tryCountConnect>3*s.length)return void this.logger.error("zs.crsst.0 beyond max limit");this.publisherList[e].countConnectTimer=setTimeout((function(){a.connetWithReuseSignalServerTimer(e,t,r,n,i)}),this.tryCountConnectInterval),o=s[(this.publisherList[e].tryCountConnect-1)%s.length],this.logger.info("zs.crsst.0 called "+this.publisherList[e].tryCountConnect+" "+o),this.connetWithReuseSignalServer(e,t,o,(function(t,n){a.publisherList[e].tryCountConnect=1,r(t,n,o),clearTimeout(a.publisherList[e].countConnectTimer)}),this.publisherList[e].tryCountConnect===3*s.length?n:void 0,i),++this.publisherList[e].tryCountConnect}else if(!t&&this.playerList[e]){if(s=this.playerList[e].serverUrls,this.playerList[e].tryCountConnect>3*s.length)return void this.logger.error("zs.crsst.0 beyond max limit");this.logger.info("zs.crsst.0 called "+this.playerList[e].tryCountConnect),this.playerList[e].countConnectTimer=setTimeout((function(){a.connetWithReuseSignalServerTimer(e,t,r,n,i)}),this.tryCountConnectInterval),o=s[(this.playerList[e].tryCountConnect-1)%s.length],this.connetWithReuseSignalServer(e,t,o,(function(t,n){a.playerList[e].tryCountConnect=1,r(t,n,o),clearTimeout(a.playerList[e].countConnectTimer)}),this.playerList[e].tryCountConnect===3*s.length?n:void 0,i),++this.playerList[e].tryCountConnect}},t.prototype.playStream=function(e,t){var r=this.playerList[e].player;r?(this.logger.info("zsc.ps.1 call success"),r.startPlay(e,t,this.playerList[e].playOption)):this.logger.warn("zsc.ps.1 player don't exist")},t.prototype.removeStreamFromSignal=function(e,t){var r=[];for(var n in this.signalList){var i=this.signalList[n];if(e){for(var s=0;s<i.publishConnectedList.length;s++)if(i.publishConnectedList[s]===t){this.logger.debug("zsc.rsfs.0 found from publish"),i.publishConnectedList.splice(s,1);break}}else for(var o=0;o<i.playConnectedList.length;o++)if(i.playConnectedList[o]===t){this.logger.debug("zsc.rsfs.0 found from play"),i.playConnectedList.splice(o,1);break}0==i.publishConnectedList.length&&0==i.playConnectedList.length&&(i.signal.disconnectServer(),r.push(n))}for(var a=0;a<r.length;a++)delete this.signalList[r[a]]},t.prototype.stopSignalHeartbeat=function(){this.logger.debug("zsc.ssh.1 call");var e=0;for(var t in this.signalList)e+=1;this.heartbeatTimer&&0==e&&(this.logger.info("zsc.ssh.1 stop"),clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.stopPlayingStream=function(e){var t=this.getTotalStreamId(e),r=this.playerList[t];r?(delete this.playerList[t],r.player&&(r.player.stopPlay(),delete r.player),this.removeStreamFromSignal(!1,t),this.stopSignalHeartbeat(),this.playSuccessCallBack=null,this.logger.debug("zsc.sps.1.1 call success")):this.logger.info("zsc.sps.1.1 player don't exist")},t.prototype.reset=function(){for(var e in this.publisherList)this.publisherList[e].publisher&&this.publisherList[e].publisher.stopPublish();for(var t in this.playerList)this.playerList[t].player&&this.playerList[t].player.stopPlay();for(var r in this.signalList)this.signalList[r].signal&&this.signalList[r].signal.disconnectServer();this.playerList={},this.publisherList={},this.signalList={},this.server="",this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null)},t.prototype.startSignalHeartbeat=function(){var e=this;this.logger.debug("zsc.ssh.0 call"),this.heartbeatTimer&&(clearTimeout(this.heartbeatTimer),this.heartbeatTimer=null),this.heartbeatTimer=setTimeout((function(){e.checkSignalHeartbeat()}),this.heartbeatInterval)},t.prototype.startChargeInfosUpload=function(){var e=this;this.logger.debug("zsc.sciu.0 call"),this.chargeInfosTimer&&(clearTimeout(this.chargeInfosTimer),this.chargeInfosTimer=null),this.chargeInfosTimer=setTimeout((function(){e.checkChargeInfos()}),this.chargeInfosInterval)},t.prototype.checkChargeInfos=function(){this.logger.debug("zsc.cci.0 call");var e={is_publishing:0,play_max_audio_bitrate:0,play_stream_resolution_infos:[]};for(var t in this.chargeInfos.timestamp_begin=(new Date).getTime(),this.publisherList){this.publisherList[t].publisher.state===u.ENUM_PUBLISH_STATE.publishing&&(e.is_publishing=1);break}e.play_max_audio_bitrate=0;var r=function(t){var r=n.playerList[t].player.playStream,i=r&&0!==r.getVideoTracks().length?r.getVideoTracks()[0].getSettings():void 0,s={video_width:i&&i.width?i.width:0,video_height:i&&i.height?i.height:0,count:1};if(!e.play_stream_resolution_infos.find((function(e){return e.video_width==s.video_width&&e.video_height==s.video_height&&(e.count++,!0)}))&&e.play_stream_resolution_infos.push(s),0==s.video_width&&0==s.video_height){var o=1e3*n.playerList[t].player.lastPlayStats.audioBitrate;o>e.play_max_audio_bitrate&&(e.play_max_audio_bitrate=o)}},n=this;for(var i in this.playerList)r(i);0!==this.chargeInfos.timestamp_end?(this.chargeInfos.timestamp_diff=this.chargeInfos.timestamp_begin-this.chargeInfos.timestamp_end,this.chargeInfos.timestamp_diff_flag=1):(this.chargeInfos.timestamp_diff=0,this.chargeInfos.timestamp_diff_flag=0),this.chargeInfos.timestamp_end=(new Date).getTime(),this.chargeInfos.infos=[e],0!==e.play_stream_resolution_infos.length&&e.is_publishing&&this.logger.report(this.chargeInfos),this.chargeInfosTimer&&this.startChargeInfosUpload()},t.prototype.checkSignalHeartbeat=function(){for(var e in this.logger.debug("zsc.csh.0 call"),this.signalList)this.signalList[e].signal&&this.signalList[e].signal.sendHeartbeat();this.heartbeatTimer&&this.startSignalHeartbeat()},t.prototype.checkPreview=function(e){for(var t=0;t<this.previewVideoList.length;t++)if(this.previewVideoList[t].localStream===e)return this.previewVideoList[t];return null},t.prototype.removePreview=function(e){for(var t=0;t<this.previewVideoList.length;t++)if(this.previewVideoList[t]===e){this.previewVideoList.splice(t,1);break}},t.prototype.onPlayerStreamUrlUpdate=function(e,t,r){},t.prototype.getScreenConstrains=function(e){var t={};if("boolean"==typeof e&&e)t={audio:!1,frameRate:15,bitRate:1500};else if("object"==typeof e){switch(e.videoQuality){case 1:t={frameRate:u.ENUM_SCREEM_RESOLUTION_TYPE.LOW.frameRate,bitRate:u.ENUM_SCREEM_RESOLUTION_TYPE.LOW.bitRate};break;case 2:t={frameRate:u.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.frameRate,bitRate:u.ENUM_SCREEM_RESOLUTION_TYPE.MEDIUM.bitRate};break;case 3:t={frameRate:u.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.frameRate,bitRate:u.ENUM_SCREEM_RESOLUTION_TYPE.HIGH.bitRate};break;case 4:"number"!=typeof e.frameRate&&(this.logger.error("zc.gsc.0 screen frameRate must be number "),e.frameRate=15),("number"!=typeof e.bitRate||e.bitRate>3e3)&&(this.logger.error("zc.gsc.0 screen bitRate must be number and lower than 3000"),e.bitRate=1500),t={frameRate:e.frameRate,bitRate:e.bitRate}}t.audio="boolean"==typeof e.audio&&e.audio}return t},t.prototype.createScreenPreviewer=function(e,t){var r=new a.ZegoPreview(this.logger),n=e.getVideoTracks()[0].getSettings();return this.stateCenter.screenShotStream=e,this.previewVideoList.push(r),r.localStream=e,r.videoInfo={width:n.width,height:n.height,frameRate:n.frameRate||0,bitRate:t.bitRate||0},r.previewSuc=!0,r},t.prototype.setPublishStreamConstraints=function(e,t,r,n){var i=this,s=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),o=null;for(var a in this.publisherList)this.publisherList[a].localStream==e&&(o=this.publisherList[a]);if(o){var c=this.checkPreview(e);if(c)if(!t||0==Object.keys(t).length||t.width&&t.width<120||t.height&&t.height<120)this.logger.error("zc.spsc.0 constraints wrong");else{c.mediaStreamConfig.videoInput!==t.videoInput&&delete c.mediaStreamConfig.facingMode&&delete t.facingMode;var d=Object.assign(c.mediaStreamConfig,t);if(d.externalCapture||d.externalMediaStream)this.logger.error("zc.spsc.0 do not support external stream");else{var u=c.getMediaStreamConstraints(d),h=o.publisher.localStream,p=h.clone();if(!o.publisher.peerConnection.getSenders||!o.publisher.peerConnection.getSenders()[0].replaceTrack)return this.logger.error("zc.spsc.0 set publish constraints is not supported"),void(n&&n({code:1,msg:"not supported"}));!s&&h.getTracks().forEach((function(e){return e.stop()})),navigator.mediaDevices.getUserMedia(u).then((function(e){e.getTracks().forEach((function(e){var t=h.getTracks().find((function(t){return t.kind===e.kind}));o.publisher.peerConnection.getSenders().find((function(t){return null!==t.track&&t.track.kind===e.kind})).replaceTrack(e),h.removeTrack(t),h.addTrack(e)})),r&&r()})).catch((function(e){i.logger.error("zc.spsc.0 fail reason ",e.name),p.getTracks().forEach((function(e){var t=h.getTracks().find((function(t){return t.kind===e.kind}));o.publisher.peerConnection.getSenders().find((function(t){return null!==t.track&&t.track.kind===e.kind})).replaceTrack(e),h.removeTrack(t),h.addTrack(e)})),n&&n({code:l.publishErrorList.CONSTRAINTS_ERROR.code,msg:e.name+" "+(e.constraint?"constraint:"+e.constraint:"")})}))}}else this.logger.error("zc.spsc.0 preview no found")}else this.logger.error("zc.spsc.0 publisher not found")},t}(r(17).ZegoStreamCenter);t.ZegoStreamCenterWeb=f},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e){this.log=e,this.dataStatistics={},this.logger=e}return e.prototype.newReport=function(e){this.dataStatistics[e]={abs_time:Date.now(),time_consumed:0,error:0,events:[]}},e.prototype.addMsgExt=function(e,t){this.dataStatistics[e]?this.dataStatistics[e].msg_ext=t:console.warn(e+" not exist")},e.prototype.eventStart=function(e,t){this.dataStatistics[e]?null!=this.dataStatistics[e].events?this.dataStatistics[e].events.push({event:t,abs_time:Date.now(),time_consumed:0}):this.logger.warn("zd.es.0 no events"):this.logger.warn("zd.es.0 no seq match")},e.prototype.eventEnd=function(e,t,r){if(this.dataStatistics[e]){var n=this.dataStatistics[e].events;if(n&&0!==n.length){for(var i=n.length-1;i>=0;i--)if(n[i].event==t&&n[i].time_consumed){n[i].time_consumed=Date.now()-n[i].abs_time;break}}else this.logger.info("zd.ee.0 no events")}else this.logger.info("zd.ee.0 no seq match")},e.prototype.eventEndWithMsg=function(e,t,r){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(i){for(var s=i.length-1;s>=0;s--)if(i[s].event==t&&i[s].time_consumed){i[s].time_consumed=Date.now()-i[s].abs_time,null==i[s].msg_ext&&(i[s].msg_ext={}),i[s].msg_ext=n({},r);break}}else this.logger.warn("zd.ee.0 no events")}else this.logger.warn("zd.ee.0 no seq match")},e.prototype.addEventInfo=function(e,t,r,n){if(this.dataStatistics[e]){var i=this.dataStatistics[e].events;if(null!=i){for(var s=i.length-1;s>=0;s--)if(i[s].event==t&&null!=i[s].time_consumed&&i[s].event==t&&null!=i[s].time_consumed){null==i[s].msg_ext?i[s].msg_ext={}:i[s].msg_ext&&(i[s].msg_ext[r]=n);break}}else this.logger.warn("zd.aei.0 no events")}else this.logger.warn("zd.aei.0 no seq match")},e.prototype.addEvent=function(e,t,r){this.dataStatistics[e]?this.dataStatistics[e].events&&(r?this.dataStatistics[e].events.push({event:t,abs_time:Date.now(),msg_ext:r}):this.dataStatistics[e].events.push({event:t,abs_time:Date.now()})):this.logger.warn("zd.ae.0 no seq match")},e.prototype.uploadReport=function(e,t){var r=this.dataStatistics[e];null!=r&&(r.itemtype=t,r.time_consumed=Date.now()-r.abs_time,this.logger.report(r),delete this.dataStatistics[e])},e}();t.ZegoDataReport=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(1),s=r(3),o=function(){function e(e){var t=this;this.log=e,this.localStream=null,this.videoInfo={},this.previewSuc=!1,this.enableMicrophone=function(e,r){if(!t.localStream)return t.logger.error("zp.em.2 no localStream"),!1;for(var n in t.localStream.getAudioTracks().forEach((function(t){t.enabled=e})),r.publisherList){var i=r.publisherList[n].publisher;i.localStream==t.localStream&&i.signal.sendStreamStatus(s.getSeq(),i.sessionId,t.localStream.getVideoTracks()[0]&&!0===t.localStream.getVideoTracks()[0].enabled?0:2,e?0:2)}return t.logger.debug("zp.em.2 call success"),!0},this.enableCamera=function(e,r){if(!t.localStream)return t.logger.error("zp.ec.2 no localStream"),!1;for(var n in t.localStream.getVideoTracks().forEach((function(t){t.enabled=e})),r.publisherList){var i=r.publisherList[n].publisher;i.localStream==t.localStream&&i.signal.sendStreamStatus(s.getSeq(),i.sessionId,e?0:2,t.localStream.getAudioTracks()[0]&&1==t.localStream.getAudioTracks()[0].enabled?0:2)}return t.logger.debug("zp.ec.2 call success"),!0},this.logger=e}return e.prototype.getMediaStreamConstraints=function(e){var t={audio:null,video:null};if(t.audio=!0,t.video={width:640,height:480,frameRate:15,bitRate:800},console.log("mediaStreamConfig",e),e.audio&&(void 0===e.audioInput&&void 0===e.ANS&&void 0===e.AGC&&void 0===e.AEC?(t.audio={},t.audio.noiseSuppression=!0,t.audio.autoGainControl=!0,t.audio.echoCancellation=!0):(t.audio={},void 0!==e.audioInput&&null!==e.audioInput&&(t.audio.deviceId=e.audioInput),void 0!==e.ANS&&(t.audio.noiseSuppression=e.ANS),void 0!==e.AGC&&(t.audio.autoGainControl=e.AGC),void 0!==e.AEC&&(t.audio.echoCancellation=e.AEC))),e.video){var r=640,i=480,s=15,o=800;if(1===e.videoQuality?(r=n.ENUM_RESOLUTION_TYPE.LOW.width,i=n.ENUM_RESOLUTION_TYPE.LOW.height,s=n.ENUM_RESOLUTION_TYPE.LOW.frameRate,o=n.ENUM_RESOLUTION_TYPE.LOW.bitRate):2===e.videoQuality?(r=n.ENUM_RESOLUTION_TYPE.MEDIUM.width,i=n.ENUM_RESOLUTION_TYPE.MEDIUM.height,s=n.ENUM_RESOLUTION_TYPE.MEDIUM.frameRate,o=n.ENUM_RESOLUTION_TYPE.MEDIUM.bitRate):3===e.videoQuality?(r=n.ENUM_RESOLUTION_TYPE.HIGH.width,i=n.ENUM_RESOLUTION_TYPE.HIGH.height,s=n.ENUM_RESOLUTION_TYPE.HIGH.frameRate,o=n.ENUM_RESOLUTION_TYPE.HIGH.bitRate):4===e.videoQuality?(r=e.width,i=e.height,s=e.frameRate,o=e.bitRate||800):this.logger.info("zp.gmsc.2 user default"),!0===e.horizontal){var a=i;i=r,r=a}t.video={width:r,height:i,frameRate:s,bitRate:o},null!=e.facingMode?t.video.facingMode=e.facingMode:null!=e.videoInput&&null!=e.videoInput&&(t.video.deviceId={exact:e.videoInput}),this.logger.info("zp.gmsc.2 width: "+r+" height: "+i+" rate: "+s)}return t},e.prototype.startPreview=function(e,t,r){var n=this;if(this.logger.debug("zp.sv.2 called"),this.mediaStreamConfig=e,void 0!==navigator.mediaDevices&&null!=navigator.mediaDevices.getUserMedia){if(e.source instanceof MediaStream){var s=e.source.getVideoTracks(),o=s.length>0?s[0].getSettings():{width:0,height:0,frameRate:0};return this.logger.debug("zp.sv.2 use external media stream"),this.previewSuc=!0,this.localStream=e.source,this.videoInfo={width:o.width,height:o.height,frameRate:o.frameRate,bitRate:e.bitRate||0},void(t&&t(this.localStream))}if(e.source instanceof HTMLMediaElement){var a=this.captureStream(e.source);a?(this.videoInfo.bitRate=e.bitRate||0,this.previewSuc=!0,t&&t(a)):r&&r(i.publishErrorList.BROWSER_NOT_SUPPORT)}else{var c=this.getMediaStreamConstraints(e);this.videoInfo=c.video,this.mediaStreamConfig.video=!!c.video,this.mediaStreamConfig.audio=!!c.audio,this.logger.info("zp.sv.2 ",JSON.stringify(c)),navigator.mediaDevices.getUserMedia(c).then((function(e){n.logger.info("zp.sv.2 success"),n.localStream=e,n.previewSuc=!0,t&&t(e)}),(function(e){n.logger.info("zp.sv.2 failed"),r&&r(e.name)}))}}else r&&r(i.publishErrorList.BROWSER_NOT_SUPPORT)},e.prototype.captureStream=function(e){if(!e)return this.logger.info("zp.cs.2 no local video"),null;var t;if(e.captureStream)t=e.captureStream(),this.logger.debug("zp.cs.2 captureStream");else{if(!e.mozCaptureStream)return this.logger.info("zp.cs.2 don't support"),null;t=e.mozCaptureStream(),this.logger.debug("zp.cs.2 mozCaptureStream")}return 0==t.getTracks().length?(this.logger.error("zp.cs.2 external capture tracks no found"),null):(this.localStream=t,this.videoInfo={width:e.videoWidth,height:e.videoHeight,frameRate:0,bitRate:0},this.logger.debug("zp.cs.2 called success"),this.localStream)},e.prototype.stopPreview=function(){if(this.logger.info("zp.sv.2.1 called"),this.localStream){var e=this.localStream.getTracks();e.reverse(),e.forEach((function(e){e.stop()})),this.localStream=null,this.videoInfo={}}},e}();t.ZegoPreview=o},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(3),o=r(1),a=n(r(13)),c=r(4),l=r(5),d=r(14),u=function(){function e(e,t,r,n,o){this.state=i.ENUM_PUBLISH_STATE.stop,this.sessionId=0,this.waitingICETimeInterval=5e3,this.waitingAnswerTimeInterval=5e3,this.candidateInfo=[],this.waitingICETimer=null,this.waitingAnswerTimer=null,this.qualityTimer=null,this.publishQualityList=[],this.maxQualityListCount=10,this.lastPublishStats={},this.reportSeq=s.getSeq(),this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.qualitySeq=0,this.maxRetryCount=3,this.currentRetryCount=0,this.retryState=i.ENUM_RETRY_STATE.didNotStart,this.waitingServerTimerInterval=3e3,this.waitingServerTimer=null,this.videoInfo={width:0,height:0,frameRate:0,bitRate:0},this.mediaStreamConfig=null,this.offerSeq=0,this.qualityCount=0,this.closeSessionSignal=!1,this.audioBitRate=48e3,this.localSdpRevert=!1,this.videoCodec="H264",this.stateNego=i.ENUM_PUBLISH_STATE_NEGO.stop,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.publishEvent=!1,this.nextSignalTryCount=1,this.waittingConnectedTimer=null,this.waittingConnectedInerval=15e3,this.tryingNexitSignal=!1,this.logger=e,this.signal=t,this.dataReport=r,this.qualityTimeInterval=n,this.audioMixing=new c.AudioMixUtil(e),this.streamCenter=o,r.newReport(this.reportSeq)}return e.prototype.publishStateUpdateError=function(e){this.logger.error("zp.psu.0 call "+JSON.stringify(e)),this.state===i.ENUM_PUBLISH_STATE.stop||this.negoTryCount<this.negoTryMaxCount&&this.stateNego<i.ENUM_PUBLISH_STATE_NEGO.iceConnected||(0!=this.sessionId&&this.shouldSendCloseSession(e)&&(this.signal.sendCloseSession(s.getSeq(),this.sessionId,1),this.closeSessionSignal=!0),this.state=i.ENUM_PUBLISH_STATE.stop,this.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.error,this.streamId,e),this.resetPublish())},e.prototype.resetPublish=function(){this.logger.info("zp.rp.0 call"),this.streamId=null,this.state=i.ENUM_PUBLISH_STATE.stop,this.publishEvent=!1,null==this.peerConnection&&null==this.peerConnection||(this.peerConnection.close(),this.peerConnection=null),null!=this.waitingAnswerTimer&&(clearTimeout(this.waitingAnswerTimer),this.waitingAnswerTimer=null),null!=this.waitingICETimer&&(clearTimeout(this.waitingICETimer),this.waitingICETimer=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.waittingConnectedTimer&&(clearTimeout(this.waittingConnectedTimer),this.waittingConnectedTimer=null),this.clearPublishQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId)),this.sessionSeq=0,this.offerSeq=0,this.candidateInfo=[],this.publishQualityList=[],this.qualityUploadLastTime=0,this.currentRetryCount=0,this.retryState=i.ENUM_RETRY_STATE.didNotStart,this.clearTryPublishTimer()},e.prototype.clearTryPublishTimer=function(){null!=this.waitingServerTimer&&(clearTimeout(this.waitingServerTimer),this.waitingServerTimer=null)},e.prototype.clearPublishQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPublishStats={},this.qualityCount=0},e.prototype.shouldSendCloseSession=function(e){return this.state!=i.ENUM_PUBLISH_STATE.stop&&this.state!=i.ENUM_PUBLISH_STATE.waitingSessionRsp},e.prototype.startPublish=function(e,t,r,n,a){var c=this;this.logger.info("zp.sp.0 called"),this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),this.signal&&this.signal.negoTryCount&&(this.negoTryCount=this.signal.negoTryCount),this.signal&&this.signal.negoTryMaxCount&&(this.negoTryMaxCount=this.signal.negoTryMaxCount),e?(this.streamId=e,this.localStream=t,this.mediaStreamConfig=n,this.publishOption=a||{},navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(n.externalCapture||n.externalMediaStream)&&(this.localStream.onaddtrack=function(){c.logger.info("zp.sp.0 Track added");var e=c.localStream.getVideoTracks(),t=c.localStream.getAudioTracks();e.length>1?(c.peerConnection.getSenders().find((function(t){return t.track.kind===e[1].kind})).replaceTrack(e[1]),c.localStream.removeTrack(e[0])):t.length>1&&(c.peerConnection.getSenders().find((function(e){return e.track.kind===t[1].kind})).replaceTrack(t[1]),c.localStream.removeTrack(t[0]))}),r&&(this.videoInfo=r),a&&a.audioBitRate&&(this.audioBitRate=a.audioBitRate),a&&a.videoCodec&&(this.videoCodec=a.videoCodec),this.sessionSeq=s.getSeq(),this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,0,0,e,a&&a.streamParams,(function(e,t,r){c.dataReport.eventEndWithMsg(c.reportSeq,"CreateSession",{sessionId:r.session_id}),c.logger.info("zp.sp.0 sessionId:"+r.session_id),c.sessionSeq==e?0!==r.result?(c.logger.error("zp.sp.0 create session failed "+r.result),c.publishStateUpdateError(o.publishErrorList.CREATE_SESSION_ERROR)):(c.sessionId=r.session_id,c.logger.debug("zp.sp.0 create session success "+c.sessionId),c.onCreatePublishSessionSuccess(r)):c.logger.error("zp.sp.0 seq is not match.")}),(function(e,t){c.dataReport.eventEndWithMsg(c.reportSeq,"CreateSession",{error:e}),c.publishStateUpdateError(o.publishErrorList.SEND_SESSION_TIMEOUT)})),this.state=i.ENUM_PUBLISH_STATE.waitingSessionRsp,this.logger.info("zp.sp.0 called success"),this.stateNego=i.ENUM_PUBLISH_STATE_NEGO.start,this.negoTimer=setTimeout((function(){c.stateNego!==i.ENUM_PUBLISH_STATE_NEGO.iceConnected&&c.negoTryCount<c.negoTryMaxCount?(c.signal.sendCloseSession(s.getSeq(),c.sessionId,1),c.resetPublish(),c.startPublish(e,t,r,n,a),++c.negoTryCount):c.stateNego!==i.ENUM_PUBLISH_STATE_NEGO.iceConnected&&c.negoTryCount===c.negoTryMaxCount&&(c.logger.error("zp.sp.0 waiting timeout"),c.publishStateUpdateError(o.publishErrorList.SERVER_NEGO_TIMEOUT))}),this.negoInterval)):this.logger.error("zp.sp.0 streamId is null")},e.prototype.onCreatePublishSessionSuccess=function(e){var t=this;this.logger.info("zp.ops.0 called");var r=[];e.turn_server&&r.push(e.turn_server),e.stun_server&&r.push(e.stun_server);var n={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info("zp.ops.0 username: "+e.turn_username),this.logger.info("zp.ops.0 credential: "+e.turn_auth_key),this.peerConnection=new RTCPeerConnection(n),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)};var i=[],s=[];this.localStream&&(this.localStream.getTracks().forEach((function(e){t.peerConnection.addTrack(e,t.localStream)})),i=this.localStream.getVideoTracks(),s=this.localStream.getAudioTracks(),console.warn("getConstraints",s&&s[0]&&s[0].getConstraints&&s[0].getConstraints()),i.length>0&&this.logger.info("zp.ops.0 video device: "+i[0].label),s.length>0&&this.logger.info("zp.ops.0 audio device: "+s[0].label));var a={offerToReceiveAudio:s.length>0?1:0,offerToReceiveVideo:i.length>0?1:0};this.logger.info("zp.ops.0 createOffer: "+JSON.stringify(a)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.peerConnection.createOffer(a).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.logger.error("zp.ops.0 create offer error "+e.toString()),t.publishStateUpdateError(o.publishErrorList.CREATE_OFFER_ERROR)})),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,n){t.onRecvCandidateInfo(e,r,n)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,n){t.onRecvCloseSession(e,r,n)})),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,n){t.onRecvMediaDescription(e,r,n)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,n){t.onRecvResetSession(e,r,n)})),this.signal.registerPushCallback("PublishEventPush",this.sessionId,(function(e,r,n){t.onRecvPublishEvent(e,r,n)})),this.logger.debug("zp.ops.0 call success")},e.prototype.onCreateOfferSuccess=function(e){var t=this;0!=this.videoInfo.bitRate&&(e.sdp=this.updateBandwidthRestriction(e.sdp,this.videoInfo.bitRate)),e.sdp=e.sdp.replace(/sendrecv/g,"sendonly"),e.sdp=e.sdp.replace(/useinbandfec=\d+/,"maxaveragebitrate="+this.audioBitRate),/m=video[\s\S]*m=audio/.test(e.sdp)&&(this.localSdpRevert=!0),e.sdp=l.SdpUtil.getSDPByVideDecodeType(e.sdp,this.videoCodec),this.logger.info("zp.oco.0 localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info("zp.oco.0 localSdp2 "+e.sdp.substr(e.sdp.length/2)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then((function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.logger.error("zp.oco.0 error "+e.toString()),t.publishStateUpdateError(o.publishErrorList.SET_LOCAL_DESC_ERROR)}))},e.prototype.updateBandwidthRestriction=function(e,t){var r="AS";return"firefox"===a.browserDetails.browser&&(t=1e3*(t>>>0),r="TIAS"),-1===e.indexOf("b="+r+":")?(e=e.replace(/c=IN (.*)\r\n/g,"c=IN $1\r\nb="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n",""):(e=e.replace(new RegExp("b="+r+":.*\r\n","g"),"b="+r+":"+t+"\r\n")).replace("b="+r+":"+t+"\r\n","")},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;this.logger.info("zp.osd.0 success");var r={sdp:e.sdp,width:this.videoInfo.width,height:this.videoInfo.height,frameRate:this.videoInfo.frameRate,video_min_kpbs:this.videoInfo.bitRate,video_max_kpbs:this.videoInfo.bitRate,audio_kpbs:48,keyframe_intv:2};this.offerSeq=s.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.offerSeq,this.sessionId,0,r,(function(e,r,n){t.offerSeq==e&&t.sessionId==r?(t.logger.info("zp.osd.0 send success"),t.dataReport.eventEnd(t.reportSeq,"SendMediaDesc"),t.waitingAnswerTimer=setTimeout((function(){t.state==i.ENUM_PUBLISH_STATE.waitingServerAnswer&&(t.logger.error("zp.osd.0 waiting timeout"),t.publishStateUpdateError(o.publishErrorList.SERVER_MEDIA_DESC_TIMEOUT))}),t.waitingAnswerTimeInterval),t.logger.info("zp.osd.0 send success stateNego:waiterAnswer"),t.stateNego=i.ENUM_PUBLISH_STATE_NEGO.waiterAnswer,t.state=i.ENUM_PUBLISH_STATE.waitingServerAnswer):t.logger.error("zp.osd.0 seq or sessionId is not equal")}),(function(e,r){t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.publishStateUpdateError(o.publishErrorList.SEND_MEDIA_DESC_TIMEOUT)})),this.state=i.ENUM_PUBLISH_STATE.waitingOffserRsp,this.logger.debug("zp.osd.0 call success")},e.prototype.onRecvMediaDescription=function(e,t,r){this.logger.info("zp.ormd.0 received"),this.state==i.ENUM_PUBLISH_STATE.waitingServerAnswer?(this.stateNego=i.ENUM_PUBLISH_STATE_NEGO.waitingCandidate,this.logger.info("zp.orm.0 received stateNego:waitingCandidate"),null!=this.waitingAnswerTimer&&(clearTimeout(this.waitingAnswerTimer),this.waitingAnswerTimer=null),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0),1==r.type?this.onGetRemoteOfferSucceses(r.sdp):this.publishStateUpdateError(o.publishErrorList.SERVER_MEDIA_DESC_ERROR)):this.logger.info("zp.ormd.0 current state "+this.state+" not allowed")},e.prototype.onGetRemoteOfferSucceses=function(e){var t=this;if(48e3!==this.audioBitRate&&(e=e.replace(/maxaveragebitrate=(\d+)/,"maxaveragebitrate="+this.audioBitRate)),this.localSdpRevert){var r=[/[\s\S]*m=audio/.exec(e)[0].replace("m=audio",""),/m=video[\s\S]*/.exec(e)[0],/m=audio[\s\S]*m=video/.exec(e)[0].replace("m=video","")],n=r[0],s=r[1],a=r[2],c=/a=group:BUNDLE\s+(\w+)\s+(\w+)/.exec(n);e=(n=n.replace(/a=group:BUNDLE\s+(\w+)\s+(\w+)/,"a=group:BUNDLE "+c[2]+" "+c[1]))+s+a}this.logger.info("zp.oro.0 remoteSdp:",e);var l={type:"answer",sdp:e,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.peerConnection.setRemoteDescription(new RTCSessionDescription(l)).then((function(){t.logger.info("zp.oro.0 set success"),t.dataReport.eventEnd(t.reportSeq,"SetRemoteDescription")}),(function(e){t.logger.error("zp.oro.0 failed: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SetRemoteDescription",{error:e.toString()}),t.publishStateUpdateError(o.publishErrorList.SET_REMOTE_DESC_ERROR)})),this.state=i.ENUM_PUBLISH_STATE.waitingServerICE,this.waitingICETimer=setTimeout((function(){t.state==i.ENUM_PUBLISH_STATE.waitingServerICE&&(t.logger.error("zp.orod.0 waiting server timeout"),t.publishStateUpdateError(o.publishErrorList.SERVER_CANDIDATE_TIMEOUT))}),this.waitingICETimeInterval),this.logger.debug("zp.oro.0 call success")},e.prototype.onIceConnectionStateChange=function(e){var t=this;this.state!=i.ENUM_PUBLISH_STATE.stop&&null!=this.peerConnection&&(this.logger.info("zp.oics.0 stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState?(this.logger.info("zp.oics.0 connected state "+this.state),this.dataReport.eventEnd(this.reportSeq,"IceConnected"),this.stateNego=i.ENUM_PUBLISH_STATE_NEGO.iceConnected,this.waittingConnectedTimer&&clearTimeout(this.waittingConnectedTimer),this.waittingConnectedTimer=null,this.logger.info("zp.oisc.0  stateNego:iceConnected"),this.negoTryCount=1,this.nextSignalTryCount=1,this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),this.publishEvent&&this.publishSuccess()):"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPublishConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.waittingConnectedTimer=setTimeout((function(){!t.tryingNexitSignal&&t.tryNextSignal(o.publishErrorList.MEDIA_CONNECTION_DISCONNECTED)}),this.waittingConnectedInerval)))},e.prototype.onIceCandidate=function(e){if(this.logger.info("zp.oic.0 candidate"+e.candidate),e.candidate)if(this.logger.info("zp.oic.0 candidate"+e.candidate.candidate),this.state<i.ENUM_PUBLISH_STATE.connecting||this.state==i.ENUM_PUBLISH_STATE.stop)this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info("zp.sci.0 called"),!(e=e.filter((function(e){return e.candidate.indexOf("relay")>0})))||e.length<1?this.logger.info("zp.sci.0 cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.stateNego!==i.ENUM_PUBLISH_STATE_NEGO.iceConnected&&(this.stateNego=i.ENUM_PUBLISH_STATE_NEGO.sendCandidate),this.logger.info("zp.sci.0  stateNego:sendCandidate"),this.signal.sendCandidateInfo(s.getSeq(),this.sessionId,e,(function(e,r,n){t.logger.info("zp.sci.0 send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error("zp.sci.0 failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.publishStateUpdateError(o.publishErrorList.SEND_CANDIDATE_TIMEOUT)})))},e.prototype.onConnectionStateChange=function(e){this.logger.info("zp.ocs.0 called "+e.target.signalingState)},e.prototype.onRecvCandidateInfo=function(e,t,r){var n=this;if(this.logger.info("zp.oci.0 received "+JSON.stringify(r.infos)),this.state==i.ENUM_PUBLISH_STATE.waitingServerICE){null!=this.waitingICETimer&&(clearTimeout(this.waitingICETimer),this.waitingICETimer=null),this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var s=0;s<r.infos.length;s++){var a={sdpMid:r.infos[s].sdpMid,sdpMLineIndex:r.infos[s].sdpMLineIndex,candidate:r.infos[s].candidate};this.logger.debug("zp.orci.0 candidate "+a.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(a)).then((function(){n.logger.debug("zp.oci.0 add success")}),(function(e){n.logger.error("zp.oci.0 add error "+e.toString()),n.publishStateUpdateError(o.publishErrorList.SERVER_CANDIDATE_ERROR)}))}this.state=i.ENUM_PUBLISH_STATE.connecting,this.dataReport.eventStart(this.reportSeq,"IceConnected")}else this.logger.info("zp.oci.0 current state "+this.state+" not allowed")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info("zp.orcs.0 reason: "+r.reason),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=JSON.parse(JSON.stringify(o.publishErrorList.SESSION_CLOSED));n.msg+=r.reason,this.negoTimer&&clearTimeout(this.negoTimer);var i=1*r.reason,a=r.err_info&&JSON.parse(r.err_info).action?JSON.parse(r.err_info).action:null;if("number"==typeof i&&[26].includes(i)&&this.negoTryCount<this.negoTryMaxCount||5==a){this.logger.info("zp.orcs.0 retry: "+this.streamId);var c=this.streamId,l=this.localStream,d=this.videoInfo,u=this.mediaStreamConfig,h=this.publishOption;this.signal.sendCloseSession(s.getSeq(),this.sessionId,1),this.resetPublish(),this.startPublish(c,l,d,u,h),++this.negoTryCount}else[4,8,10,11,12,27].includes(i)||2==a?!this.tryingNexitSignal&&this.tryNextSignal(n):this.publishStateUpdateError(n)},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info("zp.orrs.0 received "),t==this.sessionId){this.dataReport.addEvent(this.reportSeq,"RecvResetSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=JSON.parse(JSON.stringify(o.publishErrorList.SESSION_CLOSED));this.negoTimer&&clearTimeout(this.negoTimer),this.publishStateUpdateError(n)}else this.logger.error("zp.orrs.0 cannot find session")},e.prototype.onRecvPublishEvent=function(e,t,r){this.logger.info("zp.orpe.0 received"),this.publishEvent=!0,this.stateNego===i.ENUM_PUBLISH_STATE_NEGO.iceConnected&&0==r.event&&this.publishSuccess()},e.prototype.shouldRetryPublish=function(){return this.retryState==i.ENUM_RETRY_STATE.didNotStart&&this.state!=i.ENUM_PUBLISH_STATE.publishing?(this.logger.info("zp.srp.0.0 connection didn't success"),!1):this.retryState==i.ENUM_RETRY_STATE.retrying?(this.logger.info("zp.srp.0.0 already retrying"),!1):this.currentRetryCount>this.maxRetryCount?(this.logger.info("zp.srp.0.0 beyond max"),!1):(this.logger.info("zp.srp.1.0 call success"),!0)},e.prototype.startRetryPublish=function(){this.logger.info("zp.srp.0 call");var e=this.streamId;e?(this.resetPublish(),this.tryStartPublish(e)):this.logger.info("zp.srp.0 no streamid")},e.prototype.tryStartPublish=function(e){var t=this;if(this.logger.info("zp.tsp.0 call"),this.clearTryPublishTimer(),this.streamId=e,this.currentRetryCount>this.maxRetryCount)return this.logger.info("zp.tsp.0 beyond max limit"),void this.publishStateUpdateError(o.publishErrorList.WEBSOCKET_ERROR);this.retryState=i.ENUM_RETRY_STATE.retrying,this.currentRetryCount+=1,this.signal.isServerConnected()?(this.logger.info("zp.tsp.0 signal connected"),this.startPublish(e,this.localStream,this.videoInfo,this.mediaStreamConfig,this.publishOption)):(this.logger.debug("zp.tsp.0 signal server not connected"),this.waitingAnswerTimer=setTimeout((function(){t.tryStartPublish(e),console.warn(new Date)}),this.waitingAnswerTimeInterval))},e.prototype.checkPublishConnectionFailedState=function(e){var t=null;"failed"==e?t=o.publishErrorList.MEDIA_CONNECTION_FAILED:"closed"==e&&(t=o.publishErrorList.MEDIA_CONNECTION_CLOSED),null!=t&&(this.state!=i.ENUM_PUBLISH_STATE.publishing&&this.retryState==i.ENUM_PUBLISH_STATE.didNotStart?(this.logger.info("zp.oics.0  state "+this.state+" retryState "+this.retryState+" connectionState "+e),this.publishStateUpdateError(t)):this.shouldRetryPublish()?(this.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.retry,this.streamId,{code:0,msg:""}),this.startRetryPublish()):this.publishStateUpdateError(t))},e.prototype.setPublishQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.info("zp.spq.0 called"),this.clearPublishQualityTimer(),this.qualityTimer=setInterval((function(){e.peerConnection&&e.peerConnection.getStats(null).then((function(t){e.getPublishStats(t)}),(function(t){e.logger.info("zp.spq.0 getStats error "+t.toString())}))}),this.qualityTimeInterval),this.lastPublishStats={time:0,audioBytesSent:0,videoBytesSent:0,framesEncoded:0,framesSent:0},this.qualitySeq=s.getSeq(),this.qualityCount=0,this.dataReport.newReport(this.qualitySeq))},e.prototype.getPublishStats=function(e){var t=this;if(e){var r={audioCodec:"opus",audioBitrate:0,videoBitrate:0,videoFPS:0,nackCount:0,pliCount:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,totalRoundTripTime:0,currentRoundTripTime:0},n=this.lastPublishStats.time;e.forEach((function(e){("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"audio"==e.mediaType?(0!=n&&(r.audioBitrate=8*(e.bytesSent-t.lastPublishStats.audioBytesSent)/(e.timestamp-n)),r.audioBitrate<0&&(r.audioBitrate=0),t.lastPublishStats.audioBytesSent=e.bytesSent,t.lastPublishStats.time=e.timestamp):("outbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesSent)&&"video"==e.mediaType?(0!=n&&(r.videoBitrate=8*(e.bytesSent-t.lastPublishStats.videoBytesSent)/(e.timestamp-n),r.videoFPS=1e3*(e.framesEncoded-t.lastPublishStats.framesEncoded)/(e.timestamp-n)),r.videoBitrate<0&&(r.videoBitrate=0),r.videoFPS<0&&(r.videoFPS=0),r.nackCount=e.nackCount,r.pliCount=e.pliCount,t.lastPublishStats.videoBytesSent=e.bytesSent,t.lastPublishStats.framesEncoded=e.framesEncoded,t.lastPublishStats.time=e.timestamp):"track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0)?(r.frameHeight=e.frameHeight,r.frameWidth=e.frameWidth,0!=n&&(r.videoTransferFPS=1e3*(e.framesSent-t.lastPublishStats.framesSent)/(e.timestamp-n)),r.videoTransferFPS<0&&(r.videoTransferFPS=0),t.lastPublishStats.framesSent=e.framesSent):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(r.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(r.currentRoundTripTime=e.currentRoundTripTime))})),this.uploadPublishQuality(r);var i={video:{videoBitrate:r.videoBitrate,videoFPS:r.videoFPS,videoTransferFPS:r.videoTransferFPS,frameHeight:r.frameHeight,frameWidth:r.frameWidth},audio:{audioBitrate:r.audioBitrate,audioCodec:r.audioCodec},nackCount:r.nackCount,pliCount:r.pliCount,totalRoundTripTime:r.totalRoundTripTime,currentRoundTripTime:r.currentRoundTripTime};0!=n&&this.onPublishQualityUpdate(this.streamId,i)}},e.prototype.uploadPublishQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="publish",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info("zp.upq.0 upload"+JSON.stringify(e)),this.signal.QualityReport(s.getSeq(),this.sessionId,e,(function(e,r,n){void 0!==n.report&&(t.qualityUpload=n.report,t.qualityUploadInterval=n.report_interval_ms)}),(function(e,r){t.logger.info("zp.upq.0 upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.stopPublish=function(){if(this.logger.info("zp.sp.0.1 called"),Object.keys(this.streamCenter.publisherList).length=1)for(var e in this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==i.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==i.ENUM_BROADCASTER_STATUS.start&&(this.signal&&this.signal.sendBroadcasterStatus(s.getSeq(),t.sessionId,0),t.broadcasterStatus=i.ENUM_BROADCASTER_STATUS.stop)}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(s.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.reportSeq,"PublishState",{state:this.state+""}),this.dataReport.addEvent(this.reportSeq,"StopPublish"),this.dataReport.addMsgExt(this.reportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.uploadReport(this.reportSeq,"RTCPublishStream"),this.resetPublish()},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.onPublishQualityUpdate=function(e,t){},e.prototype.onDisconnect=function(){this.logger.info("zp.od.0 call"),this.logger.info("zp.od.0 websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),!this.tryingNexitSignal&&this.tryNextSignal(o.publishErrorList.WEBSOCKET_ERROR)},e.prototype.playEffect=function(e,t,r,n){this.audioMixing.localStream=this.localStream,this.audioMixing.peerConnection=this.peerConnection,this.audioMixing.audioBuffer=t,this.audioMixing.playEffect(e.playTime,e.loop,e.replace,r,n)},e.prototype.pauseEffect=function(){this.audioMixing.pauseEffect()},e.prototype.resumeEffect=function(){this.audioMixing.resumeEffect()},e.prototype.startMixingAudio=function(e,t){return this.audioMixing.localStream=this.localStream,this.audioMixing.peerConnection=this.peerConnection,this.audioMixing.startMixingAudio(e,t)},e.prototype.stopMixingAudio=function(){return this.audioMixing.stopMixingAudio()},e.prototype.voiceChange=function(e){var t=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext);this.pitchEffect=new d.PitchUtil(t);var r=t.createMediaStreamSource(this.localStream.clone()),n=t.createMediaStreamDestination();if(r.connect(this.pitchEffect.input),this.pitchEffect.output.connect(n),this.pitchEffect.setPitchOffset(e),!this.micTrack){var i=n.stream.getAudioTracks()[0],s=this.peerConnection.getSenders().find((function(e){return e.track.kind===i.kind}));if(!s)return this.logger.error("zp.vc.0 no sender"),!1;this.micTrack=this.localStream.getAudioTracks()[0],s.replaceTrack(i),this.localStream.removeTrack(this.micTrack),this.localStream.addTrack(i)}},e.prototype.voiceBack=function(){var e=this;this.micTrack?(this.peerConnection.getSenders().find((function(t){return t.track.kind===e.micTrack.kind})).replaceTrack(this.micTrack),this.localStream.removeTrack(this.localStream.getAudioTracks()[0]),this.localStream.addTrack(this.micTrack),this.micTrack=null):this.logger.error("zp.vb.0 mo mickTrack found")},e.prototype.publishSuccess=function(){for(var e in this.state!=i.ENUM_PUBLISH_STATE.publishing&&this.onPublishStateUpdate(s.ENUM_PUBLISH_STATE_UPDATE.start,this.streamId,{code:0,msg:""}),this.state=i.ENUM_PUBLISH_STATE.publishing,this.tryingNexitSignal=!1,this.retryState!=i.ENUM_RETRY_STATE.didNotStart&&(this.retryState=i.ENUM_RETRY_STATE.finished,this.currentRetryCount=0),this.dataReport.eventStart(this.reportSeq,"PublishState"),this.streamCenter.playerList){var t=this.streamCenter.playerList[e].player;t.state==i.ENUM_PLAY_STATE.playing&&t.broadcasterStatus==i.ENUM_BROADCASTER_STATUS.stop&&(this.signal&&this.signal.sendBroadcasterStatus(s.getSeq(),t.sessionId,1),t.broadcasterStatus=i.ENUM_BROADCASTER_STATUS.start)}this.setPublishQualityTimer();var r=2,n=2;0!==this.localStream.getVideoTracks().length&&(r=0),0!==this.localStream.getAudioTracks().length&&(n=0),this.signal.sendStreamStatus(s.getSeq(),this.sessionId,r,n)},e.prototype.tryNextSignal=function(e){this.tryingNexitSignal=!0;var t=this.streamId,r=this.signal.server,n=this.streamCenter.publisherList[t],o=[];n&&n.serverUrls&&(o=n.serverUrls),this.nextSignalTryCount>3*o.length?(this.logger.error("zp.tns.0 try max limit"),this.publishStateUpdateError(e)):(o.forEach((function(e,t){return t<=o.indexOf(r)&&o.push(e)})),o.splice(0,o.indexOf(r)+1),this.logger.info("zp.tns.0 try next signal "+t),this.signal&&this.signal.state==i.ENUM_CONNECT_STATE.connected&&this.signal.sendCloseSession(s.getSeq(),this.sessionId,1),this.signal&&this.signal.removeSession(this.sessionId),this.resetPublish(),this.streamCenter.connectPublishServer(t,!0),this.nextSignalTryCount++)},e}();t.ZegoPublish=u},function(e,t,r){var n;e.exports=function e(t,r,i){function s(a,c){if(!r[a]){if(!t[a]){if(!c&&"function"==typeof n&&n)return n(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var d=r[a]={exports:{}};t[a][0].call(d.exports,(function(e){return s(t[a][1][e]||e)}),d,d.exports,e,t,r,i)}return r[a].exports}for(var o="function"==typeof n&&n,a=0;a<i.length;a++)s(i[a]);return s}({1:[function(e,t,r){"use strict";var n=(0,e("./adapter_factory.js").adapterFactory)({window:window});t.exports=n},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).window,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=n.log,l=n.detectBrowser(e),d={browserDetails:l,commonShim:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(l.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),d;r("adapter.js shimming chrome."),d.browserShim=i,i.shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!o||!o.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),d;r("adapter.js shimming firefox."),d.browserShim=o,o.shimGetUserMedia(e),o.shimPeerConnection(e),o.shimOnTrack(e),o.shimRemoveStream(e),o.shimSenderGetStats(e),o.shimReceiverGetStats(e),o.shimRTCDataChannel(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!s||!s.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),d;r("adapter.js shimming edge."),d.browserShim=s,s.shimGetUserMedia(e),s.shimGetDisplayMedia(e),s.shimPeerConnection(e),s.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),d;r("adapter.js shimming safari."),d.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return d};var n=l(e("./utils")),i=l(e("./chrome/chrome_shim")),s=l(e("./edge/edge_shim")),o=l(e("./firefox/firefox_shim")),a=l(e("./safari/safari_shim")),c=l(e("./common_shim"));function l(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./edge/edge_shim":7,"./firefox/firefox_shim":11,"./safari/safari_shim":14,"./utils":15}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var s=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)o.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var s=new Event("track");s.track=n.track,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],r.dispatchEvent(s)})),t.stream.getTracks().forEach((function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=[t.stream],r.dispatchEvent(s)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},r.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],s.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){var i=this,s=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof arguments[0]))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},a=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){s[1](a(o(e)))};return t.apply(this,[c,arguments[0]])}return new Promise((function(e,r){t.apply(i,[function(t){e(a(o(t)))},r])})).then(r,n)}}},r.shimSenderReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return o.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),o.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return o.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,i=void 0;return this.getSenders().forEach((function(e){e.track===t&&(r?i=!0:r=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(n?i=!0:n=e),e.track===t})),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return s.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=a,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=o.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return a(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var s=this.getSenders().find((function(e){return e.track===t}));if(s)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var a=new e.MediaStream([t]);this._streams[r.id]=a,this._reverseStreams[a.id]=r,this.addStream(a)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?r.apply(this,[function(r){var n=l(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return l(e,t)}))}}));var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:l(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var r=void 0;Object.keys(this._streams).forEach((function(n){t._streams[n].getTracks().find((function(t){return e.track===t}))&&(r=t._streams[n])})),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function l(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function d(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var t=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){o.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js"));function a(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}},{"../utils.js":15,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,s=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:s||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=i.detectBrowser(e),o=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===n(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var o={};"number"==typeof i.ideal?(o[s("min",r)]=i.ideal,t.optional.push(o),(o={})[s("max",r)]=i.ideal,t.optional.push(o)):(o[s("",r)]=i.ideal,t.optional.push(o))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",r)]=i.exact):["min","max"].forEach((function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,r)]=i[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,i){if(r.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=o(e.audio)}if(e&&"object"===n(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var l=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||l)){delete e.video.facingMode;var d=void 0;if("environment"===c.exact||"environment"===c.ideal?d=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(d=["front"]),d)return t.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return d.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&d.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=o(e.video),s("chrome: "+JSON.stringify(e)),i(e)}))}e.video=o(e.video)}return s("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,n){a(e,(function(e){t.webkitGetUserMedia(e,r,(function(e){n&&n(c(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var l=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,(function(e){return l(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(c(e))}))}))}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils.js")),s=i.log},{"../utils.js":15}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=s.default.parseCandidate(e.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},r.shimMaxMessageSize=function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=o.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=s.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=s.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},a=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=s.default.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},c=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r(arguments[0])){var e=n(arguments[0]),t=i(e),s=a(arguments[0],e),o=void 0;o=0===t&&0===s?Number.POSITIVE_INFINITY:0===t||0===s?Math.max(t,s):Math.min(t,s);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return o}}),this._sctp=l}return c.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},o.wrapPeerConnectionEvent(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=o.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),r.apply(this,arguments)}}}};var i,s=(i=e("sdp"))&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils"))},{"./utils":15,sdp:17}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimPeerConnection=function(e){var t=o.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,c.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,a.filterIceServers)(e.iceServers,t.version),o.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},r.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var s,o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils")),a=e("./filtericeservers"),c=(s=e("rtcpeerconnection-shim"))&&s.__esModule?s:{default:s}},{"../utils":15,"./filtericeservers":8,"./getdisplaymedia":9,"./getusermedia":10,"rtcpeerconnection-shim":16}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}});var s=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=o.detectBrowser(e);if("object"===(void 0===e?"undefined":n(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,r,n){return s.apply(this,[e||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,n)}}},r.shimSenderGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),o.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15,"./getdisplaymedia":12,"./getusermedia":13}],12:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],13:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,s=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),o(e.audio,"autoGainControl","mozAutoGainControl"),o(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},s&&s.prototype.getSettings){var c=s.prototype.getSettings;s.prototype.getSettings=function(){var e=c.apply(this,arguments);return o(e,"mozAutoGainControl","autoGainControl"),o(e,"mozNoiseSuppression","noiseSuppression"),e}}if(s&&s.prototype.applyConstraints){var l=s.prototype.applyConstraints;s.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),o(e,"autoGainControl","mozAutoGainControl"),o(e,"noiseSuppression","mozNoiseSuppression")),l.apply(this,[e])}}}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"))},{"../utils":15}],14:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e,r){return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.call(this,e,r)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})}},r.shimRemoteStreamsAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,s=t.setLocalDescription,o=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],n=i.apply(this,[r]);return t?(n.then(e,t),Promise.resolve()):n};var c=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(s(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))},r.shimConstraints=s,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],s=0;s<e.iceServers.length;s++){var o=e.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[s])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}};var i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../utils"));function s(e){return e&&void 0!==e.video?Object.assign({},e,{video:i.compactObject(e.video)}):e}},{"../utils":15}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.extractVersion=o,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var s=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=s,i.apply(this,[e,s])};var s=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return s.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],s.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(s=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function(e,t){s&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t=e.navigator,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=o(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=o(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=o(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=o(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return r},r.compactObject=function e(t){return"object"!==(void 0===t?"undefined":n(t))?t:Object.keys(t).reduce((function(r,i){var s="object"===n(t[i]),o=s?e(t[i]):t[i],a=s&&!Object.keys(o).length;return void 0===o||a?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},i,o))}),{})},r.walkStats=a,r.filterStats=function(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var s=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)})),s.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&a(e,r,i)}))})),i};var i=!0,s=!0;function o(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function a(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?a(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((function(t){a(e,e.get(t),r)}))})))}},{}],16:[function(e,t,r){"use strict";var n=e("sdp");function i(e,t,r,i,s){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":s||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o}function s(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var s=n(e.parameters.apt,r),o=n(t.parameters.apt,i);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach((function(n){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(n.name.toLowerCase()===o.name.toLowerCase()&&n.clockRate===o.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&o.parameters.apt&&!i(n,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(n.numChannels,o.numChannels),r.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}})),r}function o(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function a(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,r,n,i){var s=new Event("track");s.track=r,s.receiver=n,s.transceiver={receiver:n},s.streams=i,e.setTimeout((function(){t._dispatchEvent("track",s)}))}var d=function(r){var i=this,s=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=s[e].bind(s)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=i?n[0]:n,!!n.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var o=r.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(d.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(d.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},d.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},d.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),n.getTracks().forEach((function(e){r.addTrack(e,n)}))}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},d.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},d.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},d.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},d.prototype._gather=function(t,r){var i=this,s=this.transceivers[r].iceGatherer;if(!s.onlocalcandidate){var o=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,s.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),s.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var o=new Event("icecandidate");o.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==s.state&&"gathering"!==s.state||(s.state="completed");else{"new"===s.state&&(s.state="gathering"),a.component=1,a.ufrag=s.getLocalParameters().usernameFragment;var l=n.writeCandidate(a);o.candidate=Object.assign(o.candidate,n.parseCandidate(l)),o.candidate.candidate=l,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var d=n.getMediaSections(i._localDescription.sdp);d[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+d.join("");var u=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",o),u&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){o.forEach((function(e){s.onlocalcandidate(e)}))}),0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,r,i){var o=s(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(o.encodings=e.sendEncodingParameters,o.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(o.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(o)),i&&e.rtpReceiver&&o.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?o.encodings=e.recvEncodingParameters:o.encodings=[{}],o.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(o.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(o.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(o))},d.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!o("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var a=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var o=i.transceivers[t],c=o.iceGatherer,l=o.iceTransport,d=o.dtlsTransport,u=o.localCapabilities,h=o.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length||o.rejected)){var p=n.getIceParameters(e,r),f=n.getDtlsParameters(e,r);a&&(f.role="server"),i.usingBundle&&0!==t||(i._gather(o.mid,t),"new"===l.state&&l.start(c,p,a?"controlling":"controlled"),"new"===d.state&&d.start(f));var g=s(u,h);i._transceive(o,g.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(i){var d=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!o("setRemoteDescription",i.type,d.signalingState)||d._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+d.signalingState));var u={};d.remoteStreams.forEach((function(e){u[e.id]=e}));var h=[],p=n.splitSections(i.sdp),f=p.shift(),g=n.matchPrefix(f,"a=ice-lite").length>0,m=n.matchPrefix(f,"a=group:BUNDLE ").length>0;d.usingBundle=m;var v=n.matchPrefix(f,"a=ice-options:")[0];return d.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,p.forEach((function(o,c){var l=n.splitLines(o),p=n.getKind(o),v=n.isRejected(o)&&0===n.matchPrefix(o,"a=bundle-only").length,y=l[0].substr(2).split(" ")[2],S=n.getDirection(o,f),b=n.parseMsid(o),C=n.getMid(o)||n.generateIdentifier();if(v||"application"===p&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))d.transceivers[c]={mid:C,kind:p,protocol:y,rejected:!0};else{var T,_,E,R,L,w,M,P,k;!v&&d.transceivers[c]&&d.transceivers[c].rejected&&(d.transceivers[c]=d._createTransceiver(p,!0));var I,x,N=n.parseRtpParameters(o);v||(I=n.getIceParameters(o,f),(x=n.getDtlsParameters(o,f)).role="client"),M=n.parseRtpEncodingParameters(o);var U=n.parseRtcpParameters(o),D=n.matchPrefix(o,"a=end-of-candidates",f).length>0,O=n.matchPrefix(o,"a=candidate:").map((function(e){return n.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!v&&m&&c>0&&d.transceivers[c]&&(d._disposeIceAndDtlsTransports(c),d.transceivers[c].iceGatherer=d.transceivers[0].iceGatherer,d.transceivers[c].iceTransport=d.transceivers[0].iceTransport,d.transceivers[c].dtlsTransport=d.transceivers[0].dtlsTransport,d.transceivers[c].rtpSender&&d.transceivers[c].rtpSender.setTransport(d.transceivers[0].dtlsTransport),d.transceivers[c].rtpReceiver&&d.transceivers[c].rtpReceiver.setTransport(d.transceivers[0].dtlsTransport)),"offer"!==i.type||v)"answer"!==i.type||v||(_=(T=d.transceivers[c]).iceGatherer,E=T.iceTransport,R=T.dtlsTransport,L=T.rtpReceiver,w=T.sendEncodingParameters,P=T.localCapabilities,d.transceivers[c].recvEncodingParameters=M,d.transceivers[c].remoteCapabilities=N,d.transceivers[c].rtcpParameters=U,O.length&&"new"===E.state&&(!g&&!D||m&&0!==c?O.forEach((function(e){a(T.iceTransport,e)})):E.setRemoteCandidates(O)),m&&0!==c||("new"===E.state&&E.start(_,I,"controlling"),"new"===R.state&&R.start(x)),!s(T.localCapabilities,T.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&T.sendEncodingParameters[0].rtx&&delete T.sendEncodingParameters[0].rtx,d._transceive(T,"sendrecv"===S||"recvonly"===S,"sendrecv"===S||"sendonly"===S),!L||"sendrecv"!==S&&"sendonly"!==S?delete T.rtpReceiver:(k=L.track,b?(u[b.stream]||(u[b.stream]=new e.MediaStream),r(k,u[b.stream]),h.push([k,L,u[b.stream]])):(u.default||(u.default=new e.MediaStream),r(k,u.default),h.push([k,L,u.default]))));else{(T=d.transceivers[c]||d._createTransceiver(p)).mid=C,T.iceGatherer||(T.iceGatherer=d._createIceGatherer(c,m)),O.length&&"new"===T.iceTransport.state&&(!D||m&&0!==c?O.forEach((function(e){a(T.iceTransport,e)})):T.iceTransport.setRemoteCandidates(O)),P=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(P.codecs=P.codecs.filter((function(e){return"rtx"!==e.name}))),w=T.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var A,z=!1;"sendrecv"===S||"sendonly"===S?(z=!T.rtpReceiver,L=T.rtpReceiver||new e.RTCRtpReceiver(T.dtlsTransport,p),z&&(k=L.track,b&&"-"===b.stream||(b?(u[b.stream]||(u[b.stream]=new e.MediaStream,Object.defineProperty(u[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(k,"id",{get:function(){return b.track}}),A=u[b.stream]):(u.default||(u.default=new e.MediaStream),A=u.default)),A&&(r(k,A),T.associatedRemoteMediaStreams.push(A)),h.push([k,L,A]))):T.rtpReceiver&&T.rtpReceiver.track&&(T.associatedRemoteMediaStreams.forEach((function(t){var r=t.getTracks().find((function(e){return e.id===T.rtpReceiver.track.id}));r&&function(t,r){r.removeTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(r,t)})),T.associatedRemoteMediaStreams=[]),T.localCapabilities=P,T.remoteCapabilities=N,T.rtpReceiver=L,T.rtcpParameters=U,T.sendEncodingParameters=w,T.recvEncodingParameters=M,d._transceive(d.transceivers[c],!1,z)}}})),void 0===d._dtlsRole&&(d._dtlsRole="offer"===i.type?"active":"passive"),d._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?d._updateSignalingState("have-remote-offer"):d._updateSignalingState("stable"),Object.keys(u).forEach((function(t){var r=u[t];if(r.getTracks().length){if(-1===d.remoteStreams.indexOf(r)){d.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout((function(){d._dispatchEvent("addstream",n)}))}h.forEach((function(e){var t=e[0],n=e[1];r.id===e[2].id&&l(d,t,n,[r])}))}})),h.forEach((function(e){e[2]||l(d,e[0],e[1],[])})),e.setTimeout((function(){d&&d.transceivers&&d.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},d.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var s=r.transceivers.filter((function(e){return"audio"===e.kind})).length,o=r.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(s=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--s<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)}));s>0||o>0;)s>0&&(r._createTransceiver("audio"),s--),o>0&&(r._createTransceiver("video"),o--);var l=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(i,s){var o=i.track,a=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(s,r.usingBundle));var l=e.RTCRtpSender.getCapabilities(a);t<15019&&(l.codecs=l.codecs.filter((function(e){return"rtx"!==e.name}))),l.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),l.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var d=i.sendEncodingParameters||[{ssrc:1001*(2*s+1)}];o&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=l,i.sendEncodingParameters=d})),"max-compat"!==r._config.bundlePolicy&&(l+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){l+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,l+="a="+n.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))}));var d=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(d)},d.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var o=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(o+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),o+="a=ice-options:trickle\r\n";var a=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,n){if(!(n+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?o+="m=application 0 DTLS/SCTP 5000\r\n":o+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?o+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(o+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(o+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var l=s(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,o+=i(e,l,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(o+="a=rtcp-rsize\r\n")}}));var l=new e.RTCSessionDescription({type:"answer",sdp:o});return Promise.resolve(l)},d.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,s){if(!r._remoteDescription)return s(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var o=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<r.transceivers.length;l++)if(r.transceivers[l].mid===e.sdpMid){o=l;break}var d=r.transceivers[o];if(!d)return s(c("OperationError","Can not add ICE candidate"));if(d.rejected)return i();var u=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===u.protocol&&(0===u.port||9===u.port))return i();if(u.component&&1!==u.component)return i();if((0===o||o>0&&d.iceTransport!==r.transceivers[0].iceTransport)&&!a(d.iceTransport,u))return s(c("OperationError","Can not add ICE candidate"));var h=e.candidate.trim();0===h.indexOf("a=")&&(h=h.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[o]+="a="+(u.type?h:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);i()}))},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){var n;e[r].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[r]).type]||n.type,t.set(r,e[r])})),t}))}}}));var u=["createOffer","createAnswer"];return u.forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(u=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),d}},{sdp:17}],17:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},n.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:r.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var s=r[i],o=n.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var a=n.parseRtpMap(o),c=n.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=c.length?n.parseFmtp(c[0]):{},a.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(n.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(n.parseExtmap(e))})),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=n.writeExtmap(e)})),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),s=-1!==i.fecMechanisms.indexOf("RED"),o=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,l=n.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));l.length>0&&l[0].length>1&&l[0][0]===c&&(t=l[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),s&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},r.push(n))}})),0===r.length&&c&&r.push({ssrc:c});var d=n.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=d}))),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var s=n.matchPrefix(e,"a=rtcp-mux");return t.mux=s.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||n.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var s=n.writeRtpDescription(e.kind,t);if(s+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}]},{},[1])(1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.delayTime=.1,this.fadeTime=.05,this.startTime=.1,this.previousPitch=-1,this.context=e,this.input=e.createGain(),this.output=e.createGain(),this.mod1=e.createBufferSource(),this.mod2=e.createBufferSource(),this.mod3=e.createBufferSource(),this.mod4=e.createBufferSource(),this.shiftDownBuffer=this.createDelayTimeBuffer(e,this.startTime,this.fadeTime,!1),this.shiftUpBuffer=this.createDelayTimeBuffer(e,this.startTime,this.fadeTime,!0),this.mod1.buffer=this.shiftDownBuffer,this.mod2.buffer=this.shiftDownBuffer,this.mod3.buffer=this.shiftUpBuffer,this.mod4.buffer=this.shiftUpBuffer,this.mod1.loop=!0,this.mod2.loop=!0,this.mod3.loop=!0,this.mod4.loop=!0,this.mod1Gain=e.createGain(),this.mod2Gain=e.createGain(),this.mod3Gain=e.createGain(),this.mod4Gain=e.createGain(),this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0,this.mod1.connect(this.mod1Gain),this.mod2.connect(this.mod2Gain),this.mod3.connect(this.mod3Gain),this.mod4.connect(this.mod4Gain),this.modGain1=e.createGain(),this.modGain2=e.createGain(),this.delay1=e.createDelay(),this.delay2=e.createDelay(),this.mod1Gain.connect(this.modGain1),this.mod2Gain.connect(this.modGain2),this.mod3Gain.connect(this.modGain1),this.mod4Gain.connect(this.modGain2),this.modGain1.connect(this.delay1.delayTime),this.modGain2.connect(this.delay2.delayTime),this.fade1=e.createBufferSource(),this.fade2=e.createBufferSource(),this.fadeBuffer=this.createFadeBuffer(e,this.startTime,this.fadeTime),this.fade1.buffer=this.fadeBuffer,this.fade2.buffer=this.fadeBuffer,this.fade1.loop=!0,this.fade2.loop=!0,this.mix1=e.createGain(),this.mix2=e.createGain(),this.mix1.gain.value=0,this.mix2.gain.value=0,this.fade1.connect(this.mix1.gain),this.fade2.connect(this.mix2.gain),this.input.connect(this.delay1),this.input.connect(this.delay2),this.delay1.connect(this.mix1),this.delay2.connect(this.mix2),this.mix1.connect(this.output),this.mix2.connect(this.output);var t=e.currentTime+.05,r=t+this.startTime-this.fadeTime;this.mod1.start(t),this.mod2.start(r),this.mod3.start(t),this.mod4.start(r),this.fade1.start(t),this.fade2.start(r),this.setDelay(this.delayTime)}return e.prototype.createFadeBuffer=function(e,t,r){for(var n=t*e.sampleRate,i=n+(t-2*r)*e.sampleRate,s=e.createBuffer(1,i,e.sampleRate),o=s.getChannelData(0),a=r*e.sampleRate,c=n-a,l=0;l<n;++l)o[l]=l<a?Math.sqrt(l/a):l>=c?Math.sqrt(1-(l-c)/a):1;for(l=n;l<length;++l)o[l]=0;return s},e.prototype.createDelayTimeBuffer=function(e,t,r,n){for(var i=t*e.sampleRate,s=i+(t-2*r)*e.sampleRate,o=e.createBuffer(1,s,e.sampleRate),a=o.getChannelData(0),c=0;c<i;++c)a[c]=n?(i-c)/s:c/i;for(c=i;c<s;++c)a[c]=0;return o},e.prototype.setDelay=function(e){this.modGain1.gain.setTargetAtTime(.5*e,0,.01),this.modGain2.gain.setTargetAtTime(.5*e,0,.01)},e.prototype.setPitchOffset=function(e){e>0?(this.mod1Gain.gain.value=0,this.mod2Gain.gain.value=0,this.mod3Gain.gain.value=1,this.mod4Gain.gain.value=1):(this.mod1Gain.gain.value=1,this.mod2Gain.gain.value=1,this.mod3Gain.gain.value=0,this.mod4Gain.gain.value=0),this.setDelay(this.delayTime*Math.abs(e)),this.previousPitch=e},e}();t.PitchUtil=n},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(3),o=function(){function e(e,t){this.sendDataMap={},this.sendDataList=new i.LinkedList,this.sendDataCheckOnceCount=100,this.signalSeq=0,this.pushCallback={},this.sessionInfos={},this.tryHeartbeatCount=0,this.heartbeatInterval=1e4,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.tryConnectCount=1,this.tryConnectTimer=null,this.tryConnectInterval=3e3,this.state=i.ENUM_CONNECT_STATE.disconnect,this.tokenType=0,this.browser=this.getBrowserAndVersion(),this.platform=navigator.platform,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.logger=e,this.stateCenter=t}return e.prototype.getBrowserAndVersion=function(){var e,t=navigator.userAgent,r=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d\.]+)/i)||[];return/trident/i.test(r[1])?{name:"IE",version:(e=/\brv[ :]+([\d\.]+)/g.exec(t)||[])[1]||""}:"Chrome"===r[1]&&null!=(e=t.match(/\bOPR|Edge\/([\d\.]+)/))?{name:"Opera",version:e[1]}:(r=r[2]?[r[1],r[2]]:[navigator.appName,navigator.appVersion,"-?"],null!=(e=t.match(/version\/([\d+\.]+)/i))&&r.splice(1,1,e[1]),{name:r[0],version:r[1]})},e.prototype.setSessionInfo=function(e,t){this.logger.debug("zs.ssi.0 call"),this.appid=e+"",this.userid=t},e.prototype.onDisconnect=function(e){},e.prototype.onUpdateHeartBeartInterval=function(e){},e.prototype.resetConnectTimer=function(){this.logger.info("zs.rct.0 call"),clearTimeout(this.tryConnectTimer),this.tryConnectTimer=null,this.tryConnectCount=0},e.prototype.bindWebSocketHandle=function(){var e=this;this.tryHeartbeatCount=0,this.websocket.onmessage=function(t){var r=JSON.parse(t.data);e.logger.info("zs.bsh.0 signmsg= ",r.header.cmd),e.logger.info("zs.bsh.0 signmsg= "+JSON.stringify(r)),r.header.appid==e.appid&&r.header.user_id===e.userid?e.handleServerPush(r):e.logger.warn("zs.bsh.0 check header failed")},this.websocket.onclose=function(t){e.logger.info("zs.bsh.0 close msg = "+JSON.stringify(t)),e.state!=i.ENUM_CONNECT_STATE.disconnect&&(e.resetConnectTimer(),e.startConnectTimer(),e.resetCheckMessage())},this.websocket.onerror=function(t){e.logger.error("zs.bsh.0 msg = "+JSON.stringify(t))}},e.prototype.resetCheckMessage=function(){this.logger.debug("zs.rcm.0 call");for(var e=this.sendDataList.getFirst();null!=e;)this.sendDataList.remove(e),e._data.error&&e._data.error(i.SEND_MSG_RESET,e._data.seq),e=this.sendDataList.getFirst();this.sendDataMap={}},e.prototype.handleServerPush=function(e){switch(e.header.cmd){case"LoginRsp":this.handleRespondData("LoginReq",e);break;case"CreateSessionRsp":this.handleRespondData("CreateSessionReq",e),0===e.body.result&&this.addSession(e.header.session_id,e.body.session_token);break;case"MediaDescRsp":this.handleRespondData("MediaDescReq",e);break;case"CandidateInfoRsp":this.handleRespondData("CandidateInfoReq",e);break;case"CloseSessionRsp":this.handleRespondData("CloseSessionReq",e),this.removeSession(e.header.session_id);break;case"ClientHBRsp":this.handleRespondData("ClientHBReq",e);break;case"MediaDescPush":case"CandidateInfoPush":this.handlePushData(e);break;case"CloseSessionPush":this.handlePushData(e),this.removeSession(e.header.session_id);break;case"QualityReportRsp":this.handleRespondData("QualityReportReq",e);break;case"SessionResetPush":this.handlePushResetSessionData(e);break;case"StreamStatusNotifyPush":case"PublishEventPush":case"PlayEventPush":this.handlePushData(e)}},e.prototype.disconnectCallback=function(){this.connectCallback&&(this.connectCallback(-1,this.server,void 0),this.connectCallback=null);var e=this.server;this.disconnectServer(),this.onDisconnect(e)},e.prototype.updateToken=function(){var e=this;this.logger.info("zs.ut.0 call");var t={token:this.token,tokenType:this.tokenType,roomid:this.stateCenter.roomid,anchorname:this.stateCenter.anchor_info.anchor_id,sdkversion:i.PROTO_VERSION,osinfo:navigator.appVersion};if(0!=Object.keys(this.sessionInfos).length){var r=[];for(var n in this.sessionInfos){var o=parseInt(n);r.push({session_id:o,session_token:this.sessionInfos[o].token})}t.sessions=r}this.sendMessageWithCallback("LoginReq",s.getSeq(),0,t,(function(t,r,n){if(0==n.result){e.token=n.token,e.tokenType=n.tokenType;var i={report:n.report,report_interval:n.report_interval_ms};n.negoInterval&&(e.negoInterval=n.negoInterval),n.negoTryCount&&(e.negoTryCount=n.negoTryCount),n.negoTryMaxCount&&(e.negoTryMaxCount=n.negoTryMaxCount),null!=e.connectCallback&&(e.connectCallback(0,e.server,i),e.connectCallback=null)}else{var s={error:n.strError};null!=e.connectCallback&&(e.connectCallback(n.result,e.server,s),e.connectCallback=null)}}),(function(){null!=e.connectCallback&&(e.connectCallback(-1,e.server,void 0),e.connectCallback=null)}))},e.prototype.sendMessageWithCallback=function(e,t,r,n,s,o){if(this.logger.debug("zs.smwc.0 call "+e),!this.websocket||1!==this.websocket.readyState)return this.logger.error("zs.smwc.0 connect not establish"),void(o&&o(i.SEND_MSG_TIMEOUT,t));var a={header:this.getHeader(e,t,r),body:n};null==s&&(s=null),null==o&&(o=null);var c={seq:t,deleted:!1,cmd:e,time:Date.parse(new Date+""),success:s,error:o},l=this.sendDataList.push(c);this.sendDataMap[c.seq]=l;var d=JSON.stringify(a);this.websocket.send(d),this.logger.debug("zs.smwc.0 success")},e.prototype.getHeader=function(e,t,r){return this.globalHeader={version:"1.0.1",cmd:e,appid:this.appid+"",seq:t,user_id:this.userid,session_id:r},this.globalHeader},e.prototype.connectServer=function(e,t,r){var n=this;if(this.token=e,this.server=t,this.state=i.ENUM_CONNECT_STATE.connecting,this.connectCallback=r,this.websocket&&1===this.websocket.readyState)this.resetConnectTimer(),this.state=i.ENUM_CONNECT_STATE.connected;else{this.logger.info("zs.cs.0 need new websocket");try{this.websocket&&(this.logger.warn("zs.cs.0 close error websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.websocket=new WebSocket(this.server),this.websocket.onopen=function(){n.resetConnectTimer(),n.logger.info("zs.cs.0 websocket open call"),n.bindWebSocketHandle(),n.updateToken(),n.state=i.ENUM_CONNECT_STATE.connected},this.websocket.onclose=function(e){n.logger.info("zs.cs.0 websocket close call  "+JSON.stringify(e))},this.websocket.onerror=function(e){n.logger.info("zs.cs.0 websocket onerror call  "+JSON.stringify(e))}}catch(e){this.logger.error("zs.cs.0 websocket error "+e)}}this.tryConnectTimer=setTimeout((function(){n.startConnectTimer(r)}),this.tryConnectInterval)},e.prototype.startConnectTimer=function(e){if(this.logger.info("zs.sct.0 call"),this.tryConnectCount>=i.MAX_TRY_CONNECT_COUNT)return this.logger.info("zs.sct.0 beyond "+this.server+"max limit"),void this.disconnectCallback();this.websocket&&1===this.websocket.readyState?this.resetConnectTimer():(this.tryConnectCount+=1,this.connectServer(this.token,this.server,e))},e.prototype.disconnectServer=function(){this.logger.debug("zs.ds.0 call"),this.connectCallback=null,this.resetCheckMessage(),this.resetConnectTimer(),this.websocket&&(this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null),this.token="",this.sessionInfos={},this.tokenType=0,this.tryHeartbeatCount=0,this.tryConnectCount=0,this.state=i.ENUM_CONNECT_STATE.disconnect},e.prototype.isServerConnected=function(){return!(!this.websocket||1!==this.websocket.readyState)},e.prototype.createSession=function(e,t,r,n,s,o,a){void 0===s&&(s=""),this.logger.debug("zs.cs.1 call: ",n);var c="";i.PROTO_VERSION.split(".").forEach((function(e,t){return 1==e.length&&1==t?c+="0"+e:c+=e}));var l={type:t,stream_id:n,platform:this.platform,browser:this.browser.name,version:this.browser.version,app_id:this.appid,negotiate_mode:r,strAuthParam:s,sdk_version:1*c};this.sendMessageWithCallback("CreateSessionReq",e,0,l,o,a)},e.prototype.removeSession=function(e){this.logger.info("zs.rs.0 call"),this.sessionInfos[e]&&delete this.sessionInfos[e]},e.prototype.sendCloseSession=function(e,t,r,n,i){this.logger.debug("zs.scs.0 call: ",t);var s={reason:r};this.removeSession(t),this.sendMessageWithCallback("CloseSessionReq",e,t,s,n,i)},e.prototype.sendMessage=function(e,t,r,n){if(this.logger.debug("zs.sm.0 call "+e),this.websocket&&1===this.websocket.readyState){var i={header:this.getHeader(e,t,r),body:n},s=JSON.stringify(i);this.websocket.send(s),this.logger.debug("zs.sm.0 success")}else this.logger.error("zs.sm.0 connect not establish")},e.prototype.handleRespondData=function(e,t){this.logger.debug("zs.hrd.0 call");var r=this.sendDataMap[t.header.seq];if(null!=r){var n=r._data;n.cmd!==e?this.logger.error("sz.hrd.0 command is not match"):n.success&&n.success(t.header.seq,t.header.session_id,t.body),delete this.sendDataMap[t.header.seq],this.sendDataList.remove(r)}else{if("CloseSessionRsp"==t.header.cmd)return;this.logger.error("zs.hrd.0 cannot find data "+e)}},e.prototype.addSession=function(e,t){this.logger.info("zs.as.0 call"),this.sessionInfos[e]={token:t}},e.prototype.handlePushData=function(e){this.logger.debug("zs.hpd.0 call "+e.header.cmd+" session "+e.header.session_id);var t=this.pushCallback[e.header.cmd+e.header.session_id];t?t.callback&&t.callback(e.header.seq,e.header.session_id,e.body):this.logger.info("zs.hpd.0 no callbackData "+e.header.cmd+" session: "+e.header.session_id)},e.prototype.handlePushResetSessionData=function(e){this.logger.debug("zs.hprsd.0 call ");var t=[];if(0==e.body.cResetType)t=Object.keys(this.sessionInfos);else if(1==e.body.cResetType)for(var r=0;r<e.body.session_ids.length;r++)t.push(e.body.session_ids[r]);if(this.sendResetSessionAck(e.header.seq,0,0),0!=t.length)for(var n=0;n<t.length;n++){var i=this.pushCallback[e.header.cmd+t[n]];null==i?this.logger.info("zs.hprsd.0 no callbackData "+t[n]):i.callback&&i.callback(e.header.seq,t[n],e.body)}else this.logger.info("zs.hprsd.0 no session to callback")},e.prototype.sendMediaDesc=function(e,t,r,n,i,s){this.logger.debug("zs.smd.0 call: ",t);var o={type:r,sdp:n.sdp};null!=n.width&&(o.width=n.width),null!=n.height&&(o.height=n.height),null!=n.frameRate&&(o.framerate=n.frameRate),null!=n.video_min_kpbs&&(o.video_min_kpbs=n.video_min_kpbs),null!=n.video_max_kpbs&&(o.video_max_kpbs=n.video_max_kpbs),null!=n.audio_kpbs&&(o.audio_kpbs=n.audio_kpbs),null!=n.keyframe_intv&&(o.keyframe_intv=n.keyframe_intv),this.sendMessageWithCallback("MediaDescReq",e,t,o,i,s)},e.prototype.sendCandidateInfo=function(e,t,r,n,i){this.logger.debug("zs.sci.0 call: ",t);for(var s=[],o=0;o<r.length;o++){var a={candidate:r[o].candidate,sdpMid:r[o].sdpMid,sdpMLineIndex:r[o].sdpMLineIndex};s.push(a)}var c={infos:s};this.sendMessageWithCallback("CandidateInfoReq",e,t,c,n,i)},e.prototype.sendMediaDescAck=function(e,t,r){this.logger.debug("zs.smda.0 call: ",t);var n={result:r};this.sendMessage("MediaDescAck",e,t,n)},e.prototype.sendCandidateInfoAck=function(e,t,r){this.logger.debug("zs.scia.0 call: ",t);var n={result:r};this.sendMessage("CandidateInfoAck",e,t,n)},e.prototype.sendCloseSessionAck=function(e,t,r){this.logger.debug("zs.scsa.0 call: ",t);var n={result:r};this.sendMessage("CloseSessionAck",e,t,n)},e.prototype.sendResetSessionAck=function(e,t,r){this.logger.debug("zs.ssra.0 call: ",t);var n={result:r};this.sendMessage("SessionResetAck",e,t,n)},e.prototype.registerPushCallback=function(e,t,r){r&&"function"==typeof r&&(this.logger.debug("zs.rpc.0 setcallback"),this.pushCallback[e+t]={callback:r})},e.prototype.unregisterPushCallback=function(e,t){delete this.pushCallback[e+t]},e.prototype.checkMessageTimeout=function(){for(var e=this.sendDataList.getFirst(),t=Date.parse(new Date+""),r=0,n=0,s=0;!(null==e||e._data.time+this.sendDataTimeout>t||(delete this.sendDataMap[e._data.seq],this.sendDataList.remove(e),++n,null==e._data.error||this.sendDataDropTimeout>0&&e._data.time+this.sendDataDropTimeout<t?++s:e._data.error&&e._data.error(i.SEND_MSG_TIMEOUT,e._data.seq),++r>=this.sendDataCheckOnceCount));)e=this.sendDataList.getFirst();0==n&&0==s||this.logger.debug("zs.cmt.0 call success, state: timeout=",n," drop=",s)},e.prototype.sendHeartbeat=function(){var e=this;if(this.logger.debug("zs.shb.0 call tryHeartbeatCount:"+this.tryHeartbeatCount),0!=Object.keys(this.sessionInfos).length){if(++this.tryHeartbeatCount>i.MAX_TRY_HEARTBEAT_COUNT)return this.logger.error("zs.shb.0 heartbeat try limit"),void this.disconnectCallback();var t=[];for(var r in this.sessionInfos)t.push(parseInt(r));var n={session_ids:t};this.sendMessageWithCallback("ClientHBReq",s.getSeq(),0,n,(function(t,r,n){e.heartbeatInterval!=n.hb_interval&&(e.heartbeatInterval=n.hb_interval,e.onUpdateHeartBeartInterval(n.hb_interval)),e.tryHeartbeatCount=0}),(function(e,t){}))}else this.logger.info("zs.shb.0 no need to heartbeat")},e.prototype.QualityReport=function(e,t,r,i,s){this.logger.debug("zs.qr.0 call");var o={streams:[n(n({},r),{aid:t})]};this.sendMessageWithCallback("QualityReportReq",e,t,o,i,s)},e.prototype.sendStreamStatus=function(e,t,r,n){this.logger.debug("zs.sss.0 call");var i={mic_status:n,camera_status:r};this.logger.info("zs.sss.0 stream status "+JSON.stringify(i)),this.sendMessage("StreamStatusNotify",e,t,i)},e.prototype.sendBroadcasterStatus=function(e,t,r){this.logger.debug("zs.sss.0 call");var n={status:r};this.sendMessage("BroadcasterStatusNotify",e,t,n)},e}();t.ZegoSignal=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(3),s=r(1),o=r(5),a=function(){function e(e,t,r,s,o){this.state=n.ENUM_PLAY_STATE.stop,this.candidateInfo=[],this.waitICETimer=null,this.waitingICETimeInterval=5e3,this.waitingOfferTimer=null,this.waitingOfferTimeInterval=5e3,this.waitingServerTimer=null,this.waitingServerTimerInterval=3e3,this.qualityTimer=null,this.broadcasterStatus=n.ENUM_BROADCASTER_STATUS.stop,this.playQualityList=[],this.maxQualityListCount=10,this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0},this.reportSeq=i.getSeq(),this.videoSizeCallback=!1,this.qualityUpload=!1,this.qualityUploadInterval=3e4,this.qualityUploadLastTime=0,this.maxRetryCount=3,this.currentRetryCount=0,this.retryState=n.ENUM_RETRY_STATE.didNotStart,this.remoteStream=null,this.playStream=null,this.closeSessionSignal=!1,this.stateNego=n.ENUM_PLAY_STATE_NEGO.stop,this.negoTimer=null,this.negoInterval=25e3,this.negoTryCount=1,this.negoTryMaxCount=2,this.cameraStatus=2,this.micStatus=2,this.playEvent=!1,this.nextSignalTryCount=1,this.waittingConnectedTimer=null,this.waittingConnectedInerval=15e3,this.tryingNexitSignal=!1,this.logger=e,this.signal=t,this.dataReport=r,this.qualityTimeInterval=s,this.streamCenter=o,r.newReport(this.reportSeq)}return e.prototype.startPlay=function(e,t,r){var o=this;this.logger.info("zp.sp.1 called ",e),this.playEvent=!1,this.signal&&this.signal.negoInterval&&(this.negoInterval=this.signal.negoInterval),this.signal&&this.signal.negoTryCount&&(this.negoTryCount=this.signal.negoTryCount),this.signal&&this.signal.negoTryMaxCount&&(this.negoTryMaxCount=this.signal.negoTryMaxCount),e?(this.streamId=e,this.getRomoteStreamSuc=t,this.playOption=r||{},r&&r.videoCodec&&(this.playOption.videoCodec=r.videoCodec),this.sessionSeq=i.getSeq(),this.dataReport.eventStart(this.reportSeq,"CreateSession"),this.signal.createSession(this.sessionSeq,1,0,e,r&&r.streamParams,(function(e,t,r){o.dataReport.eventEndWithMsg(o.reportSeq,"CreateSession",{sessionId:r.session_id}),o.logger.info("zp.sp.1 sessionId:"+r.session_id),o.sessionSeq==e?0!==r.result?(o.logger.error("zp.sp.1 create error"),o.playStateUpdateError(s.playErrorList.CREATE_SESSION_ERROR)):(o.sessionId=r.session_id,o.onCreatePlaySessionSuccess(r)):o.logger.error("zp.sp.1 seq is not match.")}),(function(e,t){o.dataReport.eventEndWithMsg(o.reportSeq,"CreateSession",{error:e}),o.playStateUpdateError(s.playErrorList.SEND_SESSION_TIMEOUT)})),this.state=n.ENUM_PLAY_STATE.waitingSessionRsp,this.logger.debug("zp.sp.1 called success"),this.stateNego=n.ENUM_PLAY_STATE_NEGO.start,this.negoTimer=setTimeout((function(){o.stateNego!==n.ENUM_PLAY_STATE_NEGO.iceConnected&&o.negoTryCount<o.negoTryMaxCount?(o.signal.sendCloseSession(i.getSeq(),o.sessionId,1),o.resetPlay(),o.startPlay(e,t,r),++o.negoTryCount):o.stateNego!==n.ENUM_PLAY_STATE_NEGO.iceConnected&&o.negoTryCount===o.negoTryMaxCount&&(o.logger.error("zp.sp.1 waiting timeout"),o.playStateUpdateError(s.playErrorList.SERVER_NEGO_TIMEOUT))}),this.negoInterval)):this.logger.warn("zp.sp.1 streamId is null")},e.prototype.onCreatePlaySessionSuccess=function(e){var t=this;this.logger.info("zp.ops.1 success");var r=[];e.turn_server&&r.push(e.turn_server),e.stun_server&&r.push(e.stun_server);var n={iceTransportPolicy:"relay",iceServers:[{urls:r,username:e.turn_username,credential:e.turn_auth_key}]};this.logger.info("zp.ops.1 username: "+e.turn_username),this.logger.info("zp.ops.1 credential: "+e.turn_auth_key),this.peerConnection=new RTCPeerConnection(n),this.peerConnection.onicecandidate=function(e){t.onIceCandidate(e)},this.peerConnection.onsignalingstatechange=function(e){t.onConnectionStateChange(e)},this.peerConnection.oniceconnectionstatechange=function(e){t.onIceConnectionStateChange(e)},this.peerConnection.ontrack=function(e){t.onGotRemoteStream(e.streams[0])};var i={offerToReceiveAudio:1,offerToReceiveVideo:1};this.playOption&&!1===this.playOption.video&&(i.offerToReceiveVideo=0),this.playOption&&!1===this.playOption.audio&&(i.offerToReceiveAudio=0),this.logger.info("zp.ops.1 createOffer: "+JSON.stringify(i)),this.dataReport.eventStart(this.reportSeq,"CreateOffer"),this.peerConnection.createOffer(i).then((function(e){t.dataReport.eventEnd(t.reportSeq,"CreateOffer"),t.onCreateOfferSuccess(e)}),(function(e){t.dataReport.eventEndWithMsg(t.reportSeq,"CreateOffer",{error:e.toString()}),t.logger.error("zp.ops.0 create offer error "+e.toString()),t.playStateUpdateError(s.playErrorList.CREATE_OFFER_ERROR)})),this.signal.registerPushCallback("MediaDescPush",this.sessionId,(function(e,r,n){t.onRecvMediaDesc(e,r,n)})),this.signal.registerPushCallback("CandidateInfoPush",this.sessionId,(function(e,r,n){t.onRecvCandidateInfo(e,r,n)})),this.signal.registerPushCallback("CloseSessionPush",this.sessionId,(function(e,r,n){t.onRecvCloseSession(e,r,n)})),this.signal.registerPushCallback("SessionResetPush",this.sessionId,(function(e,r,n){t.onRecvResetSession(e,r,n)})),this.signal.registerPushCallback("StreamStatusNotifyPush",this.sessionId,(function(e,r,n){t.onRecvStreamStatus(e,r,n)})),this.signal.registerPushCallback("PlayEventPush",this.sessionId,(function(e,r,n){t.onRecvPlayEvent(e,r,n)})),this.logger.debug("zp.ops.1 call success")},e.prototype.onCreateOfferSuccess=function(e){var t=this;this.logger.info("zp.oco.1 localSdp1 "+e.sdp.substr(0,e.sdp.length/2)),this.logger.info("zp.oco.1 localSdp2 "+e.sdp.substr(e.sdp.length/2)),e.sdp=e.sdp.replace(/sendrecv/g,"recvonly"),this.playOption.videoCodec&&(e.sdp=o.SdpUtil.getSDPByVideDecodeType(e.sdp,this.playOption.videoCodec)),this.dataReport.eventStart(this.reportSeq,"SetLocalDescription"),this.peerConnection.setLocalDescription(e).then((function(){t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription"),t.onSetLocalDescriptionSuccess(e)}),(function(e){t.logger.error("zp.oca.1 set error "+e.toString()),t.dataReport.eventEnd(t.reportSeq,"SetLocalDescription",{error:e.toString()}),t.playStateUpdateError(s.playErrorList.SET_LOCAL_DESC_ERROR)}))},e.prototype.onSetLocalDescriptionSuccess=function(e){var t=this;this.logger.info("zp.osd.1 success");var r={sdp:e.sdp};this.answerSeq=i.getSeq(),this.dataReport.eventStart(this.reportSeq,"SendMediaDesc"),this.signal.sendMediaDesc(this.answerSeq,this.sessionId,0,r,(function(e,r,i){t.logger.info("zp.osd.1 sendMediaDesc resp"),t.answerSeq==e&&t.sessionId==r?(t.logger.info("zp.osd.1 send success stateNego:waiterAnswer"),t.stateNego=n.ENUM_PLAY_STATE_NEGO.waiterAnswer,t.dataReport.eventEnd(t.reportSeq,"SendMediaDesc"),t.waitingOfferTimer=setTimeout((function(){t.state==n.ENUM_PLAY_STATE.waitingOffserRsp&&(t.logger.error("zp.osd.1 waiting timeout"),t.playStateUpdateError(s.playErrorList.SERVER_CANDIDATE_TIMEOUT))}),t.waitingOfferTimeInterval),t.state=n.ENUM_PLAY_STATE.waitingServerAnswer):t.logger.error("zp.osd.1 seq or sessionId is not equal "+t.answerSeq+" "+e,0+t.sessionId+" "+r)}),(function(e,r){t.logger.error("zp.osd.1 failed to send "+e),t.dataReport.eventEndWithMsg(t.reportSeq,"SendMediaDesc",{error:e}),t.playStateUpdateError(s.playErrorList.SEND_MEDIA_DESC_TIMEOUT)})),this.state=n.ENUM_PLAY_STATE.waitingOffserRsp},e.prototype.onRecvMediaDesc=function(e,t,r){var i=this;if(this.logger.info("zp.orm.1 received ",r),this.stateNego=n.ENUM_PLAY_STATE_NEGO.waitingCandidate,this.logger.info("zp.orm.1 received stateNego:waitingCandidate"),this.state===n.ENUM_PLAY_STATE.waitingServerAnswer){null!=this.waitingOfferTimer&&(clearTimeout(this.waitingOfferTimer),this.waitingOfferTimer=null),this.dataReport.addEvent(this.reportSeq,"RecvMediaDesc"),this.signal.sendMediaDescAck(e,this.sessionId,0);var o={type:"answer",sdp:r.sdp,toJSON:function(){}};this.dataReport.eventStart(this.reportSeq,"SetRemoteDescription"),this.logger.info("zp.orm.1 remoteSdp ",o.sdp),this.peerConnection.setRemoteDescription(new RTCSessionDescription(o)).then((function(){i.dataReport.eventEnd(i.reportSeq,"SetRemoteDescription"),i.logger.info("zp.orm.1 set success")}),(function(e){i.logger.error("zp.orm.1 set remote error "+e.toString()),i.dataReport.eventEndWithMsg(i.reportSeq,"SetRemoteDescription",{error:e.toString()}),i.playStateUpdateError(s.playErrorList.SET_REMOTE_DESC_ERROR)})),this.waitICETimer=setTimeout((function(){i.state==n.ENUM_PLAY_STATE.waitingServerICE&&(i.logger.error("zp.orm.1 waiting server timeout"),i.playStateUpdateError(s.playErrorList.SERVER_CANDIDATE_TIMEOUT))}),this.waitingICETimeInterval),this.state=n.ENUM_PLAY_STATE.waitingServerICE,this.logger.debug("zp.orm.1 call success")}else this.logger.error("zp.orm.1 current state "+this.state+" not allowed")},e.prototype.onRecvCandidateInfo=function(e,t,r){var i=this;if(this.logger.info("zp.orci.1 received "),this.state==n.ENUM_PLAY_STATE.waitingServerICE){null!=this.waitICETimer&&(clearTimeout(this.waitICETimer),this.waitICETimer=null),this.dataReport.addEvent(this.reportSeq,"RecvIceCandidate"),this.signal.sendCandidateInfoAck(e,this.sessionId,0),this.sendCandidateInfo(this.candidateInfo),this.candidateInfo=[];for(var o=0;o<r.infos.length;o++){var a={sdpMid:r.infos[o].sdpMid,sdpMLineIndex:r.infos[o].sdpMLineIndex,candidate:r.infos[o].candidate};this.logger.debug("zp.orci.1 candidate "+a.candidate),this.peerConnection.addIceCandidate(new RTCIceCandidate(a)).then((function(){i.logger.debug("zp.orci.1 add success")}),(function(e){i.logger.error("zp.orci.1 add error "+e.toString()),i.playStateUpdateError(s.playErrorList.SERVER_CANDIDATE_ERROR)}))}this.state=n.ENUM_PLAY_STATE.connecting,this.logger.debug("zp.orci.1 call success")}else this.logger.warn("zp.orci.1 current state "+this.state+" not allowed")},e.prototype.onRecvPlayEvent=function(e,t,r){if(this.logger.info("zp.orpe.1 received"),!0===this.playEvent&&0==r.event){this.logger.info("zp.orpe.1 retry: "+this.streamId);var n=this.streamId,s=this.playOption;this.signal.sendCloseSession(i.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(n,this.getRomoteStreamSuc,s)}else this.playEvent=!0},e.prototype.onIceCandidate=function(e){if(this.logger.info("zp.oic.1 called"),null!=e.candidate)if(this.logger.debug("zp.oic.1 candidate "+e.candidate.candidate),this.state<n.ENUM_PLAY_STATE.connecting||this.state==n.ENUM_PLAY_STATE.stop)this.logger.debug("zp.oic.1 cached"),this.candidateInfo.push({candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex});else{this.logger.debug("zp.oic.1 send");var t={candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex};this.sendCandidateInfo([t])}},e.prototype.onConnectionStateChange=function(e){this.logger.info("zp.oisc.1 called "+e.target.signalingState)},e.prototype.onIceConnectionStateChange=function(e){var t=this;if(this.state!=n.ENUM_PLAY_STATE.stop&&null!=this.peerConnection)if(this.logger.info("zp.oisc.1  stateChanged "+this.peerConnection.iceConnectionState),"connected"===this.peerConnection.iceConnectionState){for(var r in this.dataReport.addEvent(this.reportSeq,"IceConnected"),this.state!=n.ENUM_PLAY_STATE.playing&&this.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.start,this.streamId,{code:0,msg:""}),this.state=n.ENUM_PLAY_STATE.playing,this.tryingNexitSignal=!1,this.retryState!=n.ENUM_RETRY_STATE.didNotStart&&(this.retryState=n.ENUM_RETRY_STATE.finished,this.currentRetryCount=0),this.dataReport.eventStart(this.reportSeq,"PlayState"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[r].publisher.state==n.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==n.ENUM_BROADCASTER_STATUS.stop){this.signal&&this.signal.sendBroadcasterStatus(i.getSeq(),this.sessionId,1),this.broadcasterStatus=n.ENUM_BROADCASTER_STATUS.start;break}this.setPlayQualityTimer(),this.stateNego=n.ENUM_PLAY_STATE_NEGO.iceConnected,this.logger.info("zp.oisc.1  stateNego:iceConnected"),this.negoTryCount=1,this.nextSignalTryCount=1,this.waittingConnectedTimer&&clearTimeout(this.waittingConnectedTimer),this.waittingConnectedTimer=null,this.negoTimer&&clearTimeout(this.negoTimer)}else"closed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceClosed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"failed"===this.peerConnection.iceConnectionState?(this.dataReport.addEvent(this.reportSeq,"IceFailed"),this.checkPlayConnectionFailedState(this.peerConnection.iceConnectionState)):"disconnected"===this.peerConnection.iceConnectionState&&(this.dataReport.addEvent(this.reportSeq,"IceDisconnected"),this.waittingConnectedTimer=setTimeout((function(){!t.tryingNexitSignal&&t.tryNextSignal(s.playErrorList.MEDIA_CONNECTION_DISCONNECTED)}),this.waittingConnectedInerval))},e.prototype.checkPlayConnectionFailedState=function(e){var t=null;"failed"==e?t=s.playErrorList.MEDIA_CONNECTION_FAILED:"closed"==e&&(t=s.playErrorList.MEDIA_CONNECTION_CLOSED),null!=t&&(this.state!=n.ENUM_PLAY_STATE.playing&&this.retryState==n.ENUM_PLAY_STATE.didNotStart?(this.logger.info("zp.oics.1  state "+this.state+" retryState "+this.retryState+" connectionState "+e),this.playStateUpdateError(t)):this.shouldRetryPlay()?(this.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.retry,this.streamId,s.playErrorList.MEDIA_CONNECTION_FAILED),this.startRetryPlay()):this.playStateUpdateError(t))},e.prototype.shouldRetryPlay=function(){return this.retryState==n.ENUM_RETRY_STATE.didNotStart&&this.state!=n.ENUM_PLAY_STATE.playing?(this.logger.info("zp.srp.1.0 connection didn't success"),!1):this.retryState==n.ENUM_RETRY_STATE.retrying?(this.logger.info("zp.srp.0.0 already retrying"),!1):this.currentRetryCount>this.maxRetryCount?(this.logger.info("zp.srp.1.0 beyond max"),!1):(this.logger.debug("zp.srp.1.0 call success"),!0)},e.prototype.startRetryPlay=function(){this.logger.debug("zp.srp.0 call");var e=this.streamId;this.resetPlay(),this.tryStartPlay(e)},e.prototype.clearTryPlayTimer=function(){null!=this.waitingServerTimer&&(clearTimeout(this.waitingServerTimer),this.waitingServerTimer=null)},e.prototype.tryStartPlay=function(e){var t=this;if(this.logger.debug("zp.tsp.1 call"),this.clearTryPlayTimer(),this.streamId=e,this.currentRetryCount>this.maxRetryCount)return this.logger.error("zp.tsp.1 beyond max limit"),void this.playStateUpdateError(s.playErrorList.WEBSOCKET_ERROR);this.retryState=n.ENUM_RETRY_STATE.retrying,this.currentRetryCount+=1,this.signal.isServerConnected()?(this.logger.debug("zp.tsp.1 signal connected"),this.startPlay(e,this.getRomoteStreamSuc,this.playOption)):(this.logger.debug("zp.tsp.1 signal server not connected"),this.waitingServerTimer=setTimeout((function(){t.tryStartPlay(e)}),this.waitingServerTimerInterval))},e.prototype.clearPlayQualityTimer=function(){null!=this.qualityTimer&&(clearInterval(this.qualityTimer),this.qualityTimer=null),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,framesDecoded:0,framesDropped:0,framesReceived:0,audioBitrate:0}},e.prototype.resetPlay=function(){this.logger.info("zp.rp.1 call"),this.streamId=null,this.state=n.ENUM_PLAY_STATE.stop,this.playEvent=!1,null!=this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),null!=this.waitingOfferTimer&&(clearTimeout(this.waitingOfferTimer),this.waitingOfferTimer=null),null!=this.waitICETimer&&(clearTimeout(this.waitICETimer),this.waitICETimer=null),null!=this.negoTimer&&(clearTimeout(this.negoTimer),this.negoTimer=null),null!=this.waittingConnectedTimer&&(clearTimeout(this.waittingConnectedTimer),this.waittingConnectedTimer=null),this.clearPlayQualityTimer(),this.signal&&(this.signal.unregisterPushCallback("MediaDescPush",this.sessionId),this.signal.unregisterPushCallback("CandidateInfoPush",this.sessionId),this.signal.unregisterPushCallback("CloseSessionPush",this.sessionId)),this.sessionSeq=0,this.answerSeq=0,this.videoSizeCallback=!1,this.currentRetryCount=0,this.retryState=n.ENUM_RETRY_STATE.didNotStart,this.clearTryPlayTimer()},e.prototype.setPlayQualityTimer=function(){var e=this;null==this.qualityTimer&&(this.logger.debug("zp.spq.1 startTimer"),this.clearPlayQualityTimer(),this.qualityTimer=setInterval((function(){e.peerConnection&&e.peerConnection.getStats(null).then((function(t){e.getPlayStats(t)}),(function(t){e.logger.info("zp.spq.1 getStats error "+t.toString())}))}),this.qualityTimeInterval),this.lastPlayStats={audioPacketsLost:0,videoPacketsLost:0,time:0,audioTime:0,videoTime:0,audioBytesReceived:0,videoBytesReceived:0,framesDecoded:0,framesReceived:0,framesDropped:0,audioBitrate:0})},e.prototype.getPlayStats=function(e){var t=this;if(null!=e){var r={audioFractionLost:0,audioPacketsLost:0,audioPacketsLostRate:0,audioBitrate:0,audioLevel:0,audioSendLevel:0,audioSamplingRate:0,audioCodec:"opus",audioQuality:0,videoQuality:0,videoPacketsLostRate:0,videoBitrate:0,videoFPS:0,playData:0,nackCount:0,pliCount:0,audioJitter:0,videoFractionLost:0,videoFramesDecoded:0,frameHeight:0,frameWidth:0,videoTransferFPS:0,videoFramesDropped:0,totalRoundTripTime:0,currentRoundTripTime:0},n=this.lastPlayStats.time,i=0;e.forEach((function(e){("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("audio"==e.mediaType||e.id.indexOf("AudioStream")>=0)?(0!=n&&(r.audioBitrate=8*(e.bytesReceived-t.lastPlayStats.audioBytesReceived)/(e.timestamp-n)),r.audioBitrate<0&&(r.audioBitrate=0),r.audioJitter=e.jitter,r.audioPacketsLost=e.packetsLost,r.audioFractionLost=e.fractionLost,r.audioPacketsLostRate=(e.packetsLost-t.lastPlayStats.audioPacketsLost)/(e.timestamp-t.lastPlayStats.audioTime),t.lastPlayStats.audioBytesReceived=e.bytesReceived,t.lastPlayStats.audioPacketsLost=e.packetsLost,t.lastPlayStats.audioTime=e.timestamp,t.lastPlayStats.time=e.timestamp,t.lastPlayStats.audioBitrate=r.audioBitrate):("inbound-rtp"==e.type||"ssrc"==e.type&&null!=e.bytesReceived)&&("video"==e.mediaType||e.id.indexOf("VideoStream")>=0)?(0!=n&&(r.videoBitrate=8*(e.bytesReceived-t.lastPlayStats.videoBytesReceived)/(e.timestamp-n),r.videoFPS=1e3*(e.framesDecoded-t.lastPlayStats.framesDecoded)/(e.timestamp-n)),r.videoBitrate<0&&(r.videoBitrate=0),r.videoFPS<0&&(r.videoFPS=0),r.nackCount=e.nackCount,r.pliCount=e.pliCount,r.videoFractionLost=e.fractionLost,r.videoFramesDecoded=e.framesDecoded,r.videoPacketsLostRate=(e.packetsLost-t.lastPlayStats.videoPacketsLost)/(e.timestamp-t.lastPlayStats.videoTime),t.lastPlayStats.videoBytesReceived=e.bytesReceived,t.lastPlayStats.framesDecoded=e.framesDecoded,t.lastPlayStats.videoPacketsLost=e.packetsLost,t.lastPlayStats.videoTime=e.timestamp,t.lastPlayStats.time=e.timestamp):"track"==e.type&&("video"==e.kind||e.id.indexOf("video")>=0)?(r.frameHeight=e.frameHeight,r.frameWidth=e.frameWidth,0!=n&&(r.videoTransferFPS=1e3*(e.framesReceived-t.lastPlayStats.framesReceived)/(e.timestamp-n),r.videoFramesDropped=e.framesDropped-t.lastPlayStats.framesDropped),r.videoTransferFPS<0&&(r.videoTransferFPS=0),r.videoFramesDropped<0&&(r.videoFramesDropped=0),t.lastPlayStats.framesReceived=e.framesReceived,t.lastPlayStats.framesDropped=e.framesDropped):"track"==e.type&&("audio"==e.kind||e.id.indexOf("audio")>=0)?(r.audioLevel=e.audioLevel,r.audioSendLevel=e.totalAudioEnergy,r.audioSamplingRate=e.totalSamplesDuration):"candidate-pair"==e.type&&(null!=e.totalRoundTripTime&&(r.totalRoundTripTime=e.totalRoundTripTime),null!=e.currentRoundTripTime&&(r.currentRoundTripTime=e.currentRoundTripTime,i=1e3*r.currentRoundTripTime))})),r.audioQuality=this.getNetQuality(i,r.audioFractionLost),r.videoQuality=this.getNetQuality(i,r.videoFractionLost),this.uploadPlayQuality(r);var s={video:{videoBitrate:r.videoBitrate,videoFPS:r.videoFPS,videoTransferFPS:r.videoTransferFPS,videoFramesDecoded:r.videoFramesDecoded,videoFramesDropped:r.videoFramesDropped,videoPacketsLostRate:r.videoPacketsLostRate,videoQuality:r.videoQuality,frameHeight:r.frameHeight,frameWidth:r.frameWidth},audio:{audioBitrate:r.audioBitrate,audioCodec:r.audioCodec,audioJitter:r.audioJitter,audioLevel:r.audioLevel,audioPacketsLost:r.audioPacketsLost,audioPacketsLostRate:r.audioPacketsLostRate,audioQuality:r.audioQuality,audioSamplingRate:r.audioSamplingRate,audioSendLevel:r.audioSendLevel},nackCount:r.nackCount,pliCount:r.pliCount,totalRoundTripTime:r.totalRoundTripTime,playData:r.playData,currentRoundTripTime:r.currentRoundTripTime};0!=n&&this.onPlayQualityUpdate(this.streamId,s)}},e.prototype.getNetQuality=function(e,t){return e&&e<600?t>.4?2:t>.3?4:5:e<900?t>.4?2:t>.2?3:4:t>.2?2:3},e.prototype.uploadPlayQuality=function(e){var t=this;if(this.qualityUpload){var r=Date.parse(new Date+"");(0==this.qualityUploadLastTime||r-this.qualityUploadLastTime>=this.qualityUploadInterval)&&(e.stream_type="play",e.stream_id=this.streamId,e.timeStamp=r/1e3,this.logger.info("zp.upq.1 upload"+JSON.stringify(e)),this.signal.QualityReport(i.getSeq(),this.sessionId,e,(function(e,r,n){void 0!==n.report&&(t.qualityUpload=n.report,t.qualityUploadInterval=n.report_interval_ms)}),(function(e,r){t.logger.info("zp.upq.1 upload failed "+e)})),this.qualityUploadLastTime=r)}},e.prototype.onRecvResetSession=function(e,t,r){if(this.logger.info("zp.orrs.1 received "),t==this.sessionId){this.dataReport.addEvent(this.reportSeq,"RecvResetSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=JSON.parse(JSON.stringify(s.playErrorList.SESSION_CLOSED));this.negoTimer&&clearTimeout(this.negoTimer),this.playStateUpdateError(n)}else this.logger.info("zp.orrs.1 cannot find session")},e.prototype.onRecvCloseSession=function(e,t,r){this.logger.info("zp.orcs.1 reason: "+r.reason),this.dataReport.addEvent(this.reportSeq,"RecvCloseSession"),this.signal.sendCloseSessionAck(e,this.sessionId,0);var n=JSON.parse(JSON.stringify(s.playErrorList.SESSION_CLOSED));n.msg+=r.reason,this.negoTimer&&clearTimeout(this.negoTimer);var o=1*r.reason,a=r.err_info&&JSON.parse(r.err_info).action?JSON.parse(r.err_info).action:null;if("number"==typeof o&&[24,28].includes(o)&&this.negoTryCount<this.negoTryMaxCount||5==a){this.logger.info("zp.orcs.1 retry: "+this.streamId);var c=this.streamId,l=this.playOption;this.signal.sendCloseSession(i.getSeq(),this.sessionId,1),this.resetPlay(),this.startPlay(c,this.getRomoteStreamSuc,l),++this.negoTryCount}else[4,8,10,11,12,26,27].includes(o)||2==a?!this.tryingNexitSignal&&this.tryNextSignal(n):this.playStateUpdateError(n)},e.prototype.onRecvStreamStatus=function(e,t,r){if(this.logger.debug("zp.orss.0 call"),t==this.sessionId){var n=this.playStream;0!==r.camera_status&&n.getVideoTracks().forEach((function(e){e.stop(),n.removeTrack(e)})),0==r.camera_status&&0==n.getVideoTracks().length&&n.addTrack(this.remoteStream.clone().getVideoTracks()[0]),this.cameraStatus!==r.camera_status&&this.onRemoteCameraStatusUpdate(this.streamId,this.getCameraMicStatus(r.camera_status)),this.micStatus!==r.mic_status&&this.onRemoteMicStatusUpdate(this.streamId,this.getCameraMicStatus(r.mic_status)),this.cameraStatus=r.camera_status,this.micStatus=r.mic_status,this.logger.debug("zp.orss.0 call success")}else this.logger.error("zp.orss.0 cannot find session")},e.prototype.onGotRemoteStream=function(e){var t=this;this.logger.info("zp.ogrs.0 called "+e),e?(this.playStream?(this.playStream.getTracks().forEach((function(e){return t.playStream.removeTrack(e)})),e.clone().getTracks().forEach((function(e){return t.playStream.addTrack(e)}))):this.playStream=e.clone(),this.remoteStream=e,this.getRomoteStreamSuc(this.playStream),this.dataReport.addEvent(this.reportSeq,"GetRemoteStream")):this.logger.warn("zp.ogrs.0 remote stream is empty")},e.prototype.sendCandidateInfo=function(e){var t=this;this.logger.info("zp.sci.1 called"),!(e=e.filter((function(e){return!(e.candidate.indexOf("tcp")>0)&&(!!e.candidate||void 0)})))||e.length<1?this.logger.info("zp.sci.1 cancelled"):(this.dataReport.eventStart(this.reportSeq,"SendIceCandidate"),this.stateNego!==n.ENUM_PLAY_STATE_NEGO.iceConnected&&(this.stateNego=n.ENUM_PLAY_STATE_NEGO.sendCandidate),this.logger.info("zp.sci.1  stateNego:sendCandidate"),this.signal.sendCandidateInfo(i.getSeq(),this.sessionId,e,(function(e,r,n){t.logger.debug("zp.sci.1 send success"),t.dataReport.eventEnd(t.reportSeq,"SendIceCandidate")}),(function(e,r){t.logger.error("zp.sci.1 failed to send: "+e.toString()),t.dataReport.eventEndWithMsg(t.reportSeq,"SendIceCandidate",{error:e}),t.playStateUpdateError(s.playErrorList.SEND_CANDIDATE_ERROR)})))},e.prototype.shouldSendCloseSession=function(e){return this.state!=i.ENUM_PLAY_STATE_UPDATE.stop&&this.state!=n.ENUM_PLAY_STATE.waitingSessionRsp},e.prototype.playStateUpdateError=function(e){this.logger.info("zp.psue.1 called ",e.code),this.state===n.ENUM_PLAY_STATE.stop||this.negoTryCount<this.negoTryMaxCount&&this.stateNego<n.ENUM_PLAY_STATE_NEGO.iceConnected?this.logger.info("zp.psue.1 reset"):(0!=this.sessionId&&this.shouldSendCloseSession(e)&&(this.signal.sendCloseSession(i.getSeq(),this.sessionId,1),this.closeSessionSignal=!0),this.state=n.ENUM_PLAY_STATE.stop,this.onPlayStateUpdate(i.ENUM_PLAY_STATE_UPDATE.error,this.streamId,e),this.resetPlay())},e.prototype.getCameraMicStatus=function(e){return 0==e?"OPEN":"MUTE"},e.prototype.onPlayStateUpdate=function(e,t,r){},e.prototype.onPlayQualityUpdate=function(e,t){},e.prototype.onRemoteCameraStatusUpdate=function(e,t){},e.prototype.onRemoteMicStatusUpdate=function(e,t){},e.prototype.stopPlay=function(){for(var e in this.logger.info("zp.sp.1.1 called"),this.streamCenter.publisherList)if(this.streamCenter.publisherList[e].publisher.state==n.ENUM_PUBLISH_STATE.publishing&&this.broadcasterStatus==n.ENUM_BROADCASTER_STATUS.start){this.signal&&this.signal.sendBroadcasterStatus(i.getSeq(),this.sessionId,0),this.broadcasterStatus=n.ENUM_BROADCASTER_STATUS.stop;break}this.sessionId&&!this.closeSessionSignal&&this.signal.sendCloseSession(i.getSeq(),this.sessionId,0),this.dataReport.eventEndWithMsg(this.reportSeq,"PlayState",{state:this.state+""}),this.dataReport.addEvent(this.reportSeq,"StopPlay"),this.dataReport.addMsgExt(this.reportSeq,{stream:this.streamId,sessionId:this.sessionId}),this.dataReport.uploadReport(this.reportSeq,"RTCPlayStream"),this.resetPlay()},e.prototype.onDisconnect=function(){this.logger.info("zp.od.1 call"),this.logger.info("zp.od.1 websocket disconnect"),this.dataReport.addEvent(this.reportSeq,"OnDisconnect"),!this.tryingNexitSignal&&this.tryNextSignal(s.playErrorList.WEBSOCKET_ERROR)},e.prototype.tryNextSignal=function(e){this.tryingNexitSignal=!0;var t=this.streamId,r=this.signal.server,s=this.streamCenter.playerList[t],o=[];s&&s.serverUrls&&(o=s.serverUrls),this.nextSignalTryCount>3*o.length?(this.logger.error("zp.tns.1 try max limit"),this.playStateUpdateError(e)):(o.forEach((function(e,t){return t<=o.indexOf(r)&&o.push(e)})),o.splice(0,o.indexOf(r)+1),this.logger.info("zp.tns.1 try next signal "+t),this.signal&&this.signal.state==n.ENUM_CONNECT_STATE.connected&&this.signal.sendCloseSession(i.getSeq(),this.sessionId,1),this.signal&&this.signal.removeSession(this.sessionId),this.resetPlay(),this.streamCenter.connectPlayServer(t,this.getRomoteStreamSuc,!0),this.nextSignalTryCount++)},e}();t.ZegoPlayWeb=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.playerList={},this.publisherList={},this.playSuccessCallBack=null}return e.prototype.onRemoteCameraStatusUpdate=function(e,t){},e.prototype.onRemoteMicStatusUpdate=function(e,t){},e.prototype.setSessionInfo=function(e,t,r,n){},e}();t.ZegoStreamCenter=n},function(e,t,r){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0});var s=r(19),o=r(0),a=r(20),c=r(21),l=r(22),d=r(23),u=r(24),h=r(25),p=r(1),f=r(2),g=function(e){function t(){return e.call(this)||this}return i(t,e),t.prototype.init=function(){this.bindSocketHandler(),this.bindStreamHandler(),this.bindHeatBeatHandler(),this.bindRoomHandler(),this.bindMessageHandler(),this.bindLiveHandler(),this.bindStreamCenterHandler()},t.prototype.bindSocketHandler=function(){var e=this;this.socketCenter=new a.SocketCenter(this.logger,this.stateCenter),this.socketCenter.registerRouter("push_signal",(function(t){e.liveHandler.handlePushSignalMsg(t)})),this.socketCenter.getSocket=function(t){return e.getSocket(t)},this.socketCenter.handlePushKickout=function(t){e.logger.info("zb.cm.bsh.0  call hpk"),e.roomHandler.setRunState(o.ENUM_RUN_STATE.logout),e.roomHandler.resetRoom(),e.logger.error("zb.cm.bsh.0 kick out reason "+t.body.reason),e.stateCenter.actionListener("roomStateUpdate",e.stateCenter.roomid,"DISCONNECTED",p.liveRoomErrorList.KICK_OUT,""),e.logger.debug("zb.cm.bsh.0  call hpk success")},this.socketCenter.handlePushCustomMsg=function(t){e.messageHandler.handlePushCustomMsg(t)},this.socketCenter.handlePushUserStateUpdateMsg=function(t){e.roomHandler.handlePushUserStateUpdateMsg(t)},this.socketCenter.handlePushRoomMsg=function(t){var r=[];t.body.chat_data.forEach((function(e){var t={fromUser:{userID:e.id_name,userName:e.nick_name},message:e.msg_content,sendTime:e.send_time,messageID:e.msg_id};r.push(t)})),e.stateCenter.actionListener("IMRecvBroadcastMessage",e.stateCenter.roomid,r)},this.socketCenter.handlePushMergeMsg=function(t){e.messageHandler.handlePushMergeMsg(t)},this.socketCenter.handlePushTransMsg=function(t){e.messageHandler.handlePushTransMsg(t)},this.socketCenter.handleBigImMsgRsp=function(t){e.messageHandler.handleBigImMsgRsp(t)}},t.prototype.bindStreamHandler=function(){var e=this;this.streamHandler=new l.StreamHandler(this.logger,this.stateCenter,this.socketCenter),this.streamHandler.onStreamUpdated=function(t,r,n){var i=n.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}}));e.stateCenter.actionListener("roomStreamUpdate",t,f.ClientUtil.getSteamUpdateType(r),i)},this.streamHandler.onPublishStateUpdate=function(t,r,n){e.stateCenter.actionListener("publisherStateUpdate",{state:f.ClientUtil.getPublisherStateType(t),streamID:r,errorCode:n.code,extendedData:n.msg})},this.streamHandler.onStreamExtraInfoUpdated=function(t,r){var n=r.map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo}}));e.stateCenter.actionListener("streamExtraInfoUpdate",t,n)},this.streamHandler.setCDNInfo=function(t,r){e.setCDNInfo(t,r)}},t.prototype.bindHeatBeatHandler=function(){var e=this;this.heartBeatHandler=new d.HeartBeatHandler(this.logger,this.stateCenter,this.socketCenter),this.heartBeatHandler.onRecvReliableMessage=function(t,r,n){e.stateCenter.actionListener("recvReliableMessage",t,r,n)},this.heartBeatHandler.handleFetchStreamListRsp=function(t){e.streamHandler.handleFetchStreamListRsp(t)},this.heartBeatHandler.fetchUserList=function(){e.roomHandler.fetchUserList()},this.heartBeatHandler.onUpdateOnlineCount=function(t,r){e.stateCenter.actionListener("updateOnlineCount",t,r)},this.heartBeatHandler.updateStreamInfo=function(t,r,n,i){void 0===n&&(n=""),e.streamHandler.updateStreamInfo(t,r,n,i)},this.heartBeatHandler.hbLogout=function(t){e.logger.error("hhbr.0 "+t.msg),e.stateCenter.actionListener("roomStateUpdate",e.stateCenter.roomid,"DISCONNECTED",t.code,"")}},t.prototype.bindRoomHandler=function(){var e=this;this.roomHandler=new c.RoomHandler(this.logger,this.stateCenter,this.socketCenter),this.roomHandler.loginSuccessCallBack=function(t,r){var n=r.body.hearbeat_interval<o.MINIUM_HEARTBEAT_INTERVAL?o.MINIUM_HEARTBEAT_INTERVAL:r.body.hearbeat_interval;e.stateCenter.tryHeartbeatCount=0,e.stateCenter.heartbeatTimer&&clearTimeout(e.stateCenter.heartbeatTimer),e.heartBeatHandler.start(n),e.heartBeatHandler.resetCheckMessage(),e.heartBeatHandler.startCheckMessageTimeout(),e.streamCenter.setSessionInfo(e.stateCenter.appid,e.stateCenter.idName,e.stateCenter.token,e.stateCenter.testEnvironment),r.body.anchor_info&&e.stateCenter.actionListener("getAnchorInfo",r.body.anchor_info.anchor_id_name,r.body.anchor_info.anchor_nick_name),r.body.online_count&&e.stateCenter.actionListener("updateOnlineCount",e.stateCenter.roomid,r.body.online_count),e.logger.info("zb.cm.brh hls userStateUpdate "+e.stateCenter.userStateUpdate),e.stateCenter.userStateUpdate&&(e.logger.info("zb.cm.brh hls fetch all new userlist"),e.roomHandler.fetchUserList(t)),e.streamHandler.handleStreamStart(t,r)},this.roomHandler.resetRoomCallBack=function(){e.heartBeatHandler.resetHeartbeat(),e.heartBeatHandler.resetCheckMessage(),e.resetStreamCenter()},this.roomHandler.onUserStateUpdate=function(t,r,n){e.stateCenter.actionListener("roomUserUpdate",t,r,n)},this.roomHandler.onDisconnect=function(t){e.logger.error("zc.od.0 "+t.msg),e.stateCenter.actionListener("roomStateUpdate",e.stateCenter.roomid,"DISCONNECTED",t.code,"")},this.roomHandler.onConnecting=function(t){e.stateCenter.actionListener("roomStateUpdate",e.stateCenter.roomid,"CONNECTING",t.code,t.msg)},this.roomHandler.loginBodyData=function(){return e.loginBodyData()}},t.prototype.bindMessageHandler=function(){var e=this;this.messageHandler=new u.MessageHandler(this.logger,this.stateCenter,this.socketCenter),this.messageHandler.onRecvCustomCommand=function(t,r,n,i){e.stateCenter.actionListener("IMRecvCustomCommand",n,{userID:t,userName:r},i)},this.messageHandler.onRecvBigRoomMessage=function(t,r){var n=[];t.forEach((function(e){var t={fromUser:{userID:e.idName,userName:e.nickName},message:e.content,sendTime:e.time,messageID:e.messageId};n.push(t)})),e.stateCenter.actionListener("IMRecvBarrageMessage",r,n)},this.messageHandler.onRecvReliableMessage=function(t,r,n){e.stateCenter.actionListener("recvReliableMessage",t,r,n)}},t.prototype.bindLiveHandler=function(){var e=this;this.liveHandler=new h.LiveHandler(this.logger,this.stateCenter,this.socketCenter),this.liveHandler.onRecvEndJoinLiveCommand=function(t,r,n,i){e.stateCenter.actionListener("recvEndJoinLiveCommand",t,r,n,i)},this.liveHandler.onRecvInviteJoinLiveRequest=function(t,r,n,i){e.stateCenter.actionListener("RecvInviteJoinLiveRequest",t,r,n,i)},this.liveHandler.onRecvJoinLiveRequest=function(t,r,n,i){e.stateCenter.actionListener("recvJoinLiveRequest",t,r,n,i)}},t.prototype.bindStreamCenterHandler=function(){var e=this;this.streamCenter.onPlayStateUpdate=function(t,r,n){e.stateCenter.actionListener("playerStateUpdate",{state:f.ClientUtil.getPlayerStateType(t),streamID:r,errorCode:n.code,extendedData:n.msg})},this.streamCenter.onPublishQualityUpdate=function(t,r){e.stateCenter.actionListener("publishQualityUpdate",t,r)},this.streamCenter.onPlayQualityUpdate=function(t,r){e.stateCenter.actionListener("playQualityUpdate",t,r)},this.streamCenter.onRemoteCameraStatusUpdate=function(t,r){e.stateCenter.actionListener("remoteCameraStatusUpdate",t,r)},this.streamCenter.onRemoteMicStatusUpdate=function(t,r){e.stateCenter.actionListener("remoteMicStatusUpdate",t,r)}},t.prototype.setLogConfig=function(e){return this.logger.debug("zb.cm.cf call"),e.logLevel&&this.logger.setLogLevel(f.ClientUtil.getLogLevel(e.logLevel)),e.remoteLogLevel&&[0,1,2,3].includes(f.ClientUtil.getLogLevel(e.remoteLogLevel))?this.logger.setRemoteLogLevel(f.ClientUtil.getLogLevel(e.remoteLogLevel)):e.remoteLogLevel&&(this.logger.error("zb.cm.cf remote log level only can be debug | info | warn | error"),this.logger.setRemoteLogLevel(0)),this.logger.setSessionInfo(this.stateCenter.appid,"","",this.stateCenter.idName,"",o.PROTO_VERSION),"string"==typeof e.logURL&&e.logURL.startsWith("wss://")?this.logger.openLogServer(e.logURL):e.logURL&&this.logger.error("zb.cm.cf log level must be a wss url"),this.logger.debug("zb.cm.cf call success"),!0},t.prototype.setDebugVerbose=function(e){this.logger.debug("zb.cm.sd call"),"boolean"==typeof e&&(this.stateCenter.debug=e,this.stateCenter.debugCustom=!0),this.logger.debug("zb.cm.sd call success")},t.prototype.loginRoom=function(e,t,r,n){var i=this;return new Promise((function(s,o){return"string"!=typeof e||""==e?(i.logger.error("zb.rh.lg roomid must be string and not empty"),void o(p.commonErrorList.PARAM)):"string"!=typeof t||""==t?(i.logger.error("zb.rh.lg token must be string and not empty"),void o(p.commonErrorList.PARAM)):r&&"object"==typeof r?r.userID&&"string"==typeof r.userID&&""!=r.userID?r.userName&&"string"==typeof r.userName&&""!=r.userName?void i.roomHandler.login(e,t,r,n,s,o):(i.logger.error("zb.rh.lg userName must be string and not empty"),void o(p.commonErrorList.PARAM)):(i.logger.error("zb.rh.lg userID must be string and not empty"),void o(p.commonErrorList.PARAM)):(i.logger.error("zb.rh.lg user must be exist and is an object"),void o(p.commonErrorList.PARAM))}))},t.prototype.logoutRoom=function(e){"string"==typeof e&&""!=e||this.logger.debug("zb.rh.lg roomid must be string and not empty"),this.roomHandler.logout(e)},t.prototype.sendCustomCommand=function(e,t,r){var n=this;return new Promise((function(i,s){return"string"!=typeof e||""==e?(n.logger.error("zb.mh.scc roomid must be string and not empty"),void s(p.commonErrorList.PARAM)):r instanceof Array&&!r.find((function(e){return"string"!=typeof e}))?"string"!=typeof t&&"object"!=typeof t?(n.logger.error("zb.mh.scc custom content must be a non empty string or object"),void s(p.commonErrorList.PARAM)):void n.messageHandler.sendCustomCommand(r,t,i,s):(n.logger.error("zb.mh.scc dstMembers must be string array"),void s(p.commonErrorList.PARAM))}))},t.prototype.sendBroadcastMessage=function(e,t){var r=this;return new Promise((function(n,i){r.messageHandler.sendRoomMsg(r.stateCenter.msgCategory,e,t,n,i)}))},t.prototype.sendReliableMessage=function(e,t,r,n){this.messageHandler.sendReliableMessage(e,t,r,n)},t.prototype.sendBarrageMessage=function(e,t){var r=this;return new Promise((function(n,i){r.messageHandler.sendBigRoomMessage(r.stateCenter.msgCategory,e,t,n,i)}))},t.prototype.sendRelayMessage=function(e,t,r,n){this.messageHandler.sendRelayMessage(e,t,r,n)},t.prototype.requestJoinLive=function(e,t,r,n){return this.liveHandler.requestJoinLive(e,t,r,n)},t.prototype.inviteJoinLive=function(e,t,r,n){return this.liveHandler.inviteJoinLive(e,t,r,n)},t.prototype.endJoinLive=function(e,t,r){return this.liveHandler.endJoinLive(e,t,r)},t.prototype.respondJoinLive=function(e,t,r,n){return this.liveHandler.respondJoinLive(e,t,r,n)},t.prototype.startMixerTask=function(e){var t=this;return new Promise((function(r,n){t.streamHandler.updateMixStream(e,r,n)}))},t.prototype.setMixerTaskConfig=function(e){return this.streamHandler.setMixerTaskConfig(e)},t.prototype.stopMixerTask=function(e){var t=this;return new Promise((function(r,n){t.streamHandler.stopMixStream(e,r,n)}))},t.prototype.addPublishCdnUrl=function(e,t,r){return this.publishTarget({type:"addpush",streamID:e,pushUrl:r,signature:t})},t.prototype.removePublishCdnUrl=function(e,t,r){return this.publishTarget({type:"delpush",streamID:e,pushUrl:r,signature:t})},t.prototype.clearPublishCdnUrl=function(e,t,r){return this.publishTarget({type:"clearpush",streamID:e,pushUrl:r,signature:t})},t.prototype.publishTarget=function(e){var t=this;return new Promise((function(r,n){t.streamHandler.publishTarget(e,r,n)}))},t.prototype.setStreamExtraInfo=function(e,t){return this.streamHandler.updateStreamExtraInfo(e,t)},t.prototype.bindListener=function(e,t){return this.stateCenter.listenerList[e]?"function"!=typeof t?(this.logger.error("zc.o.0 listener callBack must be funciton"),!1):(-1==this.stateCenter.listenerList[e].indexOf(t)&&this.stateCenter.listenerList[e].push(t),!0):(this.logger.error("zc.o.0 event "+e+" no found"),!1)},t.prototype.deleteListener=function(e,t){if(!this.stateCenter.listenerList[e])return this.logger.error("zc.o.1 listener no found"),!1;var r=this.stateCenter.listenerList[e];return t?r.splice(r.indexOf(t),1):this.stateCenter.listenerList[e]=[],!0},t.prototype.getVersion=function(){return o.PROTO_VERSION},t}(s.Common);t.BaseCenter=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(){}return e.prototype.getSocket=function(e){return null},e.prototype.setCDNInfo=function(e,t){},e.prototype.WebrtcOnPublishStateUpdateHandle=function(e,t,r){},e.prototype.loginBodyData=function(){},e.prototype.resetStreamCenter=function(){if(this.stateCenter.customUrl&&(this.stateCenter.customUrl=null),this.streamCenter.reset(),!this.socketCenter.isDisConnect())for(var e in this.stateCenter.publishStreamList)this.stateCenter.publishStreamList[e].state==n.ENUM_PUBLISH_STREAM_STATE.publishing&&this.streamHandler.updateStreamInfo(e,n.ENUM_STREAM_SUB_CMD.liveEnd,this.stateCenter.publishStreamList[e].extra_info)},e.prototype.handleFetchWebRtcUrlRsp=function(e){var t=e.body.stream_id;if("push"===e.body.ptype)this.stateCenter.publishStreamList[t]?this.streamCenter.startPublishingStream(t,e.body.urls):this.logger.error("cb.cm.hfwur no streamid to publish");else if("pull"==e.body.ptype){for(var r=!1,n=0;n<this.stateCenter.streamList.length;n++)if(this.stateCenter.streamList[n].stream_id===t){r=!0;break}0==r&&this.logger.warn("cb.cm.hfwur cannot find stream, continue to play"),this.streamCenter.startPlayingStream(t,e.body.urls,this.streamCenter.playSuccessCallBack)}},e}();t.Common=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),s=function(){function e(e,t){var r=this;this.websocket=null,this.cmdSeq=0,this.responseRouters={},this.logger=e,this.stateCenter=t,this.responseRouters={push_kickout:function(e){r.handlePushKickout(e)},push_custommsg:function(e){r.handlePushCustomMsg(e)},push_im_chat:function(e){r.handlePushRoomMsg(e)},push_userlist_update:function(e){r.handlePushUserStateUpdateMsg(e)},push_merge_message:function(e){r.handlePushMergeMsg(e)},trans:function(e){r.handleTransRsp(e)},push_trans:function(e){r.handlePushTransMsg(e)}}}return e.prototype.handlePushKickout=function(e){},e.prototype.handlePushCustomMsg=function(e){},e.prototype.handlePushRoomMsg=function(e){},e.prototype.handlePushUserStateUpdateMsg=function(e){},e.prototype.handlePushMergeMsg=function(e){},e.prototype.handlePushTransMsg=function(e){},e.prototype.handleBigImMsgRsp=function(e){},e.prototype.handleTransRsp=function(e){if(this.stateCenter.isLogin())if(0==e.body.err_code){var t=e.body.trans_type;this.stateCenter.transSeqMap[t]?(this.stateCenter.transSeqMap[t].seq=e.body.trans_seq,this.logger.debug("zb.sc.htr trans "+t+" seq "+e.body.trans_seq)):this.logger.error("zb.sc.htr cannot match send info")}else this.logger.error("zb.sc.htr trans send error "+e.body.err_code);else this.logger.error("zb.sc.htr not login")},e.prototype.handleBizChannelRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&t.success(e.header.seq,e.body.cmd,e.body.rsp_body):null!=t.error&&t.error(e.body.err_code,e.header.seq,e.body.rsp_body)},e.prototype.registerRouter=function(e,t){this.responseRouters[e]=t},e.prototype.getSocket=function(e){return null},e.prototype.getHeaderV2=function(e){return{Protocol:"req_v2",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||"",room_id:this.stateCenter.roomid||""}},e.prototype.getHeader=function(e){return{Protocol:"req",cmd:e,appid:this.stateCenter.appid,seq:++this.cmdSeq,user_id:this.stateCenter.userid,session_id:this.stateCenter.sessionid||"",room_id:this.stateCenter.roomid||""}},e.prototype.sendMessage=function(e,t,r,i){if(this.logger.debug("zb.sc.sm call "+e),this.isDisConnect())return this.logger.error("zb.sc.sm error  "+e+"websocket is disconnected"),-1;var s="V1"===n.ROOMVERSION?this.getHeader(e):this.getHeaderV2(e),o={header:s,body:t};if(null==r&&(r=null),null==i&&(i=null),null!=r||null!=i){var a={data:o,seq:s.seq,deleted:!1,time:Date.parse(new Date+""),success:r,error:i},c=this.stateCenter.sendCommandList.push(a);this.stateCenter.sendCommandMap[a.seq]=c}return this.websocket&&this.websocket.send(JSON.stringify(o)),this.logger.debug("zb.sc.sm success"),s.seq},e.prototype.sendCustomMessage=function(e,t,r,i){if(this.logger.debug("zb.sc.scm call"),this.isDisConnect())return this.logger.error("zb.sc.scm error"),!1;var s="V1"===n.ROOMVERSION?this.getHeader(e):this.getHeaderV2(e),o={header:s,body:t},a=JSON.stringify(o);null==r&&(r=null),null==i&&(i=null);var c={data:o,seq:s.seq,deleted:!1,time:Date.parse(new Date+""),success:r,error:i},l=this.stateCenter.sendDataList.push(c);return this.stateCenter.sendDataMap[c.seq]=l,this.websocket&&this.websocket.send(a),this.logger.debug("zb.sc.scm success seq: ",s.seq),!0},e.prototype.isDisConnect=function(){return!this.websocket||1!==this.websocket.readyState},e.prototype.closeSocket=function(){this.websocket&&(this.logger.info("zb.sc.cs close websocket"),this.websocket.onclose=null,this.websocket.onerror=null,this.websocket.close(),this.websocket=null)},e.prototype.createSocket=function(e){this.websocket=this.getSocket(e)},e.prototype.openHandler=function(e){this.websocket&&(this.websocket.onopen=e)},e.prototype.closeHandler=function(e){this.websocket&&(this.websocket.onclose=e)},e.prototype.errorHandler=function(){var e=this;this.websocket&&(this.websocket.onerror=function(t){e.logger.error("zb.sc.oe msg="+JSON.stringify(t))})},e.prototype.checkResponse=function(e){return(e.header.appid!==this.stateCenter.appid||e.header.session_id!==this.stateCenter.sessionid||e.header.user_id!==this.stateCenter.userid||e.header.room_id!==this.stateCenter.roomid||this.stateCenter.runState!==n.ENUM_RUN_STATE.login)&&(this.logger.error("zb.sc.crp check session fail."),!0)},e.prototype.responseHandler=function(){var e=this;this.websocket&&(this.websocket.onmessage=function(t){var r=JSON.parse(t.data);e.logger.info("zb.sc.ws.rph jsonmsg= ",r.header.cmd),e.logger.info("zb.sc.ws.rph jsonmsg= ",t.data),0!==r.body.err_code&&r.body.err_message&&e.logger.error("zb.sc.ws.rph cmd="+r.header.cmd+", err_code="+r.body.err_code+", err_message="+r.body.err_message+" "),"login"!==r.header.cmd?"logout"!==r.header.cmd?e.stateCenter.isLogin()?e.checkResponse(r)?e.logger.error("zb.sc.ws.rph check session fail."):(e.handleSendCommandMsgRsp(r),e.logger.info("zb.sc.ws.rph cmd="+r.header.cmd+",function="+!!e.responseRouters[r.header.cmd]),e.responseRouters[r.header.cmd]&&e.responseRouters[r.header.cmd](r)):e.logger.warn("zb.sc.ws.rph  already logout"):e.responseRouters.logout(r,e.cmdSeq):e.responseRouters.login(r,e.cmdSeq)})},e.prototype.handleSendCommandMsgRsp=function(e){this.logger.debug("zb.sc.hscmr call");var t,r=this.stateCenter.sendCommandMap[e.header.seq];null!=r&&("login"==(t=r._data).data.header.cmd?this.logger.debug("zb.sc.hscmr don't check "+t.data.header.cmd):"relay"==t.data.header.cmd?this.handleRelayRspCallback(e,t):"bigim_chat"==t.data.header.cmd?this.handleBigImRspCallback(e,t):"biz_channel"==t.data.header.cmd?this.handleBizChannelRspCallback(e,t):0===e.body.err_code?null!=t.success&&t.success(e.header.seq):null!=t.error&&t.error(i.ClientUtil.getServerError(e.body.err_code),e.header.seq),delete this.stateCenter.sendCommandMap[e.header.seq],this.stateCenter.sendCommandList.remove(r)),this.logger.debug("zb.sc.hscmr call success")},e.prototype.handleRelayRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&t.success(e.header.seq,e.body.relay_result):null!=t.error&&t.error(i.ClientUtil.getServerError(e.body.err_code),e.header.seq)},e.prototype.handleBigImRspCallback=function(e,t){0===e.body.err_code?null!=t.success&&this.handleBigImMsgRsp(e):null!=t.error&&t.error({errorCode:i.ClientUtil.getServerError(e.body.err_code).code,messageID:""})},e}();t.SocketCenter=s},function(e,t,r){"use strict";var n=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,a=s.length;o<a;o++,i++)n[i]=s[o];return n};Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),s=r(2),o=r(1),a=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.setRunState=function(e){this.logger.debug("zb.rh.srs old="+this.stateCenter.runState+", new="+e),this.stateCenter.lastRunState=this.stateCenter.runState,this.stateCenter.runState=e},e.prototype.resetTryLogin=function(){this.logger.debug("zb.rh.rtl call"),clearTimeout(this.stateCenter.tryLoginTimer),this.stateCenter.tryLoginTimer=null,this.stateCenter.tryLoginCount=0,this.logger.debug("zb.rh.rtl call success")},e.prototype.resetBigRoomInfo=function(){this.stateCenter.transSeqMap={},this.stateCenter.realyMessageList=[],this.stateCenter.relayTimer&&(clearTimeout(this.stateCenter.relayTimer),this.stateCenter.relayTimer=null),this.stateCenter.bigImLastTimeIndex=0,this.stateCenter.bigIMmessageList=[],this.stateCenter.bigImCallbackMap={},this.stateCenter.bigImTimer&&(clearTimeout(this.stateCenter.bigImTimer),this.stateCenter.bigImTimer=null),this.stateCenter.serverTimeOffset=0,this.stateCenter.datiTimeWindow=0,this.stateCenter.bigimTimeWindow=0},e.prototype.resetRoom=function(e){var t=this;this.logger.debug("zb.rh.rr call"),this.resetTryLogin(),this.resetRoomCallBack(),this.stateCenter.streamList=[],this.stateCenter.streamQuerying=!1,this.stateCenter.publishStreamList={},this.stateCenter.joinLiveCallbackMap={},this.stateCenter.joinLiveRequestMap={},this.stateCenter.streamUrlMap={},this.resetBigRoomInfo(),this.stateCenter.cmdCallback={},this.logger.debug("zb.rh.rr call send logout=",this.stateCenter.sessionid),"0"!==this.stateCenter.sessionid&&this.stateCenter.runState!==i.ENUM_RUN_STATE.logout&&(this.socketCenter.registerRouter("logout",(function(e){t.handleLogoutRsp(e)})),this.socketCenter.sendMessage("logout",{reserve:0})),this.socketCenter.closeSocket(),this.setRunState(i.ENUM_RUN_STATE.logout),this.stateCenter.userid="",this.stateCenter.sessionid="",this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.userid,this.stateCenter.idName,this.stateCenter.sessionid,i.PROTO_VERSION),this.logger.debug("zb.rh.rr call success")},e.prototype.resetRoomCallBack=function(){},e.prototype.onDisconnect=function(e){},e.prototype.onConnecting=function(e){},e.prototype.loginSuccessCallBack=function(e,t){},e.prototype.login=function(e,t,r,n,a,c){if(this.logger.setSessionInfo(this.stateCenter.appid,e,"",r.userID,"",i.PROTO_VERSION),this.logger.info("zb.rh.lg call:",e,t),n&&n.userUpdate&&"boolean"==typeof n.userUpdate&&(this.stateCenter.userStateUpdate=n.userUpdate),!this.stateCenter.configOK)return this.logger.error("zb.rh.lg init sdk wrong"),void c(o.commonErrorList.INIT);this.stateCenter.runState!==i.ENUM_RUN_STATE.logout&&(this.logger.debug("zb.rh.lg reset"),this.setRunState(i.ENUM_RUN_STATE.logout),this.resetRoom()),this.logger.debug("zb.rh.lg begin"),this.setRunState(i.ENUM_RUN_STATE.trylogin),this.stateCenter.roomid=e,this.stateCenter.token=t,this.stateCenter.third_token=t,this.stateCenter.idName=r.userID,this.stateCenter.nickName=r.userName,s.ClientUtil.registerCallback("login",{success:a,error:c},this.stateCenter.callbackList),this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin(),this.logger.info("zb.rh.lg call success")},e.prototype.loginBodyData=function(){},e.prototype.tryLogin=function(){var e=this;if(this.logger.debug("zb.rh.tl call"),this.stateCenter.runState===i.ENUM_RUN_STATE.trylogin){if(++this.stateCenter.tryLoginCount>i.MAX_TRY_LOGIN_COUNT){this.logger.error("zb.rh.tl fail times limit");var t=this.stateCenter.lastRunState;return this.setRunState(i.ENUM_RUN_STATE.logout),this.resetRoom(),void(t==i.ENUM_RUN_STATE.login?(this.logger.error("zb.rh.tl fail and disconnect"),this.onDisconnect(i.sdkErrorList.LOGIN_DISCONNECT)):(this.logger.info("zb.rh.tl fail and callback user"),s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(o.liveRoomErrorList.FREQ_LIMITED)))}if(this.stateCenter.startConnceTime=(new Date).getTime(),console.warn("start connect",this.stateCenter.startConnceTime),this.socketCenter.isDisConnect()){this.logger.debug("zb.rh.tl need new websocket");try{this.socketCenter.closeSocket(),this.logger.debug("zb.rh.tl new websocket"),this.socketCenter.createSocket(this.stateCenter.tryLoginCount%2==1?this.stateCenter.server:this.stateCenter.serverBak),this.socketCenter.registerRouter("login",(function(t,r){e.handleLoginRsp(t,r)})),this.socketCenter.closeHandler((function(t){e.socketCenter.closeSocket(),e.closeHandler(t)})),this.socketCenter.openHandler((function(){e.openHandler()}))}catch(e){this.logger.error("zb.rh.tl websocket err:"+e)}}else{var r=this.loginBodyData();this.logger.info("zb.rh.tl use current websocket and sent login"),this.socketCenter.sendMessage("login",r)}this.stateCenter.tryLoginTimer=setTimeout((function(){e.tryLogin()}),i.TRY_LOGIN_INTERVAL[this.stateCenter.tryLoginCount%i.MAX_TRY_LOGIN_COUNT]),this.logger.info("zb.rh.tl call success")}else this.logger.error("zb.rh.tl state error")},e.prototype.handleLoginRsp=function(e,t){if(this.logger.debug("zb.rh.hlr call"),this.stateCenter.runState===i.ENUM_RUN_STATE.trylogin){if(e.header.seq===t)return 0!==e.body.err_code?(this.handleLoginFail(e),void this.logger.error("zb.rh.hlr server error=",e.body.err_code)):(this.handleLoginSuccess(e),void this.logger.info("zb.rh.hlr call success."));this.logger.error("zb.rh.hlr in wrong seq, local=",t,",recv=",e.header.seq)}else this.logger.error("zb.rh.hlr state error")},e.prototype.handleLoginFail=function(e){if(this.logger.debug("zb.rh.hlf call"),s.ClientUtil.isKeepTryLogin(e.body.err_code))this.logger.warn("zb.rh.hlf KeepTry true");else{var t=this.stateCenter.lastRunState;this.setRunState(i.ENUM_RUN_STATE.logout),this.resetRoom();var r=s.ClientUtil.getServerError(e.body.err_code);t===i.ENUM_RUN_STATE.login?(this.logger.info("zb.rh.hlf callback disconnect"),this.onDisconnect(r)):(this.logger.info("zb.rh.hlf callback error"),s.ClientUtil.actionErrorCallback("login",this.stateCenter.callbackList)(r)),this.logger.debug("zb.rh.hlf call success")}},e.prototype.handleLoginSuccess=function(e){this.stateCenter.startloginSucTime=(new Date).getTime(),console.warn("login suc",this.stateCenter.startloginSucTime,this.stateCenter.startloginSucTime-this.stateCenter.startloginTime,this.stateCenter.startloginSucTime-this.stateCenter.startConnceTime),this.logger.info("zb.rh.hls call");var t=this.stateCenter.lastRunState;if(this.setRunState(i.ENUM_RUN_STATE.login),this.stateCenter.userid=e.body.user_id,this.stateCenter.sessionid=e.body.session_id,this.stateCenter.anchor_info=e.body.anchor_info||this.stateCenter.anchor_info,this.logger.setSessionInfo(this.stateCenter.appid,this.stateCenter.roomid,this.stateCenter.userid,this.stateCenter.idName,this.stateCenter.sessionid,i.PROTO_VERSION),e.body.config_info&&(this.logger.setRemoteLogLevel(e.body.config_info.log_level),""!=e.body.config_info.log_url&&this.logger.openLogServer(e.body.config_info.log_url)),null!=e.body.ret_timestamp&&"string"==typeof e.body.ret_timestamp){var r=parseFloat(e.body.ret_timestamp);this.stateCenter.serverTimeOffset=0==r?0:e.body.ret_timestamp-(new Date).getTime()}e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.stateCenter.datiTimeWindow=e.body.dati_time_window),e.body.cluster_env&&1===e.body.cluster_env&&(this.stateCenter.testEnvironment=!0,!this.stateCenter.debugCustom&&(this.stateCenter.debug=!0)),this.resetTryLogin(),this.loginSuccessCallBack(t,e)},e.prototype.openHandler=function(){this.logger.info("zb.rh.oh websocket.onpen call"),this.socketCenter.responseHandler();var e=this.loginBodyData();this.logger.info("zb.rh.oh websocket.onpen send login"),this.stateCenter.startloginTime=(new Date).getTime(),console.warn("start login",this.stateCenter.startloginTime,this.stateCenter.startloginTime-this.stateCenter.startConnceTime),this.socketCenter.sendMessage("login",e),this.logger.debug("zb.rh.oh websocket.onpen call success")},e.prototype.closeHandler=function(e){this.logger.info("zb.rh.ws.oc msg="+JSON.stringify(e)),this.stateCenter.runState!==i.ENUM_RUN_STATE.logout?this.stateCenter.runState===i.ENUM_RUN_STATE.trylogin&&this.stateCenter.tryLoginCount<=i.MAX_TRY_LOGIN_COUNT?this.logger.info("zb.rh.ws.oc is called because of try login"):this.stateCenter.runState===i.ENUM_RUN_STATE.login?(this.logger.info("zb.rh.ws.oc is called because of network broken, try again"),this.setRunState(i.ENUM_RUN_STATE.trylogin),this.resetTryLogin(),this.onConnecting({code:0,msg:""}),this.tryLogin()):(this.logger.error("zb.rh.ws.oc out of think!!!"),this.setRunState(i.ENUM_RUN_STATE.logout),this.resetRoom(),this.onDisconnect(i.sdkErrorList.UNKNOWN)):this.logger.info("zb.rh.ws.oc onclose logout flow call websocket.close")},e.prototype.logout=function(e){this.logger.debug("zb.rh.lo call"),this.stateCenter.runState!==i.ENUM_RUN_STATE.logout?(this.resetRoom(e),this.logger.info("zb.rh.lo call success")):this.logger.warn("zb.rh.lo at logout")},e.prototype.fetchUserList=function(e){this.logger.debug("zb.rh.ful call"),this.stateCenter.userQuerying?this.logger.warn("zb.rh.ful is already querying"):(this.stateCenter.userQuerying=!0,this.stateCenter.userTempList=[],"V1"===i.ROOMVERSION?this.fetchUserListWithPage(0,e||0):this.fetchUserListWithPageV2(0),this.logger.info("zb.rh.ful the first time call"))},e.prototype.fetchUserListWithPageV2=function(e){var t=this;this.logger.debug("zb.rh.fulwp call"),this.socketCenter.registerRouter("user_list_v2",(function(r){t.handleFetchUserListRspV2(e,r)})),this.socketCenter.sendMessage("user_list_v2",{marker:0===e?"":e+"",mode:0,limit:100}),this.logger.info("zb.rh.fulwp call success")},e.prototype.fetchUserListWithPage=function(e,t){var r=this;this.logger.debug("zb.rh.fulwp call"),this.socketCenter.registerRouter("user_list",(function(e){r.handleFetchUserListRsp(e,t)})),this.socketCenter.sendMessage("user_list",{user_index:e,sort_type:0}),this.logger.info("zb.rh.fulwp call success")},e.prototype.handleFetchUserListRspV2=function(e,t){if(this.logger.debug("zb.rh.hfulr call"),0!=t.body.err_code)return this.stateCenter.userQuerying=!1,void this.logger.info("zb.rh.hfulr fetch error "+t.body.err_code);if(this.stateCenter.userStateUpdate){if(this.stateCenter.userTempList=n(this.stateCenter.userTempList,t.body.user_baseinfos),e!=t.body.marker)return this.logger.warn("zb.rh.hfulr fetch another page"),void this.fetchUserListWithPageV2(e+1);this.stateCenter.userSeq=t.body.server_user_seq,this.logger.info("zb.rh.hfulr set user Seq "+this.stateCenter.userSeq);for(var r=[],i=0;i<this.stateCenter.userTempList.length;i++){var s={userId:this.stateCenter.userTempList[i].id_name,userName:this.stateCenter.userTempList[i].nick_name};r.push(s)}this.stateCenter.userQuerying=!1,this.stateCenter.userTempList=[],this.logger.info("zb.rh.hfulr call success user_list "+r+" count "+r.length)}},e.prototype.handleFetchUserListRsp=function(e,t){var r=this;if(this.logger.debug("zb.rh.hfulr call"),0!=e.body.err_code)return this.stateCenter.userQuerying=!1,void this.logger.info("zb.rh.hfulr fetch error "+e.body.err_code);if(this.stateCenter.userStateUpdate){this.stateCenter.userTempList=n(this.stateCenter.userTempList,e.body.user_baseinfos);var o=e.body.ret_user_index;if(o!=e.body.server_user_index)return this.logger.warn("zb.rh.hfulr fetch another page"),void this.fetchUserListWithPage(o+1,t);this.stateCenter.userSeq=e.body.server_user_seq,this.logger.info("zb.rh.hfulr set user Seq "+this.stateCenter.userSeq);for(var a=[],c=0;c<this.stateCenter.userTempList.length;c++){var l={userID:this.stateCenter.userTempList[c].id_name,userName:this.stateCenter.userTempList[c].nick_name};a.push(l)}t==i.ENUM_RUN_STATE.login?(s.ClientUtil.mergeUserList(this.logger,this.stateCenter.userList,a,(function(e,t){0!==e.length&&r.onUserStateUpdate(r.stateCenter.roomid,"ADD",e),0!==t.length&&r.onUserStateUpdate(r.stateCenter.roomid,"DELETE",t)})),this.stateCenter.userList=a):(this.stateCenter.userList=a,this.onUserStateUpdate(this.stateCenter.roomid,"ADD",a)),this.stateCenter.userQuerying=!1,this.stateCenter.userTempList=[],this.logger.info("zb.rh.hfulr call success user_list "+a+" count "+a.length)}},e.prototype.handleLogoutRsp=function(e){this.logger.debug("zb.rh.hlor result=",e.body.err_code)},e.prototype.handlePushUserStateUpdateMsg=function(e){if(this.logger.info("zb.rh.hpus call"),this.stateCenter.isLogin())if(this.stateCenter.userStateUpdate){if(this.stateCenter.userSeq+e.body.user_actions.length!==e.body.user_list_seq)return this.logger.warn("zb.rh.hpus fetch new userlist "+this.stateCenter.userSeq,NaN+e.body.user_list_seq),void this.fetchUserList();this.stateCenter.userSeq=e.body.user_list_seq,this.logger.debug("zb.rh.hpus push userSeq "+this.stateCenter.userSeq);for(var t=[],r=0;r<e.body.user_actions.length;r++){var n={action:e.body.user_actions[r].Action,idName:e.body.user_actions[r].IdName,nickName:e.body.user_actions[r].NickName,loginTime:e.body.user_actions[r].LoginTime};t.push(n)}var i=[],s=[];t.filter((function(e){1==e.action?i.push({userID:e.idName,userName:e.nickName}):2==e.action&&s.push({userID:e.idName,userName:e.nickName})})),this.stateCenter.userList=this.stateCenter.userList.concat(i).filter((function(e){return!s.some((function(t){return t.userID==e.userID}))})),0!==i.length&&this.onUserStateUpdate(e.body.room_id,"ADD",i),0!==s.length&&this.onUserStateUpdate(e.body.room_id,"DELETE",s),this.logger.info("zb.rh.hpus call success")}else this.logger.info("zb.rh.hpus no userStateUpdate flag");else this.logger.error("zb.rh.hpus not login")},e.prototype.onUserStateUpdate=function(e,t,r){},e}();t.RoomHandler=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),s=r(1),o=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.setCDNInfo=function(e,t){},e.prototype.onStreamUpdated=function(e,t,r){},e.prototype.onStreamExtraInfoUpdated=function(e,t){},e.prototype.handleStreamStart=function(e,t){var r=this;if(this.stateCenter.streamQuerying=!1,this.socketCenter.registerRouter("stream",(function(e){r.handleStreamUpdateRsp(e)})),this.socketCenter.registerRouter("push_stream_update",(function(e){r.handlePushStreamUpdateMsg(e)})),this.stateCenter.actionListener("roomStateUpdate",this.stateCenter.roomid,"CONNECTED",0,""),e==n.ENUM_RUN_STATE.login)this.logger.info("zb.sh.hss recover from disconnect so call streamupdate"),this.handleFullUpdateStream(t.body.stream_seq,t.body.stream_info||[]);else{this.logger.info("zb.sh.hss success callback user"),this.stateCenter.streamList=t.body.stream_info||[],this.stateCenter.streamSeq=t.body.stream_seq;for(var s=0;s<this.stateCenter.streamList.length;s++)this.stateCenter.streamList[s].anchor_id_name==this.stateCenter.idName&&(this.updateStreamInfo(this.stateCenter.streamList[s].stream_id,n.ENUM_STREAM_SUB_CMD.liveEnd),this.stateCenter.streamList.splice(s,1));var o=this.makeCallbackStreamList(this.stateCenter.streamList).map((function(e){return{streamID:e.streamID,user:e.user,extraInfo:e.extraInfo,urlsFLV:e.urlFlv,urlsRTMP:e.urlRtmp,urlsHLS:e.urlHls,urlsHttpsFLV:e.urlHttpsFlv,urlsHttpsHLS:e.urlHttpsHls}}));this.onStreamUpdated(this.stateCenter.roomid,n.ENUM_STREAM_UPDATE_TYPE.added,o),i.ClientUtil.actionSuccessCallback("login",this.stateCenter.callbackList)(!0)}},e.prototype.onPublishStateUpdate=function(e,t,r){},e.prototype.updateStreamInfo=function(e,t,r,n){var i=this;void 0===r&&(r=""),this.logger.debug("zb.sh.usi call");var s={stream_id:e,extra_info:r},o={sub_cmd:t,stream_msg:JSON.stringify(s)};this.socketCenter.registerRouter("stream",(function(e){i.handleStreamUpdateRsp(e)})),this.socketCenter.sendMessage("stream",o,void 0,n),this.logger.info("zb.sh.usi call success cmd "+t)},e.prototype.handleStreamUpdateRsp=function(e){if(this.stateCenter.isLogin())if(0==e.body.err_code){this.logger.info("zb.sh.hsur stream seq "+this.stateCenter.streamSeq+" server seq "+e.body.stream_seq),this.stateCenter.streamSeq=e.body.stream_seq;for(var t=0;t<e.body.stream_info.length;t++){var r=e.body.stream_info[t].stream_id;if(!this.stateCenter.publishStreamList[r])return void this.logger.info("hsur.0 stream is not exist");this.stateCenter.publishStreamList[r].state==n.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.stateCenter.publishStreamList[r].state=n.ENUM_PUBLISH_STREAM_STATE.publishing,this.onPublishStateUpdate(0,r,{code:0,msg:""}))}}else this.logger.error("zb.sh.hsur stream update error "+e.body.err_code);else this.logger.error("zb.sh.hsur not login")},e.prototype.handleFetchStreamListRsp=function(e){this.logger.info("zb.sh.hfslr call"),this.stateCenter.streamQuerying=!1,0===e.body.err_code?this.stateCenter.streamSeq!==e.body.stream_seq?(this.handleFullUpdateStream(e.body.stream_seq,e.body.stream_info),this.logger.debug("zb.sh.hfslr call success")):this.logger.info("zb.sh.hfslr same seq"):this.logger.info("zb.sh.hfslr server error=",e.body.err_code)},e.prototype.handleFullUpdateStream=function(e,t){var r=this;this.logger.debug("zb.sh.hfus call"),this.stateCenter.streamSeq=e,this.logger.debug("zb.sh.hfus server seq "+this.stateCenter.streamSeq),i.ClientUtil.mergeStreamList(this.logger,this.stateCenter.idName,this.stateCenter.streamList,t,(function(e,t,i){0!==e.length&&(r.logger.debug("zb.sh.hfus callback addstream"),r.onStreamUpdated(r.stateCenter.roomid,n.ENUM_STREAM_UPDATE_TYPE.added,r.makeCallbackStreamList(e))),0!==t.length&&(r.logger.debug("zb.sh.hfus callback delstream"),r.onStreamUpdated(r.stateCenter.roomid,n.ENUM_STREAM_UPDATE_TYPE.deleted,r.makeCallbackStreamList(t))),0!==i.length&&(r.logger.debug("zb.sh.hfus callback updatestream"),r.onStreamExtraInfoUpdated(r.stateCenter.roomid,r.makeCallbackStreamList(i)))})),this.logger.info("zb.sh.hfus call success")},e.prototype.handlePushStreamUpdateMsg=function(e){if(this.logger.info("zb.sh.hpsum call"),e.body.stream_info&&0!==e.body.stream_info.length){if(e.body.stream_info.length+this.stateCenter.streamSeq!==e.body.stream_seq)return this.logger.info("zb.sh.hpsum call updatestream"),void this.fetchStreamList();switch(this.stateCenter.streamSeq=e.body.stream_seq,e.body.stream_cmd){case n.ENUM_STREAM_UPDATE_CMD.added:this.handleAddedStreamList(e.body.stream_info);break;case n.ENUM_STREAM_UPDATE_CMD.deleted:this.handleDeletedStreamList(e.body.stream_info);break;case n.ENUM_STREAM_UPDATE_CMD.updated:this.handleUpdatedStreamList(e.body.stream_info)}this.logger.info("zb.sh.hpsum call success")}else this.logger.info("zb.sh.hpsum, emtpy list")},e.prototype.handleAddedStreamList=function(e){this.logger.debug("zb.sh.hasl call");for(var t,r=[],i=0;i<e.length;i++)if(e[i].anchor_id_name!=this.stateCenter.idName){t=!1;for(var s=0;s<this.stateCenter.streamList.length;s++)if(e[i].stream_id===this.stateCenter.streamList[s].stream_id){t=!0;break}t||r.push(e[i])}else this.logger.debug("hdsl.0 have self stream added");if(0!==r.length){this.logger.debug("zb.sh.hasl callback addstream");for(var o=0;o<r.length;o++)this.stateCenter.streamList.push(r[o]);this.onStreamUpdated(this.stateCenter.roomid,n.ENUM_STREAM_UPDATE_TYPE.added,this.makeCallbackStreamList(r))}this.logger.info("zb.sh.hasl call success")},e.prototype.handleDeletedStreamList=function(e){this.logger.debug("zb.sh.hdsl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var i=this.stateCenter.streamList.length-1;i>=0;i--)if(e[r].stream_id===this.stateCenter.streamList[i].stream_id){this.stateCenter.streamList.splice(i,1),t.push(e[r]);break}}else this.logger.debug("zb.sh.hdsl have self stream deleted");0!==t.length&&(this.logger.debug("zb.sh.hdsl callback delstream"),this.onStreamUpdated(this.stateCenter.roomid,n.ENUM_STREAM_UPDATE_TYPE.deleted,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.hdsl call")},e.prototype.handleUpdatedStreamList=function(e){this.logger.debug("zb.sh.husl call");for(var t=[],r=0;r<e.length;r++)if(e[r].anchor_id_name!=this.stateCenter.idName){for(var n=0;n<this.stateCenter.streamList.length;n++)if(e[r].stream_id===this.stateCenter.streamList[n].stream_id){e[r].extra_info!==this.stateCenter.streamList[n].extra_info&&(this.stateCenter.streamList[n]=e[r],t.push(e[r]));break}}else this.logger.debug("hsul.0 have self stream updated");0!==t.length&&(this.logger.debug("zb.sh.husl callback updatestream"),this.onStreamExtraInfoUpdated(this.stateCenter.roomid,this.makeCallbackStreamList(t))),this.logger.info("zb.sh.husl call success")},e.prototype.fetchStreamList=function(){this.logger.info("zb.sh.fsl call"),this.stateCenter.isLogin()?this.stateCenter.streamQuerying?this.logger.info("zb.sh.fsl already doing"):(this.stateCenter.streamQuerying=!0,this.logger.debug("zb.sh.fsl send fetch request"),this.socketCenter.registerRouter("stream_info",this.handleFetchStreamListRsp),this.socketCenter.sendMessage("stream_info",{reserve:0}),this.logger.debug("zb.sh.fsl call success")):this.logger.info("zb.sh.fsl state error")},e.prototype.makeCallbackStreamList=function(e){var t=[];if(e&&e.length>0)for(var r=0;r<e.length;r++){var n={user:{userID:e[r].anchor_id_name,userName:e[r].anchor_nick_name},extraInfo:e[r].extra_info,streamID:e[r].stream_id,roomID:"",urlFlv:"",urlRtmp:"",urlHls:"",urlHttpsFlv:"",urlHttpsHls:""};this.setCDNInfo(n,e[r]),t.push(n)}return t},e.prototype.updateMixStream=function(e,t,r){var o,a=this;if(this.logger.info("zb.sh.ums call"),!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),r({errorCode:s.commonErrorList.PARAM.code,extendedData:""}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),r({errorCode:s.commonErrorList.PARAM.code,extendedData:""}),!1;if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),r({errorCode:s.commonErrorList.MIX_OUTPUT.code,extendedData:""}),!1;if(!e.outputConfig||"object"!=typeof e.outputConfig)return this.logger.error("zb.sh.ums no output config found"),r({errorCode:s.commonErrorList.MIX_OUTPUT.code,extendedData:""}),!1;if(!e.outputConfig.outputBitrate||"number"!=typeof e.outputConfig.outputBitrate)return this.logger.error("zb.sh.ums bitrate param is required and must be number"),r({errorCode:s.commonErrorList.PARAM.code,extendedData:""}),!1;if(!e.outputConfig.outputFps||"number"!=typeof e.outputConfig.outputFps)return this.logger.error("zb.sh.ums fps param is required and must be number"),r({errorCode:s.commonErrorList.PARAM.code,extendedData:""}),!1;if(!e.outputConfig.outputWidth||"number"!=typeof e.outputConfig.outputWidth)return this.logger.error("zb.sh.ums width param is required and must be number"),r({errorCode:s.commonErrorList.PARAM.code,extendedData:""}),!1;if(!e.outputConfig.outputHeight||"number"!=typeof e.outputConfig.outputHeight)return this.logger.error("zb.sh.ums height param is required and must be number"),r({errorCode:s.commonErrorList.PARAM.code,extendedData:""}),!1;var c={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:n.PROTO_VERSION},l=this.stateCenter.mixStreamAdvance;l&&(l.videoCodec&&(c.extra_params=[{key:"video_encode",value:l.videoCodec}]),l.backgroundColor&&(c.output_bg_color=l.backgroundColor),l.backgroundImage&&(c.output_bg_image=l.backgroundImage),l.waterMark&&(c.watermark=l.waterMark),l.extraParams&&(!c.extra_params&&(c.extra_params=[]),(o=c.extra_params).push.apply(o,l.extraParams)));for(var d=[],u=0;u<e.inputList.length;u++){var h=e.inputList[u],p=h.streamID;this.stateCenter.testEnvironment&&(p="zegotest-"+this.stateCenter.appid+"-"+h.streamID),d.push({stream_id:p,content_control:"AUDIO"===h.contentType?2:0,rect:{layer:u,top:h.layout.top,left:h.layout.left,bottom:h.layout.bottom,right:h.layout.right}})}c.MixInput=d;var f=[];e.outputList.forEach((function(t){var n={},i="";if("string"==typeof t)i=t;else{if("object"!=typeof t||!t.target)return a.logger.error("zb.sh.ums output target required"),r({errorCode:s.commonErrorList.MIX_OUTPUT.code,extendedData:""}),!1;i=t.target}i.startsWith("rtmp://")||i.startsWith("https://")&&i.endsWith(".flv")||i.startsWith("https://")&&i.endsWith(".m3u8")?n.mixurl=i:a.stateCenter.testEnvironment?n.stream_id="zegotest-"+a.stateCenter.appid+"-"+i:n.stream_id=i,n.bitrate=1e3*e.outputConfig.outputBitrate,n.fps=e.outputConfig.outputFps,n.width=e.outputConfig.outputWidth,n.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID?n.audio_enc_id=e.outputConfig.outputAudioCodecID:"vp8"==l.videoCodec&&(n.audio_enc_id=3),e.outputConfig.outputAudioBitrate&&(n.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(n.audio_channel_cnt=e.outputConfig.outputAudioChannels),a.stateCenter.testEnvironment?n.testenv=1:n.testenv=0,f.push(n)})),c.MixOutput=f;var g={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(c)};return this.logger.debug("zb.sh.ums send command"),this.socketCenter.sendMessage("biz_channel",g,(function(e,s,o){a.logger.debug("zb.sh.ums receive message");var c="zegotest-"+a.stateCenter.appid+"-";if(0!=o.length){for(var l=JSON.parse(o),d=[],u=0;u<l.play.length;u++){var h={rtmpURL:"",hlsURL:"",flvURL:""},p=l.play[u].stream_alias||"";a.stateCenter.testEnvironment&&p&&p.startsWith(c)&&(p=p.slice(c.length)),h.streamID=p,l.play[u].rtmp_url&&l.play[u].rtmp_url.length>0&&(h.rtmpURL=l.play[u].rtmp_url),l.play[u].hls_url&&l.play[u].hls_url.length>0&&(h.hlsURL=l.play[u].hls_url),l.play[u].hdl_url&&l.play[u].hdl_url.length>0&&(h.flvURL=l.play[u].hdl_url),d.push(h)}if(t){var f={mixerOutputList:d};t({errorCode:0,extendedData:JSON.stringify(f)})}}else r&&r({errorCode:i.ClientUtil.getServerError(n.MIXSTREAM_ERROR_CODE+1).code,extendedData:""})}),(function(e,t,s){if("number"==typeof e){a.logger.debug("zb.sh.ums error: "+e);var o=[];if(1000000150==e&&0!=s.length)for(var c=JSON.parse(s),l="zegotest-"+a.stateCenter.appid+"-",d=0;d<c.non_exist_streams.length;d++){var u=c.non_exist_streams[d];a.stateCenter.testEnvironment&&u.startsWith(l)?o.push(u.slice(l.length)):o.push(u)}r&&r({errorCode:i.ClientUtil.getServerError(n.MIXSTREAM_ERROR_CODE+e).code,extendedData:""})}else a.logger.debug("zb.sh.ums error code "+e.code),r&&r({errorCode:e.code,extendedData:""})})),!0},e.prototype.setMixerTaskConfig=function(e){var t=this;return new Promise((function(r,n){var i={};if(e&&e.videoCodec){if("h264"!==e.videoCodec&&"vp8"!==e.videoCodec)return t.logger.error("zb.sh.ums param videoCode error"),n({errorCode:s.commonErrorList.MIX_VIDEOC,extendedData:""}),!1;e.videoCodec,i.videoCodec=e.videoCodec}if(e.backgroundColor){if("number"!=typeof e.backgroundColor)return t.logger.error("zb.sh.ums param outputBgColor error"),n({errorCode:s.commonErrorList.PARAM,extendedData:""}),!1;i.backgroundColor=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage||!e.backgroundImage.startsWith("preset-id://"))return t.logger.error("zb.sh.ums param outputBgImage error"),n({errorCode:s.commonErrorList.PARAM,extendedData:""}),!1;i.backgroundImage=e.backgroundImage}e.waterMark&&(i.waterMark=e.waterMark),t.stateCenter.mixStreamAdvance=i,r({errorCode:0,extendedData:""})}))},e.prototype.publishTarget=function(e,t,r){var s=this;if(-1!=["addpush","delpush","clearpush"].indexOf(e.type))if(this.logger.info("zb.sh.ptcall"),e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(e.signature&&"string"==typeof e.signature)if(this.stateCenter.publishStreamList[e.streamID]){var o=Math.ceil((new Date).getTime()/1e3),a=e.streamID;this.stateCenter.testEnvironment&&(a="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var c={appid:this.stateCenter.appid,biz_type:0,timestamp:o,signature:e.signature,seq:this.stateCenter.cdnSeq++,version:1*n.PROTO_VERSION,stream_id:a,pushurl:e.pushUrl},l={channel:"media",cmd:e.type,req_body:JSON.stringify(c)};this.logger.debug("zb.sh.pt send command"),this.socketCenter.sendMessage("biz_channel",l,(function(o,a,c){if(s.logger.debug("zb.sh.pt receive message"),0!=c.length){var l=JSON.parse(c),d=l.code,u=l.message;if(d&&0!=d)return s.logger.error("zb.sh.pt "+e.type+" error code: "+d+" "+u),void(r&&r({errorCode:d}));s.logger.info("zb.sh.pt "+e.type+" success"),t&&t({errorCode:0})}else r&&r({errorCode:i.ClientUtil.getServerError(n.MIXSTREAM_ERROR_CODE+1).code})}),(function(e,t,n){s.logger.debug("zb.sh.pt error: "+r);var i="";2001==e?i="invalid channel":2002==e&&(i="bizchannel error"),s.logger.error("zb.sh.pt "+i),r&&r({errorCode:e})}))}else this.logger.error("zb.sh.pt publish stream no found");else this.logger.error("zb.sh.pt appSecret error");else this.logger.error("zb.sh.pt pushurl error");else this.logger.error("zb.sh.pt streamid error");else this.logger.error("zb.sh.pt cdn push type error")},e.prototype.stopMixStream=function(e,t,r){var o=this;if(this.logger.info("zb.sh.sms call"),!e||"string"!=typeof e)return this.logger.error("zb.sh.sms taskid error"),!1;var a={id_name:this.stateCenter.idName,live_channel:this.stateCenter.roomid,appid:this.stateCenter.appid,version:n.PROTO_VERSION,task_id:e},c={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(a)};return this.socketCenter.sendMessage("biz_channel",c,(function(){t&&t({errorCode:0})}),(function(e){"number"==typeof e?r&&r({errorCode:i.ClientUtil.getServerError(n.MIXSTREAM_ERROR_CODE+e).code}):(o.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e)),r&&r({errorCode:s.commonErrorList.STOP_MIX_FAIL.code}))})),!0},e.prototype.updateStreamExtraInfo=function(e,t){return this.logger.info("zb.sh.usei call"),"string"!=typeof e||""==e?(this.logger.error("zb.sh.usei streamid must be string and not empty"),!1):"string"!=typeof t||""==t?(this.logger.error("zb.sh.usei extraInfo must be string and not empty"),!1):(this.stateCenter.publishStreamList[e]&&(this.stateCenter.publishStreamList[e].extra_info=t,this.stateCenter.publishStreamList[e].state>=n.ENUM_PUBLISH_STREAM_STATE.update_info&&this.updateStreamInfo(e,n.ENUM_STREAM_SUB_CMD.liveUpdate,t)),!0)},e}();t.StreamHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),s=r(1),o=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.resetHeartbeat=function(){this.logger.debug("zb.hb.rht call"),clearTimeout(this.stateCenter.heartbeatTimer),this.stateCenter.heartbeatTimer=null,this.stateCenter.tryHeartbeatCount=0,this.logger.debug("zb.hb.rht call success")},e.prototype.hbLogout=function(e){},e.prototype.start=function(e){var t=this;if(this.logger.debug("zb.hb.sht call"),this.stateCenter.isLogin()){if(++this.stateCenter.tryHeartbeatCount>3)return this.logger.error("zb.hb.sht come to try limit"),void this.hbLogout(s.liveRoomErrorList.HEARTBEAT_TIMEOUT);this.logger.debug("zb.hb.sht send packet"),this.socketCenter.registerRouter("hb",(function(e){t.handleHeartbeatRsp(e)})),this.socketCenter.sendMessage("hb",{reserve:0}),this.logger.debug("zb.hb.sht call success"),this.stateCenter.heartbeatInterval=e,this.stateCenter.heartbeatTimer=setTimeout((function(){t.start(t.stateCenter.heartbeatInterval)}),this.stateCenter.heartbeatInterval)}else this.logger.error("zb.hb.sht state error")},e.prototype.handleHeartbeatRsp=function(e){if(this.logger.debug("zb.hb.hhbr call"),0!==e.body.err_code)return this.logger.error("zb.hb.hhbr call disconnect, server error=",e.body.err_code),void this.hbLogout(i.ClientUtil.getServerError(e.body.err_code));for(var t in this.stateCenter.tryHeartbeatCount=0,this.stateCenter.heartbeatInterval=e.body.hearbeat_interval,this.stateCenter.heartbeatInterval<n.MINIUM_HEARTBEAT_INTERVAL&&(this.stateCenter.heartbeatInterval=n.MINIUM_HEARTBEAT_INTERVAL),e.body.bigim_time_window&&"number"==typeof e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window),e.body.dati_time_window&&"number"==typeof e.body.dati_time_window&&(this.stateCenter.datiTimeWindow=e.body.dati_time_window),this.ReliableMessageHandler(e),this.fetchStreamList(e),e.body.server_user_seq!==this.stateCenter.userSeq&&this.stateCenter.userStateUpdate&&(this.logger.info("zb.hb.hhbr call update user "+e.body.server_user_seq,this.stateCenter.userSeq),this.fetchUserList()),this.stateCenter.publishStreamList)this.stateCenter.publishStreamList[t].state==n.ENUM_PUBLISH_STREAM_STATE.update_info&&(this.logger.info("zb.hb.hhbr try to update stream info"),this.updateStreamInfo(t,n.ENUM_STREAM_SUB_CMD.liveBegin,this.stateCenter.publishStreamList[t].extra_info));null!=e.body.online_count&&0!=e.body.online_count&&this.onUpdateOnlineCount(this.stateCenter.roomid,e.body.online_count),this.logger.debug("zb.hb.hhbr call success")},e.prototype.ReliableMessageHandler=function(e){var t=this;if(e.body.trans_seqs)for(var r=0;r<e.body.trans_seqs.length;r++){var n=e.body.trans_seqs[r].trans_channel,i=e.body.trans_seqs[r].trans_seq_array;(i=i.filter((function(e){var r=e.trans_type,n=e.trans_seq;return!t.stateCenter.transSeqMap[r]||t.stateCenter.transSeqMap[r].seq!==n}))).length>0&&this.fetchReliableMessage(n,i)}},e.prototype.fetchReliableMessage=function(e,t){var r=this;this.logger.debug("zb.hb.frm call");var n={trans_channel:e,fetch_array:t};this.socketCenter.registerRouter("trans_fetch",(function(e){r.handleFetchTransRsp(e)})),this.socketCenter.sendMessage("trans_fetch",n),this.logger.debug("zb.hb.frm call success")},e.prototype.handleFetchTransRsp=function(e){var t=this;this.stateCenter.isLogin()?0==e.body.err_code?e.body.trans_fetch_results.forEach((function(r){var n=r.trans_type,i=r.trans_seq;t.stateCenter.transSeqMap[n]={seq:i},e.body.trans_user_idname!=t.stateCenter.idName&&t.onRecvReliableMessage(n,i,r.trans_data),t.logger.debug("zb.hb.hftr trans "+n+" seq "+i)})):this.logger.error("zb.hb.hftr trans send error "+e.body.err_code):this.logger.error("zb.hb.hftr not login")},e.prototype.fetchStreamList=function(e){var t=this;e.body.stream_seq!==this.stateCenter.streamSeq&&(this.logger.debug("zb.hb.fsl current seq "+this.stateCenter.streamSeq+" server Seq "+e.body.stream_seq),this.logger.debug("zb.hb.fsl call"),this.stateCenter.isLogin()?this.stateCenter.streamQuerying?this.logger.warn("zb.hb.fsl already doing"):(this.stateCenter.streamQuerying=!0,this.logger.debug("zb.hb.fsl send fetch request"),this.socketCenter.registerRouter("stream_info",(function(e){t.handleFetchStreamListRsp(e)})),this.socketCenter.sendMessage("stream_info",{reserve:0}),this.logger.debug("zb.hb.fsl call success")):this.logger.error("zb.hb.fsl state error"))},e.prototype.handleFetchStreamListRsp=function(e){},e.prototype.fetchUserList=function(){},e.prototype.updateStreamInfo=function(e,t,r,n){void 0===r&&(r="")},e.prototype.onUpdateOnlineCount=function(e,t){},e.prototype.onRecvReliableMessage=function(e,t,r){},e.prototype.resetCheckMessage=function(){this.logger.debug("zb.hb.rcm call"),clearTimeout(this.stateCenter.sendDataCheckTimer),this.stateCenter.sendDataCheckTimer=null,this.checkSendMessageList(this.stateCenter.sendDataList),this.checkSendMessageList(this.stateCenter.sendCommandList),this.stateCenter.sendDataMap={},this.stateCenter.sendCommandMap={},this.logger.debug("zb.hb.rcm call success")},e.prototype.checkSendMessageList=function(e){for(var t=e.getFirst();null!=t;)e.remove(t),t._data.error&&(t._data.data.body.custom_msg?t._data.error(s.liveRoomErrorList.SEND_MSG_TIMEOUT,t._data.data.header.seq,t._data.data.body.custom_msg):t._data.error(s.liveRoomErrorList.SEND_MSG_TIMEOUT,t._data.data.header.seq)),t=e.getFirst()},e.prototype.checkMessageListTimeout=function(e,t){for(var r=e.getFirst(),n=Date.parse(new Date+""),i=0,o=0,a=0;!(null==r||r._data.time+this.stateCenter.sendDataTimeout>n||(delete t[r._data.data.header.seq],e.remove(r),++o,null==r._data.error||this.stateCenter.sendDataDropTimeout>0&&r._data.time+this.stateCenter.sendDataDropTimeout<n?++a:r._data.data.body.custom_msg?r._data.error(s.liveRoomErrorList.SEND_MSG_TIMEOUT,r._data.data.header.seq,r._data.data.body.custom_msg):r._data.error(s.liveRoomErrorList.SEND_MSG_TIMEOUT,r._data.data.header.seq),++i>=this.stateCenter.sendDataCheckOnceCount));)r=e.getFirst();0==o&&0==a||this.logger.debug("zb.hb.cmt call success, stat: timeout=",o,"drop=",a)},e.prototype.startCheckMessageTimeout=function(){var e=this;this.stateCenter.isLogin()?(this.checkMessageListTimeout(this.stateCenter.sendDataList,this.stateCenter.sendDataMap),this.checkMessageListTimeout(this.stateCenter.sendCommandList,this.stateCenter.sendCommandMap),this.stateCenter.sendDataCheckTimer=setTimeout((function(){e.startCheckMessageTimeout()}),this.stateCenter.sendDataCheckInterval)):this.logger.error("zb.hb.scmt state error")},e}();t.HeartBeatHandler=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(2),s=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.sendCustomCommand=function(e,t,r,n){var s=this;if(this.logger.debug("zb.mh.scc call"),this.stateCenter.isLogin()){var o={from_userid:this.stateCenter.idName,from_username:this.stateCenter.nickName,request_id:this.stateCenter.getRequestId(),custom_content:t||"",room_id:this.stateCenter.roomid},a={dest_id_name:e,custom_msg:JSON.stringify(o)};i.ClientUtil.checkCustomCommandParam(a)?(this.socketCenter.registerRouter("custommsg",(function(e){s.handleSendCustomMsgRsp(e)})),this.socketCenter.sendCustomMessage("custommsg",a,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],i=e[1];r({errorCode:n,messageID:i})}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],i=e[1];s.logger.error("zb.mh.scc "+r.msg),n({errorCode:r,messageID:i})})),this.logger.info("zb.mh.scc call success")):this.logger.error("zb.mh.scc param error")}else this.logger.error("zb.mh.scc state error")},e.prototype.handleSendCustomMsgRsp=function(e){this.logger.debug("zb.mh.hscmrcall");var t,r=this.stateCenter.sendDataMap[e.header.seq];null!=r?("custommsg"!=(t=r._data).data.header.cmd?this.logger.error("zb.mh.hscmrcmd wrong"+t.data.header.cmd):0===e.body.err_code?(JSON.parse(t.data.body.custom_msg),null!=t.success&&t.success(0,e.body.msg_id)):null!=t.error&&t.error(i.ClientUtil.getServerError(e.body.err_code),e.body.msg_id),delete this.stateCenter.sendDataMap[e.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error("zb.mh.hscmrno found seq="+e.header.seq),this.logger.debug("zb.mh.hscmr  call success")},e.prototype.handlePushCustomMsg=function(e){var t=JSON.parse(e.body.custommsg);this.logger.debug("zb.mh.hpcm submsg=",t),this.onRecvCustomCommand(t.from_userid,t.from_username,t.room_id,t.custom_content)},e.prototype.onRecvCustomCommand=function(e,t,r,n){},e.prototype.sendRoomMsg=function(e,t,r,i,s){var o=this;if(this.logger.debug("zb.mh.srm call"),this.stateCenter.isLogin()){var a=Date.parse(new Date+"");if(this.stateCenter.sendRoomMsgTime>0&&this.stateCenter.sendRoomMsgTime+this.stateCenter.SendRoomMsgInterval>a)return this.logger.info("zb.mh.srm freq error"),void(s&&s(n.sdkErrorList.FREQ_LIMITED,0,e,r));this.stateCenter.sendRoomMsgTime=a,this.logger.debug("zb.mh.srm send fetch request");var c={msg_category:e,msg_type:1,msg_content:r};this.socketCenter.registerRouter("im_chat",(function(e){o.handleSendRoomMsgRsp(e)})),this.socketCenter.sendCustomMessage("im_chat",c,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],n=e[1];i({errorCode:r,messageID:n})}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=e[0],n=e[1];o.logger.error("zb.mh.srm "+r.msg),s({errorCode:r,messageID:n})})),this.logger.info("zb.mh.srm call success")}else this.logger.error("zb.mh.srm state error")},e.prototype.handleSendRoomMsgRsp=function(e){this.logger.debug("zb.mh.hsrmr call");var t,r=this.stateCenter.sendDataMap[e.header.seq];null!=r?("im_chat"!=(t=r._data).data.header.cmd?this.logger.error("zb.mh.hsrmr cmd wrong"+t.data.header.cmd):0===e.body.err_code?t.success&&t.success(0,e.body.msg_id):t.error&&t.error(i.ClientUtil.getServerError(e.body.err_code),e.body.msg_id),delete this.stateCenter.sendDataMap[e.header.seq],this.stateCenter.sendDataList.remove(r)):this.logger.error("hzb.mh.hsrmr no found seq="+e.header.seq),this.logger.info("zb.mh.hsrmr call success")},e.prototype.onRecvRoomMsg=function(e,t,r){},e.prototype.sendReliableMessage=function(e,t,r,n){this.logger.debug("zb.mh.srirm call"),this.stateCenter.transSeqMap[e]||(this.stateCenter.transSeqMap[e]={seq:0});var i={trans_type:e,trans_data:t,trans_local_seq:this.stateCenter.transSeqMap[e].seq,trans_channel:"clt"};this.socketCenter.sendMessage("trans",i,r,n)},e.prototype.sendBigRoomMessage=function(e,t,r,n,i){var s=this;console.log(t),this.logger.debug("zb.mh.sbim call");var o=this.stateCenter.bigimTimeWindow,a=this.stateCenter.serverTimeOffset,c=(new Date).getTime()+a,l=(++this.stateCenter.cmdSeq).toString();if(this.stateCenter.bigImCallbackMap[l]={success:n,error:i},0==o){var d={msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:l};this.logger.debug("zb.mh.sbim no time window"),this.sendBigRoomMessageInternal([d],(function(e){s.handleBigImMsgRsp(e)}),i)}else{var u=Math.floor(c/o);if(this.logger.debug("currentIndex "+u+" lastTimeIndex "+this.stateCenter.bigImLastTimeIndex),this.stateCenter.bigImLastTimeIndex<u&&0==this.stateCenter.bigImMessageList.length){this.stateCenter.bigImLastTimeIndex=u;var h={msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:l};this.sendBigRoomMessageInternal([h],(function(e){s.handleBigImMsgRsp(e)}),i)}else this.stateCenter.bigImMessageList.push({msg_category:e,msg_type:1,msg_content:r,bigmsg_client_id:l}),1==this.stateCenter.bigImMessageList.length&&this.setBigImTimer(a,o)}},e.prototype.handlePushMergeMsg=function(e){if(this.stateCenter.isLogin()){for(var t=0;t<e.body.messages.length;t++)14001===e.body.messages[t].sub_cmd&&this.handlePushBigRooMsg(e.body.messages[t].msg_body);this.logger.debug("zb.mh.hpmm call success")}else this.logger.error("zb.mh.hpmmnot login")},e.prototype.handlePushBigRooMsg=function(e){var t;try{t=JSON.parse(e)}catch(e){return void this.logger.warn("zb.mh.hpbrm parse json error")}if(t){for(var r=t.room_id,n=[],i=0;i<t.msg_data.length;i++){var s=t.msg_data[i];s.id_name!=this.stateCenter.idName?n.push({idName:s.id_name,nickName:s.nick_name,messageId:s.bigmsg_id,category:s.msg_category,type:s.msg_type,content:s.msg_content,time:s.send_time}):this.logger.debug("zb.mh.hpbrm self message")}0==n.length?this.logger.debug("zb.mh.hpbrm no other pushData except self"):this.onRecvBigRoomMessage(n,r),this.logger.debug("zb.mh.hpbrm call success")}else this.logger.warn("zb.mh.hpbrm cann't find message body")},e.prototype.onRecvBigRoomMessage=function(e,t){},e.prototype.sendBigRoomMessageInternal=function(e,t,r){this.logger.debug("zb.mh.sbim call");var n={msgs:e};this.socketCenter.sendMessage("bigim_chat",n,t,r)},e.prototype.handleBigImMsgRsp=function(e){if(this.stateCenter.isLogin()){this.stateCenter.bigimTimeWindow!=e.body.bigim_time_window&&(this.stateCenter.bigimTimeWindow=e.body.bigim_time_window);for(var t=0;t<e.body.msgs.length;t++){var r=e.body.msgs[t].bigmsg_client_id,n=e.body.msgs[t].bigmsg_id;if(this.stateCenter.bigImCallbackMap[r]){var i=this.stateCenter.bigImCallbackMap[r].success;null!=i&&i({errorCode:0,messageID:n}),delete this.stateCenter.bigImCallbackMap[r]}}}else this.logger.info("zb.mh.hbmr not login")},e.prototype.setBigImTimer=function(e,t){var r=this,n=t-((new Date).getTime()+e)%t,s=i.ClientUtil.generateRandumNumber(t)+n;this.logger.info("zb.mh.sbt setTimer "+s),this.stateCenter.bigImTimer=setTimeout((function(){r.onBigImTimer()}),s)},e.prototype.onBigImTimer=function(){var e=this,t=(new Date).getTime()+this.stateCenter.serverTimeOffset;this.stateCenter.bigImLastTimeIndex=Math.floor(t/this.stateCenter.bigimTimeWindow);for(var r=[],n=[],i=0;i<this.stateCenter.bigImMessageList.length&&!(i>=20);i++){var s=this.stateCenter.bigImMessageList[i];r.push({msg_category:s.msg_category,msg_type:s.msg_type,msg_content:s.msg_content,bigmsg_client_id:s.bigmsg_client_id}),n.push(s.bigmsg_client_id)}this.stateCenter.bigImMessageList.length>20?this.stateCenter.bigImMessageList.splice(0,20):this.stateCenter.bigImMessageList=[],this.sendBigRoomMessageInternal(r,(function(t){e.handleBigImMsgRsp(t)}),(function(t,r){for(var i=0;i<n.length;i++){var s=n[i],o=e.stateCenter.bigImCallbackMap[s];o&&(null!=o.error&&o.error(t,r),delete e.stateCenter.bigImCallbackMap[s])}})),clearTimeout(this.stateCenter.bigImTimer),this.stateCenter.bigImTimer=null,this.stateCenter.bigImMessageList.length>0&&this.setBigImTimer(this.stateCenter.serverTimeOffset,this.stateCenter.bigimTimeWindow)},e.prototype.sendRelayMessage=function(e,t,r,n){this.logger.debug("zb.mh.srm call");var i=this.stateCenter.datiTimeWindow,s=this.stateCenter.serverTimeOffset;i>0?(this.stateCenter.realyMessageList.push({type:e,data:t,success:r,error:n}),1==this.stateCenter.realyMessageList.length&&this.setRelayTimer(s,i)):this.sendRelayMessageInternal(e,t,r,n)},e.prototype.sendRelayMessageInternal=function(e,t,r,n){this.logger.debug("zb.mh.srmi call");var i={relay_type:e,relay_data:t};this.socketCenter.sendMessage("relay",i,r,n)},e.prototype.setRelayTimer=function(e,t){var r=this,n=2*t-((new Date).getTime()+e)%t,s=i.ClientUtil.generateRandumNumber(n);this.logger.info("zb.mh.srt setTimer "+s),this.stateCenter.relayTimer=setTimeout((function(){r.onRelayTimer()}),s)},e.prototype.onRelayTimer=function(){if(0!=this.stateCenter.realyMessageList.length){var e=this.stateCenter.realyMessageList[0];this.sendRelayMessageInternal(e.type,e.data,e.success,e.error),clearTimeout(this.stateCenter.relayTimer),this.stateCenter.relayTimer=null,this.stateCenter.realyMessageList.splice(0,1),this.stateCenter.realyMessageList.length>0&&this.setRelayTimer(this.stateCenter.serverTimeOffset,this.stateCenter.datiTimeWindow)}else this.logger.info("zb.mh.ort no relay data")},e.prototype.handlePushTransMsg=function(e){if(this.stateCenter.isLogin()){var t=e.body.trans_type,r=e.body.trans_seq;this.stateCenter.transSeqMap[t]?this.stateCenter.transSeqMap[t].seq=r:this.stateCenter.transSeqMap[t]={seq:r},e.body.trans_user_idname!=this.stateCenter.idName?this.onRecvReliableMessage(t,r,e.body.trans_data):this.logger.debug("zb.mh.hptr receive self trans message"),this.logger.info("zb.mh.hptr trans "+t+" seq "+r)}else this.logger.error("zb.mh.hptr not login")},e.prototype.onRecvReliableMessage=function(e,t,r){},e}();t.MessageHandler=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=function(){function e(e,t,r){this.logger=e,this.socketCenter=r,this.stateCenter=t}return e.prototype.requestJoinLive=function(e,t,r,i){this.logger.debug("zb.lh.rjl call");var s=this.stateCenter.getRequestId(),o=this.stateCenter.getSignalCmdContent(s,e);return null!=i&&(this.stateCenter.joinLiveCallbackMap[s]=i,this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveRequest,o,e,t,r),!0)},e.prototype.inviteJoinLive=function(e,t,r,i){this.logger.debug("zb.lh.ijl call");var s=this.stateCenter.getRequestId(),o=this.stateCenter.getSignalCmdContent(s,e);return null!=i&&(this.stateCenter.joinLiveCallbackMap[s]=i,this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveInvite,o,e,t,r),!0)},e.prototype.endJoinLive=function(e,t,r){this.logger.debug("zb.lh.ejl call");var i=this.stateCenter.getRequestId(),s=this.stateCenter.getSignalCmdContent(i,e);return this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveStop,s,e,t,r),!0},e.prototype.respondJoinLive=function(e,t,r,i){this.logger.debug("zb.lh.rpjl call");var s=this.stateCenter.joinLiveRequestMap[e];if(!s)return this.logger.info("zb.lh.rpjl no dest id name"),!1;var o=0;!0===t&&(o=1);var a=this.stateCenter.getSignalCmdContent(e,s,o);return this.sendSignalCmd(n.ENUM_SIGNAL_SUB_CMD.joinLiveResult,a,s,r,i),delete this.stateCenter.joinLiveRequestMap[e],!0},e.prototype.sendSignalCmd=function(e,t,r,n,i){if(this.logger.debug("zb.lh.ssc call"),this.stateCenter.isLogin()){this.logger.debug("zb.lh.ssc send signal cmd "+e);var s={sub_cmd:e,signal_msg:t,dest_id_name:[r]};this.socketCenter.sendMessage("signal",s,n,i),this.logger.info("zb.lh.ssc call success")}else this.logger.error("zb.lh.ssc state error")},e.prototype.handlePushSignalMsg=function(e){if(this.stateCenter.isLogin()){var t=JSON.parse(e.body.signal_msg);switch(this.logger.debug("zb.lh.hpcm hpsm= ",t),e.body.sub_cmd){case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveRequest:this.handlePushJoinLiveRequestMsg(t);break;case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveResult:this.handlePushJoinLiveResultMsg(t);break;case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveInvite:this.handlePushJoinLiveInviteMsg(t);break;case n.ENUM_PUSH_SIGNAL_SUB_CMD.pushJoinLiveStop:this.handlePushJoinLiveStopMsg(t)}this.logger.debug("zb.lh.hpsm call end")}else this.logger.warn("zb.lh.hpsm not login")},e.prototype.handlePushJoinLiveRequestMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.stateCenter.joinLiveRequestMap[t]=r,this.logger.info("zb.lh.hpjlrm onRecvJoinLiveRequest "+r),this.onRecvJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id)):this.logger.error("zb.lh.hpjlrm no from user")}else this.logger.error("zb.lh.hpjlrm no requestId")},e.prototype.onRecvJoinLiveRequest=function(e,t,r,n){},e.prototype.handlePushJoinLiveInviteMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.from_userid;"string"==typeof r?(this.stateCenter.joinLiveRequestMap[t]=r,this.logger.info("zb.lh.hpjlim onRecvInviteJoinLiveRequest "+r),this.onRecvInviteJoinLiveRequest(t,e.from_userid,e.from_username,e.room_id)):this.logger.error("zb.lh.hpjlim no from user")}else this.logger.error("zb.lh.hpjlim no requestId")},e.prototype.onRecvInviteJoinLiveRequest=function(e,t,r,n){},e.prototype.handlePushJoinLiveResultMsg=function(e){var t=e.request_id;if("string"==typeof t){var r=e.result;if(null!=r){var n=1==r;if(this.stateCenter.joinLiveCallbackMap[t]){var i=this.stateCenter.joinLiveCallbackMap[t];if(!i)return void this.logger.info("hpjlrm.o no callback");this.logger.info("zb.lh.hpjlrm joinLiveRequest/invite result "+n),delete this.stateCenter.joinLiveCallbackMap[t],i(n,e.from_userid,e.from_username)}}else this.logger.info("zb.lh.hpjlrm no result")}else this.logger.error("zb.lh.hpjlrm no requestId")},e.prototype.handlePushJoinLiveStopMsg=function(e){var t=e.request_id;"string"==typeof t?(this.logger.info("zb.lh.hpjlsm onRecvEndJoinLiveCommand "+e.from_userid),this.onRecvEndJoinLiveCommand(t,e.from_userid,e.from_username,e.room_id)):this.logger.error("zb.lh.hpjlsm no requestId")},e.prototype.onRecvEndJoinLiveCommand=function(e,t,r,n){},e}();t.LiveHandler=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(3),s=function(){function e(){this.debug=!1,this.debugCustom=!1,this.testEnvironment=!1,this.third_token="",this.pullLimited=!0,this.configOK=!1,this.role=2,this.roomCreateFlag=1,this.runState=n.ENUM_RUN_STATE.logout,this.lastRunState=n.ENUM_RUN_STATE.logout,this.callbackList={},this.streamQuerying=!1,this.streamSeq=0,this.streamList=[],this.publishStreamList={},this.userQuerying=!1,this.userTempList=[],this.userList=[],this.userSeq=0,this.anchor_info={anchor_id:"",anchor_id_name:"",anchor_nick_name:""},this.sendCommandMap={},this.sendCommandList=new n.LinkedList,this.sendDataMap={},this.sendDataList=new n.LinkedList,this.joinLiveCallbackMap={},this.joinLiveRequestMap={},this.streamUrlMap={},this.cmdCallback={},this.customUrl=null,this.transSeqMap={},this.realyMessageList=[],this.relayTimer=null,this.bigImLastTimeIndex=0,this.bigIMmessageList=[],this.bigImCallbackMap={},this.bigImTimer=null,this.msgCategory=2,this.serverTimeOffset=0,this.datiTimeWindow=0,this.bigimTimeWindow=0,this.bigImMessageList=[],this.tryLoginCount=0,this.tryLoginTimer=null,this.heartbeatTimer=null,this.sendDataCheckTimer=null,this.sendDataCheckInterval=2e3,this.sendDataTimeout=5e3,this.sendDataDropTimeout=1e4,this.sendDataCheckOnceCount=100,this.sendRoomMsgTime=0,this.SendRoomMsgInterval=500,this.cmdSeq=0,this.audioEffectBuffer={},this.audioBitRate=48e3,this.cdnSeq=0,this.listenerList={roomUserUpdate:[],updateOnlineCount:[],getAnchorInfo:[],IMRecvCustomCommand:[],IMRecvBroadcastMessage:[],recvReliableMessage:[],IMRecvBarrageMessage:[],recvJoinLiveRequest:[],recvInviteJoinLiveRequest:[],recvEndJoinLiveCommand:[],roomStreamUpdate:[],streamExtraInfoUpdate:[],playerStateUpdate:[],publisherStateUpdate:[],roomStateUpdate:[],screenSharingEnded:[],publishQualityUpdate:[],playQualityUpdate:[],remoteCameraStatusUpdate:[],remoteMicStatusUpdate:[]},this.mixStreamAdvance={}}return e.prototype.isLogin=function(){return this.runState===n.ENUM_RUN_STATE.login},e.prototype.getRequestId=function(){return this.idName+"-"+i.getSeq()},e.prototype.getSignalCmdContent=function(e,t,r){var n={request_id:e,room_id:this.roomid,from_userid:this.idName,from_username:this.nickName,to_userid:t};return null!=r&&(n.result=r),JSON.stringify(n)},e.prototype.actionListener=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.listenerList[e]&&this.listenerList[e].forEach((function(e){e.apply(void 0,t)}))},e}();t.StateCenter=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),i=function(){function e(e){var t=this,r=e.type,n=e.channels,i=void 0===n?1:n,s=e.bufferSize,o=void 0===s?0:s,a=e.sampleBit,c=void 0===a?16:a,l=e.sampleRate,d=void 0===l?44100:l;this.instant=0,this.slow=0,this.clip=0;var u=new("undefined"!=typeof webkitAudioContext?webkitAudioContext:AudioContext);this.context=u,this.type=r,this.channels=i,this.bufferSize=o,this.sampleBit=c,this.sampleRate=d,this.script=u.createScriptProcessor(o,i,i),(new Date).getTime(),this.script.addEventListener("audioprocess",(function(e){var n,i=e.inputBuffer.getChannelData(0),s=0,o=0;for(n=0;n<i.length;++n)s+=i[n]*i[n],Math.abs(i[n])>.99&&(o+=1);if(t.instant=Math.sqrt(s/i.length),t.slow=.95*t.slow+.05*t.instant,t.clip=o/i.length,"pcm"===r||"wav"===r){for(var a=[],c=0;c<t.channels;c++)a.push(e.inputBuffer.getChannelData(c));t.recorderBuffer(a)}})),"pcm"!==r&&"wav"!==r||this.initRecorderBuffer(r)}return e.prototype.connectToSource=function(e,t){console.log("SoundMeter connecting");try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==t&&t(null)}catch(e){console.error(e),void 0!==t&&t(e)}return this},e.prototype.recorderBuffer=function(e){this.worker.postMessage({command:"record",val:e})},e.prototype.initRecorderBuffer=function(e){var t=this,r=this;this.worker=n.ClientUtil.inlineWorker((function(){var e,r,n,i,s,o,a=[],c=t;function l(e,t,r){for(var n=0;n<r.length;n++,t+=2){var i=Math.max(-1,Math.min(1,r[n]));e.setInt16(t,i<0?32768*i:32767*i,!0)}}function d(e,t,r){for(var n=0;n<r.length;n++,t++){var i=Math.max(-1,Math.min(1,r[n])),s=i<0?128*i:127*i;s+=128,e.setInt8(t,s)}}function u(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))}function h(e,t){for(var r=new Float32Array(t.length/e),n=0,i=0;n<r.length;)r[n]=t[i],i+=e,n++;return r}function p(e,t,r){for(var n=new Float32Array(t*e.length),i=0,s=0;s<r[0].length;s++)n.set(r[0][s],i),i+=r[0][s].length;return n}function f(e,t){for(var r=new Float32Array(e.length+t.length),n=0;n<e.length+t.length;n+=2)r[n]=e[n/2>>0],r[n+1]=t[n/2>>0];return r}function g(t){var r,n;if(1==e)r=p(a[0],s,a),1!=t&&(n=h(t,r));else if(2==e){var i=p(a[0],s,a),o=p(a[1],s,a);1!=t?n=f(h(t,i),h(t,o)):r=f(i,o)}return 1!=t?n:r}function m(e){var t=function(e,t){var n;8==t?n=e.length:16==t&&(n=e.length,n*=2);var i=new ArrayBuffer(n),s=new DataView(i);return 8==t?d(s,0,e):16==r&&l(s,0,e),s}(g(e),r);c.postMessage({command:"exportPcmLive",val:t})}function v(t){var i=function(t,i){var s;8==i?s=t.length:16==r&&(s=t.length,s*=2);var o=new ArrayBuffer(s+44),a=new DataView(o),c=n,h=r,p=e;return u(a,0,"RIFF"),a.setUint32(4,36+s,!0),u(a,8,"WAVE"),u(a,12,"fmt "),a.setUint32(16,16,!0),a.setUint16(20,1,!0),a.setUint16(22,p,!0),a.setUint32(24,c,!0),a.setUint32(28,c*p*(h/8),!0),a.setUint16(32,p*(h/8),!0),a.setUint16(34,h,!0),u(a,36,"data"),a.setUint32(40,s,!0),8==r?d(a,44,t):16==r&&l(a,44,t),a}(g(t),r);c.postMessage({command:"exportWav",val:i})}t.onmessage=function(t){switch(t.data.command){case"init":c=t.data.val,e=c.sampleChannel,r=c.sampleBit,n=c.sampleRate,i=c.oldSampleRate,s=c.bufferSize,o=c.type;break;case"record":!function(t){for(var r=0;r<e;r++)a[r]||(a[r]=[]),a[r].push(t[r]);var s=Math.round(i/n);"pcm"===o?m(s):"wav"===o&&v(s),a=[]}(t.data.val)}var c}})),this.worker.postMessage({command:"init",val:{sampleChannel:this.channels,sampleBit:this.sampleBit,sampleRate:this.sampleRate,oldSampleRate:this.context.sampleRate,bufferSize:this.bufferSize,type:e}}),this.worker.onmessage=function(e){switch(e.data.command){case"exportPcmLive":r.onReceiveBuffer(e.data.val);break;case"exportWav":r.onReceiveWav(e.data.val)}}},e.prototype.onReceiveBuffer=function(e){},e.prototype.onReceiveWav=function(e){},e.prototype.writeString=function(e,t,r){for(var n=0;n<r.length;n++)e.setUint8(t+n,r.charCodeAt(n))},e.prototype.writeBuffer=function(e,t,r){for(var n=0;n<r.byteLength;n++)e.setUint8(t+n,r[n])},e.prototype.concatenation=function(e){for(var t=0,r=0;r<e.length;++r)t+=e[r].buffer.byteLength;var n=new Uint8Array(t),i=0;for(r=0;r<e.length;++r)n.set(new Uint8Array(e[r].buffer),i),i+=e[r].buffer.byteLength;return n},e.prototype.encodeWave=function(e){var t=this.concatenation(e),r=t.byteLength,n=new ArrayBuffer(r+44),i=new DataView(n),s=this.sampleRate,o=this.sampleBit,a=this.channels;return this.writeString(i,0,"RIFF"),i.setUint32(4,36+r,!0),this.writeString(i,8,"WAVE"),this.writeString(i,12,"fmt "),i.setUint32(16,16,!0),i.setUint16(20,1,!0),i.setUint16(22,a,!0),i.setUint32(24,s,!0),i.setUint32(28,s*a*(o/8),!0),i.setUint16(32,a*(o/8),!0),i.setUint16(34,o,!0),this.writeString(i,36,"data"),i.setUint32(40,r,!0),this.writeBuffer(i,44,t),i},e.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e}();t.MediaUtil=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})}])},function(e,t,r){"use strict";r.r(t);var n=r(1);var i,s,o,a=r(0),c=r.n(a),l=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}c((n=n.apply(e,t||[])).next())}))},d=function(e,t){var r,n,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}},u="sample"+(new Date).getTime(),h="https://wsliveroom-demo.zego.im:8282/token",p="webrtc"+(new Date).getTime(),f="task-"+(new Date).getTime(),g="mix-"+p,m=96527232,v="wss://wssliveroom-test.zego.im/ws",y="",S=[],b=!1,C="H264";i=function(e,t,r){var n=e,i=t,s=r;return location.search&&location.search.substr(1).split("&").forEach((function(e){var t=e.split("=")[0],r=e.split("=")[1];"appid"===t&&(n=Number(r)),"server"===t&&(i=decodeURIComponent(r)),"cgi_token"===t&&(s=decodeURIComponent(r))})),{appID:n,server:i,cgiToken:s}}(m,v,y),m=i.appID,v=i.server,(y=i.cgiToken)&&"https://wsliveroom-demo.zego.im:8282/token"==h&&c.a.get(y,(function(e){y=e.data,console.log(y)}));var T=new n.ZegoExpressEngine(m,v);function _(){return l(this,void 0,Promise,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return console.log("sdk version is",T.getVersion()),[4,T.checkSystemRequirements()];case 1:return e=t.sent(),console.warn("checkSystemRequirements ",e),C=e.videoCodec.VP8?"VP8":e.videoCodec.H264?"H264":void 0,c()("#videoCodeType option:eq(0)").val(C||""),!e.videoCodec.H264&&c()("#videoCodeType option:eq(1)").attr("disabled","disabled"),!e.videoCodec.VP8&&c()("#videoCodeType option:eq(2)").attr("disabled","disabled"),e.webRTC?e.videoCodec.H264||e.videoCodec.VP8?(s=c()("#previewVideo")[0],function(){l(this,void 0,void 0,(function(){var e=this;return d(this,(function(t){return function(){var e=this;(function(){l(this,void 0,void 0,(function(){var e,t,r;return d(this,(function(n){switch(n.label){case 0:return e=[],t=[],[4,T.enumDevices()];case 1:return(r=n.sent())&&r.microphones.map((function(t,r){return t.deviceName||(t.deviceName="microphone"+r),e.push(' <option value="'+t.deviceID+'">'+t.deviceName+"</option>"),console.log("microphone: "+t.deviceName),t})),r&&r.cameras.map((function(e,r){return e.deviceName||(e.deviceName="camera"+r),t.push(' <option value="'+e.deviceID+'">'+e.deviceName+"</option>"),console.log("camera: "+e.deviceName),e})),e.push('<option value="0">禁止</option>'),t.push('<option value="0">禁止</option>'),c()("#audioList").html(e.join("")),c()("#videoList").html(t.join("")),[2]}}))}))})(),T.on("roomStateUpdate",(function(e,t,r){console.log("roomStateUpdate",e,t,r)})),T.on("publisherStateUpdate",(function(e){console.log("publisherStateUpdate roomID:"+e.streamID),"PUBLISHING"==e.state?(console.info(" publish  success"),function(){l(this,void 0,void 0,(function(){var e,t,r;return d(this,(function(n){switch(n.label){case 0:return e=[{streamID:p,layout:{top:0,left:0,bottom:480,right:640}}],console.error("videoCodec",C),[4,T.setMixerTaskConfig({videoCodec:"VP8"===C?"h264":"vp8"})];case 1:return t=n.sent(),console.log("setMixerTaskConfig ",t),[4,T.startMixerTask({taskID:f,inputList:e,outputList:[{target:g}],outputConfig:{outputBitrate:300,outputFps:15,outputWidth:640,outputHeight:480}})];case 2:return r=n.sent(),console.log("startMixerTask ",r.errorCode),[2]}}))}))}()):"PUBLISH_REQUESTING"==e.state?console.info(" publish  retry"):console.error("publish error code "+e.errorCode)})),T.on("playerStateUpdate",(function(e){"PLAYING"==e.state?console.info(" play  success"):"PLAY_REQUESTING"==e.state?console.info(" play  retry"):console.error("publish error code "+e.errorCode)})),T.on("roomStreamUpdate",(function(t,r,n){return l(e,void 0,void 0,(function(){var e,i,s,o,a;return d(this,(function(l){switch(l.label){case 0:if(console.log("roomStreamUpdate roomID: "+t),"ADD"!=r)return[3,5];e=function(e){var t,r;return d(this,(function(i){switch(i.label){case 0:return console.info(n[e].streamID+" was added"),S.push(n[e]),c()("#memberList").append('<option value="'+n[e].user.userID+'">'+n[e].user.userName+"</option>"),c()(".remoteVideo").append(c()("<video  autoplay muted playsinline controls></video>")),[4,w(S[e])];case 1:return t=i.sent(),(r=c()(".remoteVideo video:eq("+e+")")[0]).srcObject=t,r.muted=!1,setTimeout((function(){r.play()}),2e3),[2]}}))},i=0,l.label=1;case 1:return i<n.length?[5,e(i)]:[3,4];case 2:l.sent(),l.label=3;case 3:return i++,[3,1];case 4:return[3,6];case 5:if("DELETE"==r)for(s=0;s<S.length;s++)for(o=0;o<n.length;o++)if(S[s].streamID===n[o].streamID){a=JSON.parse(S[s].extraInfo),T.stopPlayingStream(S[s].streamID),a.mixStreamId&&T.stopPlayingStream(a.mixStreamId),console.info(S[s].streamID+"was devared"),S.splice(s,1),c()(".remoteVideo video:eq("+s+")").remove(),c()("#memberList option:eq("+s+")").remove();break}l.label=6;case 6:return[2]}}))}))})),T.on("playQualityUpdate",(function(t,r){return l(e,void 0,void 0,(function(){return d(this,(function(e){return console.log("play#"+t+" videoFPS: "+r.video.videoFPS+" videoBitrate: "+r.video.videoBitrate+" audioBitrate: "+r.audio.audioBitrate),[2]}))}))})),T.on("publishQualityUpdate",(function(t,r){return l(e,void 0,void 0,(function(){return d(this,(function(e){return console.log("publish#"+t+" videoFPS: "+r.video.videoFPS+" videoBitrate: "+r.video.videoBitrate+" audioBitrate: "+r.audio.audioBitrate),[2]}))}))}))}(),c()("#createRoom").click((function(){return l(e,void 0,void 0,(function(){var e,t;return d(this,(function(r){switch(r.label){case 0:return c()("#videoCodec").val()&&(C=c()("#videoCodec").val()),e=JSON.stringify({currentVideoCode:C,mixStreamId:g}),[4,R()];case 1:return t=r.sent(),t?[4,M({extraInfo:e,videoCodec:C})]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))})),c()("#openRoom").click((function(){return l(e,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return c()("#videoCodec").val()&&(C=c()("#videoCodec").val()),[4,R()];case 1:return e.sent(),[2]}}))}))})),c()("#leaveRoom").click((function(){L()})),[2]}))}))}(),[2,!0]):(alert("browser is not support H264 and VP8"),[2,!1]):(alert("browser is not support webrtc!!"),[2,!1])}}))}))}function E(e){return l(this,void 0,Promise,(function(){var t;return d(this,(function(r){switch(r.label){case 0:return t="",y?[4,c.a.get(h,{app_id:m,id_name:u,cgi_token:y})]:[3,2];case 1:return t=r.sent(),[3,4];case 2:return[4,c.a.get("https://wsliveroom-alpha.zego.im:8282/token",{app_id:m,id_name:u})];case 3:t=r.sent(),r.label=4;case 4:return[4,T.loginRoom(e,t,{userID:u,userName:u})];case 5:return[2,r.sent()]}}))}))}function R(){return l(this,void 0,Promise,(function(){var e;return d(this,(function(t){switch(t.label){case 0:return(e=c()("#roomId").val())?[4,E(e)]:(alert("roomId is empty"),[2,!1]);case 1:return[2,t.sent()]}}))}))}function L(){return l(this,void 0,void 0,(function(){var e,t;return d(this,(function(r){switch(r.label){case 0:return console.info("leave room  and close stream"),b?[4,T.stopMixerTask(f)]:[3,2];case 1:r.sent(),T.stopPublishingStream(p),T.destroyStream(o),b=!1,r.label=2;case 2:for(e=0;e<S.length;e++)T.stopPlayingStream(S[e].streamID);return S=[],c()(".remoteVideo").html(""),t=c()("#roomId").val(),T.logoutRoom(t),[2]}}))}))}function w(e){return l(this,void 0,Promise,(function(){var t,r,n,i,s=this;return d(this,(function(o){switch(o.label){case 0:return t=e.extraInfo,r=e.streamID,n=null,t?(i=JSON.parse(t),console.error("v ",i,C),i.currentVideoCode===C?[3,2]:(r=i.mixStreamId,i.currentVideoCode=C,[4,new Promise((function(e,t){setTimeout((function(){return l(s,void 0,void 0,(function(){var t;return d(this,(function(n){switch(n.label){case 0:return[4,T.startPlayingStream(r,{videoCodec:C})];case 1:return t=n.sent(),e(t),[2]}}))}))}),2e3)}))])):[3,4];case 1:return n=o.sent(),[3,4];case 2:return[4,T.startPlayingStream(r,{videoCodec:C})];case 3:n=o.sent(),o.label=4;case 4:return[2,n]}}))}))}function M(e){return l(this,void 0,void 0,(function(){var t;return d(this,(function(r){switch(r.label){case 0:return console.warn("createStream",c()("#audioList").val(),c()("#videoList").val()),[4,T.createStream({camera:{audioInput:c()("#audioList").val(),videoInput:c()("#videoList").val()}})];case 1:return o=r.sent(),s.srcObject=o,b=!0,t=T.startPublishingStream(p,o,e),console.log("publish stream"+p,t,e),[2]}}))}))}c()((function(){return l(void 0,void 0,void 0,(function(){return d(this,(function(e){switch(e.label){case 0:return[4,_()];case 1:return e.sent(),[2]}}))}))})),c()(window).on("unload",(function(){L()}))}]);